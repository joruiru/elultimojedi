!% -~SD
!% +language_name=Spanish
!% $MAX_STATIC_DATA=20000
!% $MAX_PROP_TABLE_SIZE=55900
!% $MAX_VERBS=153
!% $DICT_WORD_SIZE=12
!%
! Las opciones de arriba son comandos especiales que el compilador leera,
! por eso deben estar al principio del archivo antes que cualquier otra cosa.
! Detalles:
!     !% -~S~D
!     (desactiva el modo STRICT y el modo DEBUG en la compilacion del juego).
!
!     !% +language_name=Spanish  [IMPORTANTISIMO]
!     (le dice a Inform que cargue los archivos de idioma Spanish de INFSP).
!
!=============================================================================== 
!                               LICENCIA / LICENSE 
!=============================================================================== 
! 
! "EL ULTIMO JEDI" 
! 
! Copyright (c) 2011 José Vicente Ruiz (joruiru) 
! 
! This program is free software: you can redistribute it and/or modify 
! it under the terms of the GNU General Public License as published by 
! the Free Software Foundation, either version 3 of the License, or 
! (at your option) any later version. 
! 
! This program is distributed in the hope that it will be useful, 
! but WITHOUT ANY WARRANTY; without even the implied warranty of 
! MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the 
! GNU General Public License for more details. 
! 
! You should have received a copy of the GNU General Public License 
! along with this program.  If not, see <http://www.gnu.org/licenses/>. 
! 
!=============================================================================== 
! Plantilla v3 para la Libreria Inform 6/11 + Libreria Española INFSP6 
! ** Creada por Eliuk Blau (DreamBytes Adventures) ** 
!=============================================================================== 
! 
!=============================================================================== 
!  EL ULTIMO JEDI 
!  Codigo Fuente 
!=============================================================================== 
! 
!  Archivo :  elultimojedi.inf 
!  Fecha   :  2011/02/25 
!  Version :  1.111009 
!  Autor   :  Josevi Ruiz 
!  e-Mail  :  joruiru AT gmail DOT com 
! 
!  Descripcion: EL ULTIMO JEDI Lite Version (FICOMP 2011 Version). 
! 
!=============================================================================== 
! 
!  Log: 
!  2012/07/23  Joruiru - Se añade Jaxf Seval como el rival para jugar al Dejarik
!              en la cantina.
!  2012/05/29  Joruiru - Se añaden efectos ambientales aleatorios a la zona del
!              laberinto en Orvax IV. 
!  2012/05/06  Joruiru - Se mueve la gramática a un fichero separado. 
!  2011/12/09  Joruiru - Revisión de textos de la zona de Half-Axe. 
!  2011/10/24  Joruiru - Se migra el manejo de sonidos a DAMUSIX. 
!              Se añade el resto de temas de la BSO y algunos efectos ambientales.
!              Se añaden gráficos para el exterior de Cadgel Meadows.
!  2011/10/19  Joruiru - Se arregla un bug por el que si justo después de cambiar 
!              de localidad se redimensionaba la ventana del intérprete, se volvia
!              a la localidad anterior.
!              Se añade respuestas para encender y apagar el V-wing.
!              Se añade que no se de puntuación por entrar a Cadgel Meadows primero
!              por el muro y luego por la puerta o al revés. Ahora solo da la 
!              primera vez que se entra.
!              Se añade desambiguación entre el objeto genérico "naves" y el V-Wing.  
!  2011/10/09  Joruiru - Se añade desambiguación entre el soldado y la patrulla 
!              en la puerta de entrada al puerto espacial.  
!              Se añade mensaje más explicativo a EMPUJAR PALANCA
!              Se comprueba al intentar aterrizar el caza, que no esté ya en el
!              suelo.
!              Reportados por Comely
!  2011/10/06  Joruiru - Se añaden modificaciones para evitar síndrome de la  
!              palabra exacta y sordera del parser en algunos momentos.  
!              Se personalizan respuestas por defecto para evitar respuestas
!              ilógicas del parser.
!              Se añade objeto ficticio para que reaccione a MIRAR <localidad>
!              y no diga que "eso no es importante".
!              Reportados por Mastodon
!  2011/10/04  Joruiru - Se añaden modificaciones de Eliuk para poder mostrar 
!              las imágenes de los objetos. Se cambia la ventana donde se  
!              muestran a la izquierda, en vez de a la derecha. 
!              Añadidas algunas respuestas-pistas para ayudar en la conversacion
!              con el capitán de la Uhumele.
!              Añadidos temas de conversación en algunos PSIs
!              Añadidos 2 finales por caer en el lado oscuro.
!  2011/10/02  Joruiru - Se modifica Cortos.h y la rutina StrCmp para añadir 
!              el segundo parámetro a print_to_array para evitar el warning que 
!              salía en Glulxe de memory access. 
!  2011/09/30  Joruiru - Corrección de errores y presentación a FICOMP. 
!  2011/02/25  Joruiru - Se crea el archivo. 
! 
!-------------------------------------------------------------------------------
!
!===============================================================================
! (1) Constantes; Variables Globales; Replaces; Propertys; Incluir Parser.h
!-------------------------------------------------------------------------------
Constant Story "EL ULTIMO JEDI";
!Constant Headline "^(c)2011 Joruiru.^";
Constant Headline "^(c)2011 Joruiru.^^
                   Puedes teclear AYUDA en cualquier momento.^
                   Para HABLAR con otros personajes, utiliza ~>NOMBRE_PERSONAJE, LO QUE SEA~.^^";

Release 1;
Serial "111209";

! Queremos usar el comando 'salidas'
Constant ADMITIR_COMANDO_SALIDAS;

! Cuando el jugador gane se le preguntara si desea conocer algunas
! curiosidades sobre el juego
Constant AMUSING_PROVIDED;

! Ofrece 'deshacer el ultino movimiento' cuando el juego termine
! Constant DEATH_MENTION_UNDO;

! Los pronombres reflejaran solamente los objetos mencionados el jugador
! (el parser no deducira objetos implicitamente en las acciones)
! Constant MANUAL_PRONOUNS;

! No se podran usar los comandos 'OBJETOS' ni 'LUGARES'
! Constant NO_PLACES;

! Numero maximo de objetos que el jugador puede llevar directamente
! en el inventario (por defecto: 100)
! Constant MAX_CARRIED = 10;

! Un objeto contenedor que la libreria usara para guardar dentro objetos
! cuando el inventario del jugador llegue a su maxima de capacidad
! Constant SACK_OBJECT = mochila;

! Desactiva completamente el sistema de puntuacion del juego
! Constant NO_SCORE;

! Activa el sistema de puntuacion por tareas realizadas
! (ademas se debe crear un array llamado 'task_scores')
Constant TASKS_PROVIDED;

! Numero de tareas que el jugador debe realizar a lo largo
! del juego (por defecto: 1)
Constant NUMBER_TASKS = 11;

! Puntuacion maxima del juego (por defecto: 0)
Constant MAX_SCORE = 115;

Constant SGW_SIN_GRAFICOS;

! Puntuación que obtendra el jugador por cada objeto con puntuacion
! cuando lo coja por primera vez (por defecto: 4)
! Constant OBJECT_SCORE = 2;

! Puntaje que obtendra el jugador cuando entre en una localidad
! con puntuacion por primera vez (por defecto: 5)
! Constant ROOM_SCORE = 3;

! El array que contiene los puntos por cada tarea realizada
Array task_scores -> 10 5 15 10 5 15 5 20 15 5 10;

Include "Parser";
Include "Etemas";

!Propiedades
Property der_to;
Property izq_to;
Property del_to;

!Atributos
Attribute cortado;
Attribute nofuerza;
Attribute concentrado;
Attribute levitando;
Attribute forceable; !Para indicar si un objeto reacciona al uso de la Fuerza sobre él.
Attribute escondido; !Para indicar si el jugador no está a la vista de los enemigos.
Attribute descubierto; !Para indicar si el jugador ha sido descubierto por los enemigos.
Attribute estatico; !Para indicar que un PNJ no se puede mover.
Attribute muerto; !Para comprobar si después de un turno de combate, el PNJ ha muerto.
Attribute conocido; !Para indicar si un PNJ es conocido por el jugador o es un desconocido.
Attribute disfrazado; !Indica si el PJ va disfrazado o no.
Attribute objetivo; !Indica que un objeto puede ser atacado.
Attribute nosalidas; !Para no mostrar las salidas cuando estás en el caza.

!Variables
Global fase = 1;
Global bomo_sigue = 1; !1: Bomo sigue al PJ cuando se mueve. 0:Bomo no sigue al PJ cuando se mueve
Global caza_countdown = 20; !Se dan 20 turnos en el V-Wing para destruir la Valance. Cuando llegue a 0, el ejército clon destruye la nave con el PJ dentro.
Global planeta = 1; !1: Nuevo Plympto, 2: Orvax IV
Global mensajes_aleatorios = true; ! ELIUK: flag con el estado de los mensajes aletorio
! para el que marco de trabajo, al mostrar las imagenes de objeto, sepa si debe reactivar
! el temporizador glk o si no debe hacerlo.

!===============================================================================
! ELIUK: IMPORTANTE, VAMOS A HACER UN REPLACE DEL MARCO DE TRABAJO
! el motivo es que la imagen con deslizamiento ocupa el temporizador Glk
! para conseguir el efecto. Una vez que el efecto termina, el temporizador
! se detiene, y tus mensajes aleatorios no se mostraran mas a menos que
! el timer vuelva a ser activado y programado.
!------------------------------------------------------------------------------
Replace SGW_MarcoDeTrabajo; ! ESTO ES IMPORTANTE, PARA "PISAR" LA RUTINA ORIGINAL DE SGW+DMX
Replace viewImageSlide; !Para pintar la imagen pequeña a la izquierda de la pantalla
Replace drawImageSlide; !Para pintar la imagen pequeña a la izquierda de la pantalla
!===============================================================================


!===============================================================================
! (2) Puntos de Entrada para Glk [solo en Glulx]:
!     - InitGlkWindow(), IdentifyGlkObject(), HandleGlkEvent()
!-------------------------------------------------------------------------------
! Include "infglk"; ! ELIUK: SGW+DMX automaticamente incluye esta

[ HandleGlkEvent ev;
   ! HandleGlkEvent de libreria SGW
   SGW_HandleGlk(ev); 

   if (ev-->0 == evtype_Timer) {
     glk_cancel_line_event(gg_mainwin, gg_event);
     buffer-->0 = gg_event-->2;
     
     RandomMessages();
     
     !Se escribe el prompt y se espera el input de una linea
     print "^>> ";
     glk_request_line_event(gg_mainwin, buffer + WORDSIZE, INPUT_BUFFER_LEN - WORDSIZE, buffer-->0);
   }
   !return 2;
];

Constant SGW_CON_DAMUSIX;
Constant BORDEWIN = 5;
!Constant LIBACK = $000000;  ! estilo fondo linea de estado
!Constant LITEXT = CLR_GG_YELLOW;  ! estilo texto linea de estado
Constant SCUSR2 = CLR_GG_YELLOW;
Replace openGraphicWindow; !Se sobreescribirá esta rutina de sgw+dmx para abrir la ventana gráfica en modo proporcional

Include "sgw+dmx";           ! Incluir la extension SGW+DMX
Include ">elultimojedi.bli"; ! Incluir recursos multimedia (imagenes y sonidos)
Include "BajoNivel";
Include "Cortos";
Include "barra";
Include "Decorado";
!Include "array";          ! Necesario para escr
!Include ">Escr_NG.h";
Include "includes/Pistas.h";

!==============================================================================
! ELIUK: AHORA QUE SGW+DMX ESTA INCLUIDA, ES HORA DE HACER EL REEPLAZO
! REAL DE LA RUTINA DEL MARCO DE TRABAJO.  Lo que vamos a hacer es
! poner aqui una copia exacta de la rutina SGW_MarcoDeTrabajo(),
! incluyendo solo un pequeño cambio en la parte que muestra el grafico
! de objeto, para que, si los mensajes aleatorio estan activos, pues
! que se vuelva a programar el timer Glk. :)

  ! Centraliza las Actividades del Marco de Trabajo (aux == numero de actividad)
  [ SGW_MarcoDeTrabajo aux;
      ! SELECTOR DE LA ACTIVIDAD QUE DEBE REALIZAR EL MARCO DE TRABAJO
      switch (aux) {
        !------------------------------------------------------------------------
        ! ACTIVIDAD 1: Imagenes y Musica de Fondo automaticas para cada Localidad
        !------------------------------------------------------------------------
        1:
          if (current_loc == real_location) { return; }
          else {
            current_loc = real_location;
            #ifndef SGW_SIN_GRAFICOS;
              if (location == thedark) {
                #ifdef SGW_IMAGEN_OSCURIDAD;
                  viewImageCenter(SGW_IMAGEN_OSCURIDAD);
                #ifnot;
                  glk_window_set_background_color(gg_bigwin,SCBACK);
                  glk_window_clear(gg_bigwin);
                #endif; ! SGW_IMAGEN_OSCURIDAD
              }
              else {
                if (location provides sgw_img) {
                  viewImageCenter(location.sgw_img);
                }
                else {
	              !JV 19.10.2011: Se resetea la variable curr_pic de sgw+dmx por un bug por el que si justo 
                  !después de cambiar de localidad con imagen a otra sin imagen se redimensionaba la ventana 
                  !del intérprete, se volvia a pintar la imagen de la localidad anterior.
	              viewImageCenter(0);
	              !Fin JV 19.10.2011  
                  glk_window_set_background_color(gg_bigwin,SCBACK);
                  glk_window_clear(gg_bigwin);
                }
              }
            #endif; ! SGW_SIN_GRAFICOS

            if (real_location provides sgw_mus) {
              if (real_location provides sgw_vol) {
                #ifndef SGW_CON_DAMUSIX;
                  playSound(music,real_location.sgw_mus,-1,real_location.sgw_vol);
                #ifnot;
                  if (Damusix.SonandoDeFondo(real_location.sgw_mus) == 0) {
                    Damusix.AsignarCanal(real_location.sgw_mus,DAMUSIX_NCANALMAX-1,CalcVol(real_location.sgw_vol),-1);
                    Damusix.TocarCanal(DAMUSIX_NCANALMAX-1);
                  }
                  else { Damusix.Volumen(real_location.sgw_mus,CalcVol(real_location.sgw_vol)); }
                #endif; ! SGW_CON_DAMUSIX
              }
              else {
                #ifndef SGW_CON_DAMUSIX;
                  playSound(music,real_location.sgw_mus,-1,VOLUMEN_ALTO);
                #ifnot;
                  if (Damusix.SonandoDeFondo(real_location.sgw_mus) == 0) {
                    Damusix.AsignarCanal(real_location.sgw_mus,DAMUSIX_NCANALMAX-1,CalcVol(VOLUMEN_ALTO),-1);
                    Damusix.TocarCanal(DAMUSIX_NCANALMAX-1);
                  }
                  else { Damusix.Volumen(real_location.sgw_mus,CalcVol(VOLUMEN_ALTO)); }
                #endif; ! SGW_CON_DAMUSIX
              }
            }
            else {
              #ifndef SGW_CON_DAMUSIX;
                silenceChannel(music);
              #ifnot;
                Damusix.PararCanal(DAMUSIX_NCANALMAX-1); ! NOTA: usamos ultimo canal para musica de loc.
              #endif; ! SGW_CON_DAMUSIX
            }
          }
        !-----------------------------------------------------------------------
        ! = = = = = = = = = = = = = FIN DE ACTIVIDAD 1 = = = = = = = = = = = = =
        !-----------------------------------------------------------------------

        !-----------------------------------------------------------------------
        ! ACTIVIDAD 2: Imagenes automaticas al EXAMINAR cada Objeto
        !-----------------------------------------------------------------------
        2:
          if(action == ##Examine && noun provides sgw_img) {
            viewImageSlide(noun.sgw_img);
            ! =================================================================
            ! ELIUK: AQUI EL CAMBIO EN EL MARCO DE TRABAJO!!
            ! ELIUK: Hacemos aqui la comprobacion de mensajes aleatorio
            ! y si acaso es preciso reiniciar el temporizador Glk o no
            if (glk_gestalt(gestalt_Timer,0) == 1) {
                if (mensajes_aleatorios) { ! si los mensajes estan activados
                    ! ... entonces reiniciamos el temporizador para ellos
                    glk_request_timer_events(30000); ! ticks cada 30 segundos
                }
            }
            ! =================================================================
          }
          else {
            closeImageSlide();
          }
          ! NOTA: 'rfalse' necesario lo hacemos en la propia GamePostRoutine()
        !-----------------------------------------------------------------------
        ! = = = = = = = = = = = = = FIN DE ACTIVIDAD 2 = = = = = = = = = = = = =
        !-----------------------------------------------------------------------

        !=======================================================================
        default: rfalse; ! con numero de actividad incorrecto, no hacemos nada
      }
  ];
!===============================================================================
!Se sobreescribe esta rutina definida en sgw+dmx.h para abrir la ventana gráfica
!pequeña a la izquierda del texto y la imagen justificada abajo.
[ viewImageSlide imagen flag
    ancho_img i; ! todas son variables auxiliares
    !-------------------------------------------------------------------------------
    ! EVITAR WARNINGS EN COMPILACION PARA CODIGO Z O CON SGW_SIN_GRAFICOS
      imagen    = imagen;
      flag      = flag;
      ancho_img = i;      ! no importa alterar estas dos variables
    !-------------------------------------------------------------------------------
    #ifdef TARGET_GLULX;
      #ifndef SGW_SIN_GRAFICOS;
        ! si no se pueden pintar graficos...
        if (glk_gestalt(gestalt_Graphics,0) == 0) { return; } ! no hacemos nada

        ! primero cerramos la ventana, por si acaso
        closeImageSlide();

        ! si la imagen no existe...
        if (imagen == 0) { return; } ! terminamos con error

        ! calculamos ancho de la imagen para abrir una ventana apropiada
        glk_image_get_info(imagen,gg_arguments,gg_arguments+WORDSIZE);
        ancho_img = gg_arguments-->0;

        gg_objwin = 0; ! por si acaso (uno nunca sabe... =P)
        ! intentamos abrir la ventana con ancho suficiente para la imagen
        gg_objwin = glk_window_open(gg_mainwin,winmethod_Left+winmethod_Fixed,
          ancho_img+(BORDEWIN*2),wintype_Graphics,GG_OBJWIN_ROCK);

        ! si la ventana no se ha creado con exito...
        if (gg_objwin == 0) { return; } ! terminamos con error

        ! guardamos la imagen actual de la ventana de slide
        curr_obj_pic = imagen;

        ! si hay un Fade activo de Damusix, forzar "no-deslizamiento"
        #ifdef SGW_CON_DAMUSIX;
          if (Damusix.EnFade()) { flag = 1; }
        #endif; ! SGW_CON_DAMUSIX

        ! si queremos el efecto de deslizamiento
        if (~~flag) {
          ! metemos la imagen
          for (i=0 : i<=ancho_img : i=i+4) { ! NOTA: no cambiar el incremento de 'i'
            drawImageSlide(i);    ! pintamos la imagen
            slideViewPausa(15,i); ! hacemos la pausa (importante 'i')
          }
        }
        ! NO BORRAR: para corregir pequeño error de calculo en la posicion final
        ! de la imagen. (El error sucede por 'i=i+4' [mirar "metemos la imagen"],
        ! al final 'i' puede ser mayor que 'ancho_img' y no se ejecuta dibujado
        ! en la posicion final correcta. Con esto lo arreglamos.)
        drawImageSlide(ancho_img);

        ! si queremos el efecto de deslizamiento
        if (~~flag) {
          ! mostramos imagen durante 3 segundos para que se pueda observar
          slideViewPausa(3000,ancho_img); ! (importante 'ancho_img')
          !--------------------------------------------------------------------
          ! sacamos la imagen
          for (i=ancho_img : i>=0 : i=i-4) { ! NOTA: no cambiar el decremento de 'i'
            drawImageSlide(i);    ! pintamos la imagen
            slideViewPausa(15,i); ! hacemos la pausa (importante 'i')
          }
          ! NO BORRAR: para corregir pequeño error de calculo en la posicion final
          ! de imagen. (El error sucede por 'i=i-4' [mirar "sacamos la imagen"],
          ! al final 'i' puede ser menor a cero y no se ejecuta dibujado en la
          ! posicion final correcta. Con esto lo arreglamos.)
          drawImageSlide(-1*BORDEWIN);    ! VALOR NEG. PARA COMPENSAR RESTA INTERNA
          slideViewPausa(15,-1*BORDEWIN); ! IMPORTANTE, NO BORRAR
          !--------------------------------------------------------------------
          ! finalmente cerramos la ventana. Happy!! =D
          closeImageSlide();
        }
        ! AVISO: si el programador no quiere efecto de deslizamiento (activando flag),
        ! entonces debe encargarse el mismo de cerrar la ventana con closeImageSlide()
      #endif;
    #endif;
];

!Se sobreescribe esta rutina definida en sgw+dmx.h para abrir la ventana gráfica
!pequeña a la izquierda del texto y la imagen justificada abajo.
[ drawImageSlide pos ! se restara a la posicion actual
    alto_img ancho_win alto_win; ! todas son variables auxiliares
    !-----------------------------------------------------------------------
    ! calculamos el alto de la imagen
    glk_image_get_info(curr_obj_pic,gg_arguments,gg_arguments+WORDSIZE);
    alto_img = gg_arguments-->1;
    ! calculamos el tamaño de la ventana
    glk_window_get_size(gg_objwin,gg_arguments,gg_arguments+WORDSIZE);
    ancho_win = gg_arguments-->0;
    alto_win  = gg_arguments-->1;
    !-----------------------------------------------------------------------
    ! ponemos el color de fondo para la ventana
    glk_window_set_background_color(gg_objwin,SCBACK);
    ! limpiamos la ventana con el color de fondo
    glk_window_clear(gg_objwin);
    ! finalmente pintamos la imagen en la posicion que corresponde (y borde)
    glk_image_draw(gg_objwin,curr_obj_pic,(ancho_win-BORDEWIN)-pos,(alto_win-alto_img)/1);
];


!===============================================================================
! (3) Modificar Mensajes de la Libreria; Otros Includes; Incluir VerbLib.h
!-------------------------------------------------------------------------------
Object LibraryMessages
  with
    before [ ;
      Prompt:
        print "^>> ";
        rtrue;
      Miscellany:
        !Para que el parser no escriba el mensaje por defecto si tratamos de coger la Fuerza
        if (lm_n == 26 && lm_o == oFuerza) {
	        give oFuerza nofuerza; 
	        rtrue;
        };
        !Mensaje de muerte
        if (lm_n == 3) {
	        print " Mueres debido a las heridas sufridas ";rtrue;
        };
    ],
;

!Se sobreescribe esta rutina definida en sgw+dmx.h para abrir la ventana gráfica
!en modo proporcional, así se redimensionan automáticamente los gráficos al modificar
!el tamaño de la ventana del interprete donde se ejecuta la aventura
[ openGraphicWindow h;
    !---------------------------------------------------------------------------
    ! EVITAR WARNINGS EN COMPILACION PARA CODIGO Z O CON SGW_SIN_GRAFICOS
      h = h;
    !---------------------------------------------------------------------------
    #ifdef TARGET_GLULX;
      #ifndef SGW_SIN_GRAFICOS;
        ! si la ventana grafica superior ya existe, primero la cerramos
        closeGraphicWindow();
        !---------------------------------------------------------------------------
        ! si la altura para abrir la ventana es cero...
        if (h == 0) { return; } ! no hacemos nada y retornamos
        !---------------------------------------------------------------------------
        ! IMPORTANTE: Recordamos altura para poder recuperar vent. al cargar partida
          bigwin_alto = h;
        !---------------------------------------------------------------------------
        !===========================================================================
          h = h+(BORDEWIN*2); ! suma 20px = borde sup. e inf. de 10px (por estetica)
        !---------------------------------------------------------------------------
        ! NOTA SOBRE EL '+(BORDEWIN*2)': La rutina que dibuja los graficos en la
        ! ventana deja siempre por defecto un borde de 10px alrededor de la imagen
        ! (solo por estetica), por lo tanto la imagen se dibujara siempre con 20px
        ! menos de altura. Para compensar esto y que la imagen se dibuje realmente
        ! con su tamaño original, sumamos 20px al propio tamaño de la ventana
        ! grafica. Asi, si defines una ventana de 100px (por ejemplo), entonces
        ! se creara una ventana con una altura efectiva de 120px realmente. Con
        ! estos 20px adicionales, nuestra imagen ya tendra espacio para dibujarse
        ! con su altura "real". Si no te gusta este comportamiento, define la
        ! constante BORDEWIN con valor cero antes de incluir SGW+DMX...
        ! Ejemplo: Constant BORDEWIN = 0;
        !===========================================================================
        !---------------------------------------------------------------------------
        ! si la ventana grafica superior no existe, ahora la abrimos
        if (gg_bigwin == 0) {
          gg_bigwin = glk_window_open(gg_mainwin,
            (winmethod_Above+winmethod_Proportional), h, wintype_Graphics, GG_BIGWIN_ROCK);
        }
        ! si la ventana grafica superior no se ha creado con exito...
        if (gg_bigwin == 0) { return; } ! no hacemos nada y retornamos
        !---------------------------------------------------------------------------
        ! Pintamos el fondo de la ventana grafica con el color que corresponde
        glk_window_set_background_color(gg_bigwin,SCBACK);
        glk_window_clear(gg_bigwin);
      #endif;
    #endif;
];

! Demostracion de uso de una Libreria de Extension: incluyendo 'SmartCantGo'
! se listaran las salidas de la localidad actual de una manera mas clara en
! vez del 'No puedes ir por ahi' cuando se escribe una direccion sin salida
! Include "SmartCantGo";

Include "VerbLib";

!===============================================================================
! (4) Rutina Initialise()
!-------------------------------------------------------------------------------
[ Initialise k;
    ! Lugar de comienzo.
    location = paso;
    move oBomo to location;
    

    ! Activamos esta variable para que la descripción de los lugares
    ! se repita siempre, incluso si el jugador ya ha estado alli.
    lookmode = 2;
    
    !PNJMovil
    StartDaemon(oBomo);
    PNJ_Ruta(oBomo, MOVIMIENTO_NINGUNO);
    
    StartDaemon(oSoldado);
    
    !Inicializamos los graficos y sonidos
    initializeSGW(40); !45% + 5 de BORDERWIN por defecto (x2) equivale al 55% de la pantalla principal.
    
    ! ELIUK: POR ESTETICA, CERRAMOS LA VENTANA GRAFICA DURANTE LA INTRO
    closeGraphicWindow();
    
   !Escena de introducción
   !TitlePage();
   !print "Pulsa (1) para ver la intro o (2) para saltarla...^^";
#ifdef SGW_SIN_GRAFICOS; 
   !print "Pulse (G) para ver la introducción gráfica, (T) para ver la introducción textual o (S) para saltarla...^^";
   print "Pulse (I) para ver la introducción o (S) para saltarla...^^";
   
   !while (k ~='t' or 'g' or 's') k=Esperartecla();
   while (k ~='i' or 's') k=Esperartecla();
   borrarPantalla();
   !if (k=='t') TitlePage();
   if (k=='i') TitlePage();
   if (k=='g') TitlePageGraphic();
#endif;     
#ifndef SGW_SIN_GRAFICOS; 
   print "Pulse (G) para ver la introducción gráfica, (T) para ver la introducción textual o (S) para saltarla...^^";
   !print "Pulse (I) para ver la introducción o (S) para saltarla...^^";
   
   while (k ~='t' or 'g' or 's') k=Esperartecla();
   !while (k ~='i' or 's') k=Esperartecla();
   borrarPantalla();
   if (k=='t') TitlePage();
   !if (k=='i') TitlePage();
   if (k=='g') TitlePageGraphic();
#endif;
    ! ELIUK: AHORA NUEVAMENTE LA VOLVEMOS A ABRIR
    openGraphicWindow(40); !45% + 5 de BORDERWIN por defecto (x2) equivale al 55% de la pantalla principal.
    
    !Se cambia el objeto jugador
    player = mySelfObj;
    
    !Objetos iniciales del jugador  
    move oSableLaser to player;
    
!     move oVwing to location;
!         move oTrajeTrooper to player;
!                 give oTrajeTrooper worn;
!             give player disfrazado;

    
    ! ARRANCAMOS EL TEMPORIZADOR DE GLK
    ! el interprete puede manejar el Timer?
    if (glk_gestalt(gestalt_Timer,0) == 1) {
        glk_request_timer_events(30000); ! ticks cada 30 segundos
    }

     !viewImageCenter(grfCap07);
    
    ! Mensaje de Bienvenida
    print "~Durante más de mil generaciones, los caballeros Jedi fueron los guardianes de la paz y la justicia en la Antigua República,
      antes de estos tenebrosos tiempos, antes del Imperio.~",(s_underline)"^- Ben Kenobi -^^";
    
    !print "~Es el momento que esperábamos... Ejecute la orden 66.~^^^^^^^^^^^";
    
    !print "Comandante Vill:^";
    !print (s_underline) "~¡No caigáis otra vez en la misma trampa!~^";
    !print (s_underline) "~¡Apuntad al siguiente árbol!~^^^^^^^^^^";
    !print (s_reverse) "^¡¡¡BOOOOOOOMMMMMMMMM!!!^^^^^^^^^^^^^";
      
    !EsperarTecla("...");
    faseorvax4();

 
];


!===============================================================================
! (5) Rutinas de la Libreria Implementadas, Reemplazadas o Ampliadas
!-------------------------------------------------------------------------------
! Necesaria para imprimir el nombre de cada tarea dada
[ PrintTaskName tarea;
    switch(tarea) {
      0: "Detener el avance del ejército.";
      1: "Salir del agujero.";
      2: "Sacar a Bomo del agujero.";
      3: "Conseguir un traje de soldado clon.";
      4: "Entrar en Cadgel Meadows saltando el muro.";
      5: "Entrar en Cadgel Meadows por la entrada principal.";
      6: "Descubrir a la Valance.";
      7: "Hablar con el Comandante Vill.";
      8: "Entrar a la Uhumele.";
      9: "Robar un caza.";
      10: "Destruir la Valance.";
    }
];

! Imprime el rango que el jugador a conseguido de acuerdo a la
! puntuacion que tiene actualmente
[ PrintRank ;
    print ", otorgándote el rango de: ~";
!     switch (score) {
!       0: print "Iniciado";
!       50: print "Padawan";
!       100: print "Caballero Jedi";
!       150: print "Maestro Jedi";
!       200: print "Gran Maestro Jedi";
!     }
    if (score<50) print_ret "Iniciado~.";
    if (score<100) print_ret "Padawan~.";
    if (score<150) print_ret "Caballero Jedi~.";
    if (score<200) print_ret "Maestro Jedi~.";
    if (score>199) print_ret "Gran Maestro Jedi~.";
    print_ret "~.";
];

! Imprime las curiosidades
[ Amusing ;
    closeGraphicWindow();
    "Ésta es la versión Lite de EL ULTIMO JEDI para la FICOMP 2011, que se corresponde, aproximadamente, con un tercio de la historia completa. 
    ^Actualmente se está desarrollando una versión extendida, con la historia desarrollada completamente, nuevos puzles, gráficos y sonidos.
    ^El equipo de desarrollo no puede dar una fecha de publicación, pero esperamos que sea lo antes posible...
    ^^¿Conseguirá Dass Jennir encontrar y rescatar a la familia de su buen amigo Bomo Greenbark? ¿La búsqueda le costará perder los valores propios
    de los Jedi y se verá arrastrado irremediablemente al lado oscuro de la Fuerza?
    ^^Información y trasfondo:
    ^- http://starwars.wikia.com.
    ^- http://www.loresdelsith.net.
    ^- Star Wars: Republic.
    ^- Star Wars: The Path to Nowhere.
    ^- Star Wars: The Revenge of the Sith.
    ^- Star Wars: Purgue.
    ^- Dark Lord: The Rise of Darth Vader.
    ^^Banda Sonora Original (en la versión extendida):
    ^- El Último Jedi Main Theme (J.Carlos Martínez).
    ^- Bomo's Sorrow Theme (J.Carlos Martínez).
    ^- Comandante Vill Theme (J.Carlos Martínez).
    ^- V-Wing Theme (J.Carlos Martínez).
    ^- Efectos ambientales y sonoros (http://www.freesfx.co.uk).
    ^^Gráficos (en la versión extendida):
    ^- J.A.E.
    ^^Programación:
    ^- Joruiru.
    ^^Desarrollado en INFSP6 (Inform6 in Spanish). Se han usado las siguientes librerias:
    ^- Damusix, de Eliuk Blau.
    ^- sgw+dmx, de Eliuk Blau.
    ^- Etemas,  de Zak.
    ^- BajoNivel, de Zak (adaptación).
    ^- Cortos, de Zak (adaptación).
    ^- Barra v2, de Presi.
    ^- PNJMovil, de Zak.
    ^- intnombre, de Jarel.
    ^- ZIPI, de Zak (adaptación).
    ^- Decorado, de Zak y Mel Hython.";
];

!Ponemos en el alcance a Bomo cuando esté en el agujero y nosotros fuera
!para poder sacarlo usando la Fuerza
[ InScope person;
  if (person == player && location == ladera2 && oBomo in agujero)
      PlaceInScope(oBomo);
  if (person == player && location == CazaVwingS) {   
      PlaceInScope(oNuitedes);
      PlaceInScope(oValance);
      PlaceInScope(oVindus);
  }
  if (person == player && location == CazaVwingE) {   
      PlaceInScope(oSolaine);
      PlaceInScope(oAeolus);
      PlaceInScope(oUhumele);
  }
  if (person == player && location == CazaVwingO) {
      PlaceInScope(oThorene);  
      PlaceInScope(oHaltia);
      PlaceInScope(oDzina);
  }
  if (person == player && (location == hangarEste or interiorUhumele) && oCrys has muerto) {
      PlaceInScope(oCrysInconsciente);  
  }

  rfalse;
];

[ DeathMessage;
glk_request_timer_events(0); ! desactivamos los mensajes aleatorios
      if (deadflag == 3) {
        print " Has sucumbido al Lado Oscuro de la Fuerza ";
      }
      if (deadflag == 4) {
        print " Has sucumbido al Lado Oscuro de la Fuerza ";
      }
      if (deadflag == 5) {
        print " Bomo y tú morís atravesados por los disparos ";
      }
      if (deadflag == 5) {
        print " Mueres en la explosión de la nave ";
      }
];

!===============================================================================
! (6) Incluir SpanishG.h; Otros Includes
!-------------------------------------------------------------------------------
Replace ParseNoun; 
Include "SpanishG";
Include "intnombre.h";

!===============================================================================
! (7) Clases del Juego
!-------------------------------------------------------------------------------
Class Lugar
 with describe [;
        print (string) self.description;
        print "^";
        if (self hasnt nosalidas) <<Salidas>>;
    ],
    after [;
      go: if (bomo_sigue==1) PNJ_Ruta(oBomo, MOVIMIENTO_POR_META, self);rfalse;
    ],
     number,
has light;

Class GuardiaOrvax4 
  with
    name 'guardia' 'guardias',
    short_name "guardias de la ciudad",
    description [;
      switch(self.multiple){
	      1: "Un guardia de la ciudad.";
	      2: "Dos guardias de la ciudad.";
	      3: "Tres guardias de la ciudad.";
	      4: "Cuatro guardias de la ciudad.";
	      5: "Cinco guardias de la ciudad.";
	      6: "Seis guardias de la ciudad.";
	      7: "Siete guardias de la ciudad.";
	      8: "Ocho guardias de la ciudad.";
	      9: "Nueve guardias de la ciudad.";
	      10: "Diez guardias de la ciudad.";
      }
      rtrue;
    ],
    bonif_defensiva 10,
    bonif_ofensiva 10,
    vida 25,
    topvida 25,
    dado_golpe 2 6 0, !1d6+0
    multiple 2,
    !name_boss "el capitán",
    name_tropa "un guardia",
    printname [nom;
      nom="";
      if (self.multiple>1) nom= self.name_tropa;
      else {
	      if (self provides name_boss ) nom=self.name_boss;
	      else nom=self.name_tropa;
      } 
      return nom;
    ],
    printcasename [nom;
      nom="";
      if (self.multiple>1) nom= Cap(self.name_tropa);
      else {
	      if (self provides name_boss) nom=Cap(self.name_boss);
          else nom=Cap(self.name_tropa);
      }
      return nom;
    ],
    life [;
	  Attack: !"Son demasiado numerosos para un ataque directo contra ellos.";
	          give self estatico;
	          move player to parent(self);
	          if (second == nothing) 
	            multi_combate(player,self,oSableLaser);
	          else
	            multi_combate(player,self,second);
	          viewImageSlide(pngSablesLuz);
	          if (self has muerto) {
		        move self to limbo;
		        give player ~descubierto;
	          }
              rtrue;
	  Answer,ask,tell: print "Sin mediar palabra, los guardias se lanzan a por ti.^";
	          give self estatico;
	          move player to parent(self);
	          multi_combate(player,self,oSableLaser);
	          viewImageSlide(pngSablesLuz);
	          if (self has muerto) {
	            move self to limbo;
	            give player ~descubierto;
	          }
              rtrue;
    ],
    orders [;
      Mild, Strong: <<Ask self>>;
      NotUnderstood, Tell: <<Ask self>>;
    ],
    before [;
        Sentir, Concentrar: "La Fuerta está presente en el interior de todos los seres vivos.^";
        Levitar: "En estos tiempos oscuros que corren no parece buena idea alardear en público de tus poderes jedi.^";
	    Push, Aturdir: !"Hay demasiados soldados para usar la Fuerza contra ellos.^";
	                   give self estatico;
	                   move player to parent(self);
                       multi_combate(player,self,oFuerza);
                       viewImageSlide(pngSablesLuz);
	                   if (self has muerto) {
		                 move self to limbo;
		                 give player ~descubierto;
	                   }
	                   rtrue;
        Enganyar: print "Guardia: ",(s_underline) "~¿Acaso te crees un jedi intentando esos truquitos?~^"; rtrue;
    ],
has pluralname animate;

Include "pnjmovil";
!===============================================================================
! (8) Objetos del Juego
!-------------------------------------------------------------------------------
Lugar limbo "limbo"
  with
    name 'limbo',
;
! Objeto para que reaccione a <<Mirar <nombre localidad>>>
Object oLocGenerico "lugar"
with
    name 'lugar' 'sitio' 'suelo' 'cuartel' 'paso' 'desfiladero' 'camino' 'puerto' 'cadgel' 'meadows' 
         'hangar' 'hangares' 'darth' 'vader' 'lord' 'rio' 'tripulantes',
    name_f 'pista' 'ladera' 'cima' 'cabina' 'montana' 'montanas' 'vegetacion' 'planta' 'plantas' 'agua' 'tripulacion',
    description [w;
        wn = 2;
        w=NextWord();
        if (w=='el' or 'la' or 'los' or 'las') w=NextWord();
        switch (w) {
	        'lugar':<<look>>;
	        'sitio':<<look>>;
	        'suelo':<<look>>;
	        'desfiladero': switch (location) {
	                         paso,
	                         ladera,ladera2,cima: "El desfiladero de Half Axe es un estrecho paso entre montañas que discurre de norte a sur.
	                             Pequeños arroyos bajan de las montañas y se unen cuando llegan al paso, formando un río que se 
	                             pierde por el sur. Árboles colosales y abundante vegetación crecen a ambas orillas del río.";
	                         default: "Desde aquí no puedes ver ningún desfiladero.";
                           }
	        'paso': switch (location) {
	                   paso: "El desfiladero de Half Axe es un estrecho paso entre montañas que discurre de norte a sur.
	                          Pequeños arroyos bajan de las montañas y se unen cuando llegan al paso, formando un río que se 
	                          pierde por el sur. Árboles colosales y abundante vegetación crecen a ambas orillas del río.";
	                   ladera,ladera2,cima: "El paso está en lo más bajo de Half Axe.";
	                   default: "Desde aquí no puedes ver eso que dices.";
                     }
            'planta', 'plantas',
            'vegetacion': switch (location) {
	                        paso,
	                        ladera: "La abundante vegetación crece fuerte y alta a ambas orillas del río que discurre por el desfiladero.
	                              Dificulta el avance de los soldados, pero no frena a los tanques imperiales.";
	                        ladera2: "La abundante vegetación crece fuerte y alta a ambas orillas del río que discurre por el desfiladero.";
	                        cima,
	                        camino: "Verde y frondosa, aunque menos abundante que en el paso de Half-Axe.";
	                        default: "Desde aquí no puedes ver eso que dices.";
                          }
            'agua', 
	        'rio': switch (location) {
	                   paso: if (oArboles has cortado) "El río discurre a lo largo de todo el Paso de Half-Axe, perdiéndose por el sur.";
	                        "El río discurre a lo largo de todo el Paso de Half-Axe. Tan sólo cambia su curso, cerca de las zona por la que
	                         están cruzando las tropas imperiales, para rodear uno de los enormes árboles que ha crecido junto al río.";
	                   ladera,ladera2,cima: "El río está en lo más bajo de Half Axe, discurriendo de norte a sur.";
	                   default: "Desde aquí no puedes ver ningún rio.";
                     }
	        'ladera': switch (location) {
	                   paso: "La ladera sube hasta la cima de Half Axe.";
	                   ladera,ladera2: <<look>>;
	                   cima: "La ladera baja hasta el paso de Half Axe.";
	                   default: "Desde aquí no puedes ver eso que dices.";
                     }
            'montana',
            'montanas': switch (location) {
	                      paso: "Escarpadas montañas tanto a este como a oeste limitan el acceso al estrecho desfiladero de Half-Axe.";
	                      ladera,ladera2: "Escarpadas montañas tanto a este como a oeste limitan el acceso al estrecho desfiladero de Half-Axe.";
	                      cima: "Escarpadas montañas tanto a este como a oeste limitan el acceso al estrecho desfiladero de Half-Axe.";
	                      default: "Desde aquí no puedes ver las montañas.";
                        } 
	        'cima': switch (location) {
	                   paso,
	                   ladera,ladera2: "La cima está en lo más alto de Half Axe.";
	                   cima: <<look>>;
	                   camino: "La cima está en lo más alto de Half Axe.";
	                   default: "Desde aquí no puedes ver eso que dices.";
                     }
            'camino': switch (location) {
	                    cima: "El camino lleva hacia el este.";
	                    camino: <<look>>;
	                    extOeste: "El camino lleva hacia Half Axe.";
	                    default: "Desde aquí no puedes ver eso que dices.";
                      }
            'cadgel','meadows',
            'puerto': switch (location) {
	                   extOeste,extNorte,extEste,extSur: <<look>>;
	                   pista:<<look>>;
	                   hangarNorte,hangarSur,hangarEste,hangarOeste: <<look>>;
	                   CazaVwing,CazaVwingN,CazaVwingS,CazaVwingE,CazaVwingO,CazaVwingP: <<look>>;
	                   default: "Desde aquí no puedes ver eso que dices.";
                     }
            'pista': switch (location) {
	                   pista:<<look>>;
	                   hangarNorte,hangarSur,hangarEste,hangarOeste: "Desde aquí puedes ver que la pista está vacía.";
	                   CazaVwing,CazaVwingN,CazaVwingS,CazaVwingE,CazaVwingO,CazaVwingP: <<look>>;
	                   default: "Desde aquí no puedes ver eso que dices.";
                     }
            'tripulantes',
            'tripulacion': switch (location) {
	                         interiorUhumele: "La Uhumele tiene 7 tripulantes, incluido el capitán.";
	                         default: "Desde aquí no puedes ver ninguna tripulacion.";
                           }
            'hangares',
            'hangar': switch (location) {
	                   pista: "Desde aquí puedes ver los hangares en cualquier dirección.";
	                   hangarNorte,hangarSur,hangarEste,hangarOeste: <<look>>;;
	                   CazaVwing,CazaVwingN,CazaVwingS,CazaVwingE,CazaVwingO,CazaVwingP: <<look>>;
	                   default: "Desde aquí no puedes ver eso que dices.";
                     }
            !'agujero' : if (location == agujero) <<look>>; else "Desde aquí no puedes ver eso que dices.";
            'cuartel' : if (location == CuartelMando) <<look>>; else "Desde aquí no puedes ver eso que dices.";
            'cabina': if (location==CazaVwing or CazaVwingN or CazaVwingS or CazaVwingE or CazaVwingO or CazaVwingP) <<look>>;
	                  else "Desde aquí no puedes ver eso que dices.";
	        'darth','vader','lord': if (location == CuartelMando) "No te ha dado tiempo a fijarte demasiado."; 
	                                else "Desde aquí no puedes ver eso que dices.";
            default : "Desde aquí no puedes ver eso que dices.";
        };
    ],
    found_in [;
      if (planeta == 1) rtrue;
      else rfalse;
    ],
    before [;
        Examine: rfalse;
        default: print "Después de estudiar las posibilidades, llegas a la conclusión de que sería una tonteria ";LanguageVerb(verb_word);print " eso.";
                 rtrue;    
    ],
has scenery concealed;

Object barra_estado
  class objeto_barra_estado
  with
    modo BE_COMPUESTO,
    disposicion
      1  1 true BE_LOCALIDAD
      67 1 true BE_TURNOS,
    lineas_inv
      BE_INV_TOTAL;

!Para mover la palanca en estas direcciones
CompassDirection derecha_obj "derecha" compass
  with name 'derecha', door_dir der_to;

CompassDirection izquierda_obj "izquierda" compass
  with name 'izquierda', door_dir izq_to;

CompassDirection delante_obj "delante" compass
  with name 'delante' 'alante' 'adelante', door_dir del_to;

!Objeto jugador (sustituye al player por defecto)  
Object  mySelfObj "(self object)"
  with  short_name  [;  return L__M(##Miscellany, 18); ],
        !description [;  return L__M(##Miscellany, 19); ],
        description [;
                    print "Eres Dass Jennir, un antiguo general de la Orden Jedi. Llegaste a Nuevo Plympto como general
                    del ejército de la República para luchar contra los separatistas Nosaurianos y su ejército
                    de droides.^Pero, tras la aplicación de la Orden 66, fuiste traicionado por tus propias tropas,
                    logrando escapar de la muerte por los pelos. Tus antiguos enemigos nosaurianos te escondieron, 
                    y ahora lideras su resistencia frente a la invasión del ejército imperial.^^";
                    print "Te quedan ",self.vida," puntos de vida de un total de 50.^";
                    rtrue;
        ],
        before NULL,
        after NULL,
        life NULL,
        each_turn NULL,
        time_out NULL,
        describe NULL,
        add_to_scope oFuerza oMiTraje, !Ponemos la Fuerza siempre al alcance del jugador
        capacity 100,
        parse_name 0,
        orders [;
                if (actor ~= player) rfalse;
                inv: rfalse;
                ThrowAt: rfalse;
                Drop: rfalse;
                Levitar: if (self has concentrado) "Estás demasiado concentrado ahora mismo para hacer cualquier otra cosa.^"; 
                         if (noun ~= player) rfalse;
                         "Un jedi es incapaz de levitarse a si mismo. Volar no entra entre los poderes que proporciona la Fuerza.^";
               Sanar: if (self has concentrado) {
	                     print "Estás demasiado concentrado ahora mismo para hacer cualquier otra cosa.^";
	                     rtrue;
                      }
                      if ((noun ~= player) && (noun ~= nothing)) rfalse;
                      print "Te concentras en ti mismo y notas como fluye la Fuerza, sanándote por completo.^";
                      self.vida = 50;
                      rtrue;
!                 Attack: give noun estatico;
!                         if (second == nothing) 
!                           turno_combate(self,noun,oSableLaser);
!                         else
!                           turno_combate(self,noun,second);
!                         rtrue;
                default: if (self has concentrado) {
	                         print "Estás demasiado concentrado ahora mismo para hacer cualquier otra cosa.^";
	                         rtrue;
                         } else {
	                         rfalse;
                         }
               ],
        number 0,
        before_implicit NULL,
        bonif_defensiva 15,
        vida 50,
        oscuro 0,
has concealed animate proper transparent;

Object oMiTraje "mi traje"
  with
    !name 'mi' 'tu',
    parse_name [w1 w2;
      w1=NextWord();
      w2=NextWord();
      if ((w1=='mi' or 'tu') && w2=='traje' or 'ropa') return 10;
      if (w1=='traje' && ((oTrajeTrooper has worn) || TestScope(oTrajeTrooper,player))) return -1;
      if (w1=='traje' or 'ropa') return 1;
      return 0;
    ],
    description "Es tu traje de Jedi.",
    before [;
      wear: "Ya lo llevas puesto.";
      disrobe: if (oTrajeTrooper has worn) print "Llevas puesto el traje de soldado clon.";
               "Te quedarías desnudo.";
    ],
has clothing worn;

Object oFuerza "Fuerza"
  with
    name 'fuerza' ,
    sgw_img pngYoda, ! el grafico del objeto
    bonif_ofensiva 30,
    dado_golpe 2 6 6, !2d6+6
    description [;
	    switch(random(10)) {
	      1: print "La Fuerza es lo que le da al Jedi su poder. Es un campo de energía creado 
	                por todas las cosas vivientes. Nos rodea, nos penetra, y mantiene unida la Galaxia.";
	      2: print "Un misterio infinito la Fuerza es. Mucho por aprender aún queda.";
	      3: print "La fortaleza de un Jedi fluye de la Fuerza. Pero cuidado con el lado oscuro: Ira, 
	                temor, agresión; del lado oscuro de la Fuerza son. Fácil fluyen rápidos a unirse en el 
	                combate. Si una vez tomas el sendero del lado oscuro, para siempre dominará tu destino. 
	                Consumirá tu voluntad, como hizo con el alumno de Obi-Wan.";
	      4: print "Su energía nos rodea y nos une.";
	      5: print "Mi aliada es la Fuerza y es un poderoso aliado, la vida la crea, y la hace crecer, su 
	                energía nos rodea a todos y nos une, luminosos seres somos. Debes sentir La Fuerza a tu 
	                alrededor, aquí, entre tu y yo, y el árbol y la roca, incluso entre la tierra y la nave.";
	      6: print "De la no-vida, vino la vida; de la materia muerta, vino el espíritu. Con la vida vino la 
	                percepción de la belleza y la fealdad, de la serenidad y del temor. La Fuerza creció en 
	                fortaleza al crecer en fortaleza la vida: La vida es la manera de percibirse a sí mismo 
	                del universo; la Fuerza es la fortaleza de su percepción.";
	      7: print "La Fuerza debe ser usada para salvar vidas no para quitarlas.";
	      8: print "La Fuerza nunca deberá ser usada para obtener beneficios personales.";
	      9: print "No tengas miedo de usar la Fuerza, es una herramienta igual que el sable de luz.";
	      10: print "Escucha a la Fuerza. Está a tu lado y te avisará cuando cometas un error.";
	    };
	    rtrue;
    ],
     before [ ;
       take: if (self has nofuerza) {
	           keep_silent=true;
	           rfalse;
             }
             print "La Fuerza no se puede coger. Su energía nos rodea y nos une."; 
             rtrue;
       Taste, Touch: "La Fuerza sólo se puede sentir.";
       UsoFuerza:if (noun == oBomo && oBomo in agujero) {
! 	                  move oBomo to location;
! 	                  print "^Usando el poder de la Fuerza, consigues levitar a Bomo y sacarlo del agujero.^";
! 	                  Corto_FinFase1.proyeccion();
!                       EsperarTecla("[Pulsa una tecla]^");
!                       BorrarPantalla();
! 	                  fase = 3;
	                  !<<levitar oBomo>>;
	                  !rtrue;
                   "Seguramente lo que quieres es LEVITAR a Bomo para sacarlo del agujero.";
                 }
                 "Un Jedi no debe usar la Fuerza para beneficio propio.";
       Examine: rfalse; ! ELIUK: IMPORTANTE, si no la listas, pasa a "default".
       ! Esta es la correccion para permitir que de todas manera se ejecute ##Examine.
       ! Si ##Examine no llega a ejecutar, entonces no se muestra imagen de objeto ni
       ! se imprime ninguno de los mensajes aleatorios que has puesto en rutina
       ! description() mas arriba. Error en tu codigo. ;)
       Sentir: <<examine self>>; ! ELIUK: AHORA SI, SE EJECUTA ESTA LINEA.
       default: "La Fuerza sólo se puede sentir. Su energía nos rodea y nos une.";
     ],
     after [ ;
       Take: move self to limbo;
             keep_silent=false;
             give self ~nofuerza;
     ],

has female nofuerza;

Object oSableLaser "Sable Laser"
  with
    name 'sable' 'espada' 'laser',
    bonif_ofensiva 10,
    dado_golpe 2 6 6, !2d6+6
    description [;
      switch(random(3)) {
        1: print "El arma formal de un Caballero Jedi. Se requiere más habilidad que sólo la vista para usarlo. Un arma elegante.";
        2: print "El cristal es el corazón de la hoja. El corazón es el cristal del Jedi. El Jedi es el cristal de la Fuerza. 
                  La Fuerza es la hoja del corazón. Todos están entrelazados: el cristal, la hoja, el Jedi.";
        3: print "Un sable de luz es un arma poderosa y muy versátil que puede ser empleada tanto para desviar disparos láser como 
                  para cortar y fundir casi cualquier tipo de material.";
      };
      rtrue;
    ],
    before [;
      give,
      drop: "Un caballero Jedi no abandona nunca su sable laser."; 
      Levitar: "Un sable laser no está hecho para jugar.";
      Burn, SwitchOn, SwitchOff: "Mejor mantener el sable laser oculto. No conviene que vayas alardeando de ser un jedi.";
    ],
has clothing;

Object oBomo "Bomo Greenbark" 
class PNJMovil
  with
    name 'bomo' 'greenbark',
    sgw_img pngBomo,
    description "Es Bomo Greenbark, tu más leal soldado y amigo. Su mujer y su hija intentaban escapar de Nuevo Plympto.",
    pnj_ha_llegado [;
        PNJ_Ruta(self, MOVIMIENTO_NINGUNO);
    ],
    pnj_bloqueado [;  ! Nada especial. Reintentará seguir su ruta.
        PNJ_Ruta(self, MOVIMIENTO_NINGUNO);
    ],
    react_before [;
      go: if (self in agujero) {
	          if (location == ladera2) {
		          print (s_underline) "~¡Eh, Dass! ¡Sácame de aquí!"," - oyes gritar a Bomo desde el fondo del agujero.^";
		          print "No puedes abandonar a Bomo en este lugar. ¡Tienes que sacarlo de ese agujero!";
		          viewImageSlide(pngBomo);
                  rtrue;
	          } 
          }
          if (location == paso) {
            if (oArboles hasnt cortado && noun==n_obj) {
	          switch(random(3)) {
	            1: print (s_underline) "~¡No podemos retirarnos, General! ¡Debemos aguantar la posición el máximo tiempo
                             posible para dar una oportunidad a las mujeres y niños!~"," - grita Bomo";
                   viewImageSlide(pngBomo);
                   rtrue;
	            2: print (s_underline) "~¡Debemos evitar el avance de los tanques como sea, General!~"," - grita Bomo";
                   viewImageSlide(pngBomo);
                   rtrue;
	            3: print (s_underline) "~¡Detén a los tanques como sea, General! ¡Hay que cortarles el avance!~"," - grita Bomo";
                   viewImageSlide(pngBomo);
                   rtrue;
              }
            }
          }
          if (location == ladera && fase == 1) {
	          if (noun==s_obj) {
		          print (s_underline) "~¡General! ¡No debemos acercarnos más a los clones! ¡Están avanzando hacia nuestra posición!"," - grita Bomo";
		          viewImageSlide(pngBomo);
                  rtrue;
	          } 
	          if (noun==n_obj) {
	            switch(random(3)) {
	              1: print (s_underline) "~¡No podemos retirarnos, General! ¡Debemos aguantar la posición el máximo tiempo
                             posible para dar una oportunidad a las mujeres y niños!~"," - grita Bomo";
                     viewImageSlide(pngBomo);
                     rtrue;
	              2: print (s_underline) "~¡Debemos evitar el avance de los tanques como sea, General!~"," - grita Bomo";
                     viewImageSlide(pngBomo);
                     rtrue;
	              3: print (s_underline) "~¡Detén a los tanques como sea, General! ¡Hay que cortarles el avance!~"," - grita Bomo";
                     viewImageSlide(pngBomo);
                     rtrue;
                }
	          }
          }
          
    ],
    life [tema;
        give: if (noun==oTrajeTrooper) "No es de su talla.";
              rfalse;
        ask, tell, answer: tema=AveriguarTema(AskTopics);
             switch(tema) {
	           t_ayuda: if (oBomo in agujero) {
		                    print "^Bomo: ",(s_underline) "~Podrías usar alguno de tus poderes de Jedi. Nadie descubrirá tu secreto.~";
	                    } else {
		                  switch(location) {
			                hangarNorte, hangarSur, hangarEste, hangarOeste, pista:
			                  if (self.orvax==0) 
                                print "^Bomo: ", (s_underline) "~Dass... Debemos encontrar a mi familia y el resto de refugiados...~";
                              else
                                print "^Bomo: ", (s_underline) "~¡Debemos agenciarnos alguna nave para escapar de aquí y encontrar a mi familia!~";
                            paso,ladera:                            
				              print "^Bomo: ",(s_underline) "~¡Debes bloquear el avance de los tanques como sea, Dass! ¡Los árboles podrían ser 
				                    de ayuda!~";
				            ladera2,cima,camino:
				              print "^Bomo: ",(s_underline) "~Debemos llegar a Cadgel Meadows para ver qué ha pasado con mi familia y el
				                    resto de refugiados.~";
				            extOeste, extEste, extNorte, extSur:
				              print "^Bomo: ",(s_underline) "~Si tú con tus poderes no encuentras la manera de entrar al puerto espacial,
				                    ¿qué voy a poder hacer yo?~";
				            default:
				              print "^Bomo: ",(s_underline) "~Lo siento, Dass. No sé cómo ayudarte en este momento.~";
		                  }
	                    }
               t_mesa: print "^Bomo: ",(s_underline) "~Es mi esposa...¡Ayúdame a encontrarla!~";
               t_resa: print "^Bomo: ",(s_underline) "~Es mi hija...¡Le prometí que volvería con ella antes de separarnos!~";
               t_prisionero,
               t_familiabomo: print "^Bomo: ",(s_underline) "~Ayúdame a encontrarlas, Dass. Necesito volver con mi mujer, Mesa, 
                                    y con mi hija, Resa. ¡Se lo prometí a ambas!~";
               t_jedis: print "^Bomo: ",(s_underline) "~Si me permites un consejo, en estos tiempos oscuros que nos toca vivir, no conviene que alardees de 
                              tu condición de jedi. Deberías controlarte para no ponernos en peligro.~";
               t_cadaveres: if (location == cima or ladera2) {
                              print "Bomo: ",(s_underline) "~Los han matado a todos. No han hecho prisioneros.~^";
                            } else {
                              if (oCadaverSoldado in location) {
	                              print "Bomo: ",(s_underline) "~No me recuerdes la batalla de Half Axe.~^";
                              }
                            }
               t_imperio: if (location == paso or ladera) {
	                          switch(random(3)) {
	                            1: print "^Bomo: ",(s_underline) "~¡Tenemos que detenerlos, General!~";
	                            2: print "^Bomo: ",(s_underline) "~¡Están avanzando, General! ¡Tenemos que bloquear el avance de los tanques!~";
	                            3: print "^Bomo: ",(s_underline) "~¡Prueba a lanzarles uno de esos enormes árboles, Dass!~";
                              }
                          } else {
                                print "^Bomo: ",(s_underline) "~Odio al Imperio. Todo esto es culpa suya. ¡Juro que como les pase algo
                                      yo mismo acabaré con el mismísimo emperador!~";    
                          }
               t_republica,t_guerra: print "^Bomo: ",(s_underline) "~Odio a todos los que han provocado esta maldita guerra que nos ha causado tanto daño. 
                                  ¿Dónde estarán ahora mi mujer y mi hija?~";
               t_nombre: print "^Bomo: ",(s_underline) "~¿Estás de broma? ¡Conoces de sobra mi nombre!~";
               t_ejercito: if (location == paso or ladera) {
	                           switch(random(3)) {
	                             1: print "^Bomo: ",(s_underline) "~¡Tenemos que detenerlos, General!~";
	                             2: print "^Bomo: ",(s_underline) "~¡Están avanzando, General! ¡Tenemos que bloquear el avance de los tanques!~";
	                             3: print "^Bomo: ",(s_underline) "~¡Prueba a lanzarles uno de esos enormes árboles, Dass!~";
                               }
                           } else {
	                           print "^Bomo: ",(s_underline) "~¡No dejaré a ninguno vivo si les pasa algo a Mesa o a Resa!~";
                           }
               t_mision: print "^Bomo: ",(s_underline) "~Por favor, Dass. Ayúdame a encontrar a Mesa y a Resa. ¡Te lo suplico!~";
               t_simismo,
               t_bomo: print "^Bomo: ",(s_underline) "~¡Soy Bomo Greenbark! ¡Esos malditos imperiales han cometido el error de dejarme con vida y no 
                             descansaré hasta encontrar a mi familia! ¡Me llevaré por delante a tantos como haga falta!~";
               t_tacos: print "^Bomo: ",(s_underline) "~Dass, estás cambiando... jamás pensé que oiría decir tales cosas a un jedi.~^"; 
               t_cadgel: if (oBomo in hangarNorte or hangarSur or hangarEste or hangarOeste or pista) {
	                       if (self.orvax==0)
	                         print "^Bomo: ",(s_underline) "~No ha despegado ninguna nave... ¡Debemos encontrar a Mesa y Resa cuanto antes!~^";
	                       else 
	                         print "^Bomo: ", (s_underline) "~¡Debemos agenciarnos alguna nave para escapar de aquí y encontrar a mi familia!~";
                         } else {
	                        print "^Bomo: ",(s_underline) "~Al puerto espacial de Cadgel Meadows es a donde se dirigían todos los refugiados. 
	                              ¡Mesa y Resa iban en el último transporte!~^"; 
                         } 
               t_naves: if (oBomo in hangarNorte or hangarSur or hangarEste or hangarOeste or pista) {
	                      if (self.orvax==0)
	                        print "^Bomo: ",(s_underline) "~No ha despegado ninguna nave... ¡Debemos encontrar a Mesa y Resa cuanto antes!~^";
	                      else 
	                        print "^Bomo: ", (s_underline) "~¡Debemos agenciarnos alguna nave para escapar de aquí y encontrar a mi familia!~";
                        } else {
	                        print "^Bomo: ",(s_underline) "~Sé lo mismo que puedas saber tú.~"; 
                        }
               t_vader: print "^Bomo: ",(s_underline) "~Dicen que Darth Vader era uno de los tuyos antes de caer en el lado oscuro.~^"; 
               default: if (oBomo in agujero) {
	                        print "^Bomo: ",(s_underline) "~Ahora que nadie puede vernos podrías usar alguno de tus poderes de jedi.~"; 
                        } else {
	                        switch(random(3)) {
	                          1: print "^Bomo: ",(s_underline) "~Lo siento, Dass. No te puedo responder a eso.~"; 
	                          2: print "^Bomo: ",(s_underline) "~Sé lo mismo que puedas saber tú.~"; 
	                          3: print "^Bomo: ",(s_underline) "~No conozco nada que no puedas saber tú.~";
                            } 
                        }
             };
             viewImageSlide(pngBomo);
             rtrue;
    ],
    orders [;
      Mild, Strong: print "^Bomo: ",(s_underline) "~Dass, estás cambiando... jamás pensé que oiría decir tales cosas a un jedi.~^"; 
                    viewImageSlide(pngBomo);
                    rtrue;
	  Attack: if (noun == oPatrulla) {
		        print "Bomo: ",(s_underline) "~¿Tú quieres que me maten, verdad? ¿No ves que son demasiados?~"; 
                viewImageSlide(pngBomo);
                rtrue;
              }
	          if (noun provides vida) {
	            give noun estatico;
	            if (second == nothing) 
	              turno_combate(self,noun,second);
	            else
	              turno_combate(self,noun,second);
	            viewImageSlide(pngSablesLuz);
	            if (noun has muerto && noun==oSoldado) {
		            stopdaemon(noun);
		            move noun to limbo;
		            move oCadaverSoldado to location;
		            give player ~descubierto;
	            };
	            if (self has muerto) {
		            deadflag=3;
		            print "^Al ver a Bomo en el suelo sin vida, el odio y la rabia te consumen. Con los ojos inyectados en sangre atacas sin piedad 
                          a tu enemigo, incluso cuando yace muerto en el suelo. Te sientes extrañamente bien... aunque en el fondo sabes que para
                          ti ya es imposible escapar del lado oscuro de la Fuerza.";
	            };
	            rtrue;
              };
              if (noun has animate) {
	              if (self in interiorUhumele && oSchurkHeren hasnt conocido) {
		              print "Bomo obedece y dispara con su blaster, pero ",(the)noun," reacciona a tiempo y solo resulta herido.";
		              print "^El resto de la tripulación responde disparando sus armas contra el pobre Bomo...";
		              deadflag=3;
		              print "^Al ver a Bomo en el suelo sin vida, el odio y la rabia te consumen. Con los ojos inyectados en sangre atacas sin piedad 
                          a tu enemigo, incluso cuando yace muerto en el suelo. Te sientes extrañamente bien... aunque en el fondo sabes que para
                          ti ya es imposible escapar del lado oscuro de la Fuerza.";
		              rtrue;
	              };
	              print "Bomo: ",(s_underline) "~¡Sí, claro! Mejor hazlo tú, ¡listo!.~"; rtrue;
              };
              if (noun has objetivo) {
	              "Bomo dispara con su blaster al objetivo sin causar grandes daños.";
              };
              print "Bomo: ",(s_underline) "~¡Dass, céntrate en lo tuyo que yo ya sé lo que tengo que hacer!~"; 
              viewImageSlide(pngBomo);
              rtrue;
      Push, Aturdir, 
      Enganyar: if (noun has animate) {
	               print (s_underline) "~General, yo no tengo ningún dominio sobre la Fuerza.~ ", "- te contesta Bomo.";
	               viewImageSlide(pngBomo);
                   rtrue;
                }
      Go: if (self in agujero) {
	        print (s_underline) "~Mis garras no me permiten trepar para salir de aquí, Dass.~ ", "- te contesta Bomo.";
	        viewImageSlide(pngBomo);
            rtrue;
          }
          if (noun == s_obj && location == ladera && fase == 1) {
	        print (s_underline) "~¡Los tanques se abren camino! ¡Las tropas imperiales están avanzando!.~ ", "- grita Bomo
                   mientras regresa corriendo.";
            viewImageSlide(pngBomo);
            rtrue;
          }
          if (noun == s_obj && location == ladera2 && fase == 2) {
	        print (s_underline) "~Los han matado a todos...~ ", "- se lamenta Bomo.";
	        viewImageSlide(pngBomo);
            rtrue;
          }
          if (location==ladera2 && fase == 1) {
	          print (s_underline) "~General, debemos impedir el avance del ejército imperial~ ", "- contesta Bomo";
	          viewImageSlide(pngBomo);
	          rtrue;
          }
          moverBomo(noun);
          rtrue;
      Exit: if (self in agujero) {
	          print (s_underline) "~Mis garras no me permiten trepar para salir de aquí, Dass.~ ", "- te contesta Bomo.";
	          viewImageSlide(pngBomo);
              rtrue;
            }
      Jump: if (self in agujero) {
	          print (s_underline) "~No voy a llegar de un salto al exterior. No tengo las habilidades de un jedi.~ ", "- te contesta Bomo.";
	          viewImageSlide(pngBomo);
              rtrue;
            }
            if (self in ExtNorte or ExtSur or ExtOeste) {
	          print "^Bomo: ",(s_underline) "~No voy a llegar de un salto al otro lado del muro. No tengo las habilidades de un jedi.~^";
	          viewImageSlide(pngBomo);
              rtrue;
            }
            "~Si saltar ahora sirviera para traer de vuelta a Mesa y Resa, lo haría sin dudarlo un solo segundo.~ se queja Bomo.";
      Seguir: if (self in interiorUhumele) {
	            if (oVwing in hangarNorte) {
		            print "Bomo: ", (s_underline) "~Dass, si no te importa, creo que estaré más seguro quedándome en la nave.~";
	                bomo_sigue=0;
	                viewImageSlide(pngBomo);
                } else {
		            print "~Como ordenes, mi General.~";
                    bomo_sigue=1;
                }
              } else {
	            print "~Como ordenes, mi General.~";
                bomo_sigue=1;
              }
              rtrue;
      Quieto: if (location==paso or ladera or ladera2 or cima or camino) {
	            print "^Bomo: ",(s_underline) "~No pienso quedarme aquí solo.~^"; 
                viewImageSlide(pngBomo);
                rtrue;
              }
              print "~Aquí te espero, Dass. No tardes en volver.~";
              bomo_sigue=0;
              rtrue;
      Climb: if (location==ExtNorte or ExtSur or ExtOeste) {
	            print "^Bomo: ",(s_underline) "~¿No ves que es imposible subir ahí arriba? Usa alguno de tus poderes para saltar al otro lado del muro.~^"; 
                viewImageSlide(pngBomo);
                rtrue;
             }
             rfalse;
      Yes: print "Bomo: ",(s_underline) "~¿Sí qué?~"; viewImageSlide(pngBomo); rtrue;
      No: print "Bomo: ",(s_underline) "~¿No qué?~"; viewImageSlide(pngBomo); rtrue;
      NotUnderstood, Tell: 
        ! "~No entiendo lo que quiere decirme, mi General.~";
        <<Ask self>>;
      default: switch(random(4)) {
	             1: print "Bomo: ",(s_underline) "~No es momento para tonterias.~"; viewImageSlide(pngBomo); rtrue;
	             2: print "Bomo: ",(s_underline) "~Tengo mejores cosas que hacer, ¡cómo encontrar a mi familia!~"; viewImageSlide(pngBomo); rtrue;
	             3: print "Bomo: ",(s_underline) "~No haré idioteces.~"; viewImageSlide(pngBomo); rtrue;
	             4: print "Bomo: ",(s_underline) "~¿Por qué no lo haces tú?~"; viewImageSlide(pngBomo); rtrue;
               }
    ],
    before [;
      Remove: if (self in agujero && location==ladera2) {
	             print "No alcanzas hasta donde está Bomo. El agujero es demasiado profundo.^";
	             print (s_underline) "~Usa la Fuerza, Dass...~"," - La voz de tu maestro suena en tu mente."; 
	             viewImageSlide(pngYoda); 
	             rtrue;
              }
              if (self in agujero) {
	           <<levitar self>>;
              }
              rfalse;
      Pull: if (self in agujero && location == ladera2) {
	             print "No alcanzas hasta donde está Bomo. El agujero es demasiado profundo.^";
	             print (s_underline) "~Usa la Fuerza, Dass...~"," - La voz de tu maestro suena en tu mente."; 
	             viewImageSlide(pngYoda); 
	             rtrue;
            }
            print "Bomo: ",(s_underline) "~¡Suéltame! ¿Por qué me tocas?~"; viewImageSlide(pngBomo); rtrue;
      Push: print "Bomo: ",(s_underline) "~Por encima de mi cadáver...~"; viewImageSlide(pngBomo); rtrue;
      Enter: if (location==agujero) {
	          print "Bomo: ",(s_underline) "~¿No ves que aunque te subas a mi no llegarás al borde? Hay veces que no sé cómo 
	                 llegaste a ser un Jedi.~";
	          viewImageSlide(pngBomo);
              rtrue;
             }
             if (self in agujero && location==ladera2) {
	           <<levitar self>>;
             }
             print "Bomo: ",(s_underline) "~Por encima de mi cadáver...~"; viewImageSlide(pngBomo); rtrue;
      Take: if (self in agujero && location == ladera2) <<pull oBomo>>;
            if (self in agujero) {
	          print "Bomo: ",(s_underline) "~No es momento para tonterias. ¡Sal tú primero y luego me sacas! Hay veces que no sé cómo 
	                 llegaste a ser un Jedi.~";
	          viewImageSlide(pngBomo);
              rtrue;
            }
            print "Bomo: ",(s_underline) "~Por encima de mi cadáver...~"; viewImageSlide(pngBomo); rtrue;
      Sanar: print "Pones tus manos sobre el cuerpo de Bomo y te concentras para canalizar la energía. Sientes como la Fuerza fluye a 
                   través de tu cuerpo hacia el suyo, recuperándolo completamente de sus heridas.";
             self.vida = 50;
             rtrue;
      Levitar: if (noun == oBomo && oBomo in agujero) {
	             if (location == ladera2) {
	                move oBomo to location;
	                bomo_sigue=1;
	                !print "^Usando el poder de la Fuerza, consigues levitar a Bomo y sacarlo del agujero.^";
	                Damusix.AsignarCanal(sndTriste,1,VOLUMEN_ALTO,1);
	                Damusix.Tocar(sndTriste,0);
	                Corto_FinFase1.proyeccion();
                    EsperarTecla("[Pulsa una tecla]^");
                    !BorrarPantalla();
	                fase = 3;
	                Achieved(2);
                    Damusix.SimpleFadeOut(sndTriste,1000);
                    <<look>>;
	                !rtrue;
                  } else {
	                print "^Mandar a Bomo al exterior sin saber lo que hay no es buena idea. Es mejor que subas tú primero
	                      para comprobar que no hay ningún peligro."; 
	                rtrue;
                  }
                }
                print (s_underline) "~¡Eehh! ",(s_underline)QuejasBomo(1)," ",(s_underline)QuejasBomo(2),"~-Bomo no parece muy contento con tu acción.";
                rtrue;
        Sentir, 
        Concentrar: print "Bomo es un gran amigo. Confía en que le llevarás de vuelta con su mujer y su hija.";
              rtrue;
        Enganyar: print "Bomo: ",(s_underline) "~No intentes tus truquitos de Jedi conmigo...~"; viewImageSlide(pngBomo); rtrue;
        Attack: player.oscuro++;
                if (player.oscuro>2) {
	                print "El impulso que sientes es más fuerte que tu voluntad y consigue vencerla. Sacas tu sable láser y atacas a traición a Bomo, 
	                      que ni siquiera se da cuenta de lo que le ha pasado...^";
	                viewImageSlide(pngSablesLuz);
	                deadflag=4;
	                print "^Al ver a Bomo en el suelo sin vida, el odio y la rabia te consumen. Te sientes extrañamente bien... quizás el lado oscuro
                           de la Fuerza no sea tan malo como siempre habías creido.";
	                rtrue;
                };
                "Tú mismo te sorprendes al tener pensamientos sobre atacar a tu amigo Bomo. Sólo un Sith permite esos pensamientos. ¿Significa que 
                no hay esperanza para tí y tus impulsos te arrastran hacia el lado oscuro de la Fuerza?";
        UsoFuerza:if (self in agujero) {
                   "Seguramente lo que quieres es LEVITAR a Bomo para sacarlo del agujero.";
                  };
    ],
    bonif_defensiva 15,
    bonif_ofensiva 15,
    vida 50,
    dado_golpe 1 6 0, !1d6+0
    orvax 0,
has animate proper;

Lugar paso "Paso de Half-Axe"
  with
    sgw_img pngPaso,       ! el grafico de la localidad
    sgw_mus sndGuerra,  ! la musica de la localidad
    sgw_vol VOLUMEN_BAJO,
    name 'paso',
    description "El estrecho desfiladero del Paso de Half-Axe toma su nombre de una de las cimas que bordea. Discurre de sur 
        a norte, siguiendo el curso de un rio y flanqueado por escarpadas montañas a este y oeste. Vuestra resistencia en la 
        ladera que lleva a la cima de Half-Axe es la última esperanza para las mujeres y niños nosaurianos, que marchan hacia 
        el puerto espacial de Cadgel Meadows para huir del Imperio. La abundate vegetación y, sobre todo, los gigantescos 
        árboles que pueblan este lugar es lo único que dificulta la implacable marcha del ejército imperial, que llega desde el sur.",
    describe[;
      if (oArboles hasnt cortado) rfalse;
      "Tras caer el gigantesco árbol sobre las primeras filas del ejército de clones, se ha producido un ligero caos 
      entre sus filas, deteniendo momentáneamente su marcha mientras se reorganizan. Pero esta situación no durará mucho...";
    ],
    before [;
      Go: if (noun==e_obj or w_obj) {
		    print "Escarpadas montañas tanto a este como a oeste limitan el acceso al estrecho desfiladero de Half-Axe, haciendo imposible
		          la huida por esa zona.";
            rtrue;
	      }
	      if (noun==s_obj) {
		    print "El ejército imperial corta el paso en esa dirección. Te invade un fuerte impulso de encender tu sable láser y lanzarte 
		          hacia el ejército imperial, pero eso no los detendría.";
            rtrue;
	      }
	  examine: if (noun==e_obj or w_obj) "El estrecho desfiladero de Half-Axe discurre de sur a norte, con escarpadas montañas tanto a este como a oeste.";
	           rfalse; 
    ],
    n_to ladera,
;

Object -> oArboles "arbol"
  with
    name 'arboles' 'arbol',
    description [;
      if (self hasnt cortado) 
        "Los milenarios árboles de esta zona son descomunales. Podrían convertirse prácticamente en el único obstáculo 
         insalvable para los tanques enemigos.";
                 
      "El gigantesco árbol ha caido sobre las primeras filas del ejército de clones, provocando un ligero caos 
      entre sus filas y deteniendo momentáneamente su marcha. Pero esta situación no durará mucho... esperas que, 
      al menos, os dé el tiempo suficiente para retiraros a otra posición.";
    ],
    invent [;
      if (inventory_stage == 2 && self has levitando) {
        print " (que controlas levitando)";
        rtrue;
      }
      rfalse;
    ],
    before [;
      attack,
      cut: if (self has cortado) "No ves ningún otro árbol que cortándolo pudiese bloquear el avance de los clones.";
           if (second ==nothing or oSableLaser) {
	           print (s_underline) "~¡Cubridme!~ ", "- gritas a tus soldados. Empuñas tu sable láser y corres alrededor
	                  del árbol que hay junto al río mientras cortas el tronco. Con un leve empujón de tu mente, el 
	                  imponente árbol se desploma y cae sobre las primeras filas del ejército imperial. ¡Sí! ¡Parece que
	                  funciona! Esto les mantendrá ocupados mientras os retiráis.";
	           give self cortado;
	           !playSound(chan2,sndCaidaArbol,1,VOLUMEN_ALTO);
	           Damusix.TocarV(sndCaidaArbol,VOLUMEN_ALTO);
	           Achieved(0);
	           rtrue;
           };
           "De esa manera no conseguiras nunca cortar ese árbol.";
!       sentir: <<concentrar self>>;
      ThrowAt: if (self has levitando) {
	             if (second ==nothing or oEjercito) {
	               print "Lanzas el enorme árbol sobre las primeras filas del ejército imperial. El árbol cae de lleno sobre varias
	                  decenas de soldados, que quedan aplastados bajo el descomunal tronco. Pero el mayor daño lo consigue al acertar
	                  de pleno en uno de los tanques, provocando una enorme explosión al destruirlo y que genera el caos en la 
	                  vanguardia del ejército de clones.^
	                  Esto os dará algo de tiempo para retiraros a posiciones más altas.";
	               move self to location;
	               give self cortado;
                   give self ~worn;
                   give self ~levitando;
                   give player ~concentrado;
	               !playSound(chan2,sndCaidaArbol,1,VOLUMEN_ALTO);
	               Damusix.TocarV(sndCaidaArbol,VOLUMEN_ALTO);
                   Achieved(0);
	               rtrue;
                 } else {
	                 "Tu objetivo debe ser detener el avance del ejército de clones y sus tanques.";
                 }
               };
               "No tienes el árbol bajo tu control para poder lanzarlo.";
      Take,
      Levitar: if (self has cortado) "No ves ningún otro árbol que puedas usar para bloquear el avance de los clones.";
               if (self hasnt forceable) {
	             print (s_underline) "~Un Jedi debe preservar la vida ante todo...~ ","- recuerdas las enseñanzas de tu maestro.";
                 print "^Sin embargo, en la situación desesperada en la que te encuentras te asaltan las dudas sobre qué es lo correcto...
                       Tal vez arrancar el árbol de sus raices para salvar a los nosaurianos no sea tan mala idea...";
                 give self forceable;
                 rtrue;
               } else {
	             print "Con el poder que te da la Fuerza, consigues arrancar el gigantesco árbol de sus raíces y mantenerlo en el aire, a la par
	                    que sientes en tu interior una casi impercertible perturbación en la Fuerza.";
                 move self to player;
                 give self worn;
                 give self levitando;
                 give player concentrado;
                 rtrue;
               }
!       Drop: print "Cuidadosamente dejas el árbol en el suelo.";
!                move self to location;
!                give self ~worn;
!                give self ~levitando;
!                give player ~concentrado;
!                rtrue;
      Drop, Disrobe: print "Cuidadosamente dejas el árbol en el suelo.";
               move self to location;
               give self ~worn;
               give self ~levitando;
               give player ~concentrado;
               rtrue;
      climb, enter: "Podrías subir de un solo salto hasta lo alto de cualquiera de esos árboles usando los poderes que te da la Fuerza, pero 
               no serviría de nada. Debes encontrar algo que frene a esos malditos tanques.";
      Sentir, Concentrar: print "La Fuerta está presente en el interior de todos los seres vivos, como en los grandes y fuertes árboles que os rodean.";
              rtrue;
    ],
has scenery;

Object -> oEjercito "ejercito"
  with
    name 'ejercito' 'soldados' 'clones' 'tanques' 'tanque' 'canon' 'canones' 'clon' 'legion',
    description "La legión 501. El ejército de clones, reforzado con tanques de combate, no cederá. Son los tanques los que, con su
                 potencia de fuego, van abriendo paso entre tus soldados. Dificultar su marcha en el desfiladero el máximo tiempo 
                 posible es la única esperanza que puedes dar a las familias nosaurianas para llegar al puerto espacial y huir.",
    nivel_odio 1,
    before [;
      attack: if (self.nivel_odio==1) {
	            print "Entrar en combate siempre debe ser la última opción, según las enseñanzas Jedi. Sin embargo, la situación es desesperada
	                   y empiezas a dudar si el combate directo sería la mejor opción. Más bien pensado, eso no bloquearía el paso de los
	                   tanques y no dentendría su avance.";
                self.nivel_odio=2;
                oEjercito2.nivel_odio=2;
                rtrue;
              }
              if (self.nivel_odio==2) {
	            print "Sacas el sable láser, te colocas entre tus nosaurianos y el ejército imperial y comienzas a devolver los disparos 
	                   enemigos, matando a tantos soldados imperiales como puedes. Sin embargo, incluso para un Jedi como tú, son demasiados 
	                   y no impides el avance del ejército enemigo.^
	                   Tras la demostración fallida de tu poder, retrocedes a tus posiciones herido en tu orgullo, pero con una intensa 
	                   sensación de rabia satisfactoria por las bajas causadas. Hasta ahora no habías experimentado lo seductora que puede
	                   ser la venganza...";
                self.nivel_odio=3;
                oEjercito2.nivel_odio=3;
                rtrue;
              }
              if (self.nivel_odio==3) {
	            print "La desesperanza se apodera de ti y sólo ves una solución. Eres uno de los seres más poderosos de la galaxia y ¡puedes
	                   luchar! Con un grito de rabia, empuñas tu sable láser y te lanzas contra el enemigo. Sientes un placentero frenesí 
	                   mientras atraviesas soldados clones con tu arma en una desesperada lucha. El poder del lado oscuro de la Fuerza te inunda,
	                   aumentando tus capacidades hasta niveles que nunca podrías haber pensado. Tus dudas se desvanecen ante la lucha y los
	                   cadáveres mutilados y humeantes de los soldados clones que se amontonan a tu alrededor. 
	                   ^El clamor que escuchas a tu espalda te indica que, envalentonados por tu actitud, los soldados nosaurianos cargan 
	                   también contra el ejército imperial...^
	                   Sin embargo, los soldados clones os superan en número por mucho y tardan relativamente poco tiempo en dirigir hacia ti tal
	                   número de disparos de sus blasters que te es imposible devolverlos todos...^
	                   ^Pierdes la cuenta de cuantos te atraviesan antes de que se te escape la vida, mientras ves con tu último aliento cómo van
	                   cayendo uno tras otros los nosaurianos. Y justo en ese momento es cuando te das cuenta de que has cedido y te has dejado 
	                   arrastrar hacia el lado oscuro de la Fuerza... justo a tiempo para sentir la culpabilidad de haberlos llevado a la muerte...";
                deadflag = true; !MUERTE!!
                glk_request_timer_events(0); ! desactivamos los mensajes aleatorios
                mensajes_aleatorios = false; ! ELIUK: avisamos que estan desactivados
              }
              rtrue;
    ],
has scenery objetivo;

Object oNosaurianos "nosaurianos"
  with 
    name 'nosauriano' 'soldado' 'cadaver' 'nosaurianos' 'cadaveres',
    description "El ejército enemigo avanza y el tuyo va menguando... Debes encontrar urgentemente la forma de detener los tanques imperiales
                 o vuestra derrota será inminente. Los nosaurianos confían en ti.",
	found_in paso ladera,
has scenery;

Lugar ladera "Ladera del Paso de Half-Axe"
  with
    sgw_img pngLadera,       ! el grafico de la localidad
    sgw_mus sndGuerra,  ! la musica de la localida
    sgw_vol VOLUMEN_BAJO,
    name 'ladera',
    description "Tras el ataque en el desfiladero, el ejército imperial se lanza contra vosotros, dificultado por los
                descomunales árboles que siguen protegiéndoos. Todavía necesitáis darle más tiempo a los refugiados para que
                consigan llegar al puerto espacial de Cadgel Meadows y huir.",
    before [;
      Go: if (noun==e_obj or w_obj) {
		    print "Escarpadas montañas tanto a este como a oeste limitan el acceso al estrecho desfiladero de Half-Axe.";
            rtrue;
	      }
	  examine: if (noun==e_obj or w_obj) "El estrecho desfiladero de Half-Axe discurre de sur a norte, con escarpadas montañas tanto a este como a oeste.";
	           rfalse; 
    ],
    s_to paso,
;

Object -> oArboles2 "arboles"
  with
    name 'arboles' 'arbol',
    description "Los árboles de esta zona siguen siendo igual de descomunales que los del desfiladero.",
    invent [;
      if (inventory_stage == 2 && self has levitando) {
        print " (que controlas levitando)";
        rtrue;
      }
      rfalse;
    ],
    before [;
      attack,
      cut: if (self has cortado) "No ves ningún otro árbol que cortándolo pudiese bloquear el avance de los clones.";
           if (second ==nothing or oSableLaser) {
	           print (s_underline)"~¡Retirada! ¡Dirigíos a la cima de la colina!~ ", "- ordenas a tus soldados mientras intentas 
	             repetir la misma jugada que antes. - ", (s_underline) "~¡Bomo, quédate conmigo y cúbreme!~^^";
	           EsperarTecla("[Pulsa una tecla para continuar...]^");
	           BorrarPantalla();
               Corto_Caida.proyeccion();
               EsperarTecla("[Pulsa una tecla]^");
               BorrarPantalla();
	           give self cortado;
	           playerTo(agujero, 2);
	           move oBomo to agujero;
	           bomo_sigue=0;
	           fase = 2;
	           glk_request_timer_events(0); ! desactivamos el timer
	           mensajes_aleatorios = false; ! ELIUK: avisamos que estan desactivados
	           rtrue;
           };
           "De esa manera no conseguiras nunca cortar ese árbol.";
      climb, enter: "No es un buen momento para subir a los árboles.";
      Sentir, Concentrar: print "La Fuerta está presente en el interior de todos los seres vivos, como en los grandes y fuertes árboles que os rodean.";
              rtrue;
      Take,
      Levitar: if (self has cortado) "No ves ningún otro árbol que puedas usar para bloquear el avance de los clones.";
               if (self hasnt forceable) {
	             print (s_underline) "~La Fuerza debe ser usada para salvar vidas no para quitarlas. Quitar la vida a un ser al lado oscuro
                 te acercará...~ ","- recuerdas las enseñanzas de tu maestro.";
                 print "^Piensas en cuántas acciones contrarias a las enseñanzas Jedi estarías dispuesto a realizar en nombre de lo correcto...";
                 give self forceable;
                 rtrue;
               } else {
		           print (s_underline)"~¡Retirada! ¡Dirigíos a la cima de la colina!~ ", "- ordenas a tus soldados mientras intentas 
		             repetir la misma jugada que antes. - ", (s_underline) "~¡Bomo, quédate conmigo y cúbreme!~^^";
		           EsperarTecla("[Pulsa una tecla para continuar...]^");
		           BorrarPantalla();
	               Corto_Caida.proyeccion();
	               EsperarTecla("[Pulsa una tecla]^");
	               BorrarPantalla();
		           give self cortado;
		           playerTo(agujero, 2);
		           move oBomo to agujero;
		           bomo_sigue=0;
		           fase = 2;
		           glk_request_timer_events(0); ! desactivamos el timer
	               mensajes_aleatorios = false; ! ELIUK: avisamos que estan desactivados
		           rtrue;
               }
    ],
has scenery;

Object -> oEjercito2 "ejercito"
  with
    name 'ejercito' 'soldados' 'clones' 'tanques' 'tanque' 'canon' 'canones' 'clon' 'legion',
    description "La legión 501. El ejército de clones, reforzado con tanques de combate, no cederá. Son los tanques los que, con su
                 potencia de fuego, van abriendo paso entre tus soldados. Aguantar en el desfiladero el máximo tiempo 
                 posible es la única esperanza que tienen las familias nosaurianas para llegar al puerto espacial y huir.",
    nivel_odio 1,
    before [;
      attack: if (self.nivel_odio==1) {
	            print "Entrar en combate siempre debe ser la última opción, según las enseñanzas Jedi. Sin embargo, la situación es desesperada
	                   y empiezas a dudar si el combate directo sería la mejor opción.";
                self.nivel_odio=2;
                rtrue;
              }
              if (self.nivel_odio==2) {
	            print "Sacas el sable láser, te colocas entre tus nosaurianos y el ejército imperial y comienzas a devolver los disparos enemigos, matando
	                   a tantos soldados imperiales como puedes. Sin embargo, incluso para un general Jedi como tú, son demasiados y no impides 
	                   el avance del ejército enemigo.^
	                   Tras la demostración fallida de tu poder, retrocedes a tus posiciones herido en tu orgullo, pero con una sensación de rabia
	                   satisfactoria por las bajas causadas. Hasta ahora no habías experimentado lo que es el odio...";
                self.nivel_odio=3;
                rtrue;
              }
              if (self.nivel_odio==3) {
	            print "Con un grito de rabia, empuñas tu sable láser y te lanzas contra el enemigo. Te sientes muy bien mientras atraviesas soldados
	                   clones con tu arma. Envalentonados por tu actitud, tus soldados nosaurianos cargan también contra el ejército imperial...^
	                   Sin embargo, los tanques reaccionan rápido...^";
		           EsperarTecla("[Pulsa una tecla para continuar...]^");
		           BorrarPantalla();
	               Corto_Caida2.proyeccion();
	               EsperarTecla("[Pulsa una tecla]^");
	               BorrarPantalla();
		           give self cortado;
		           playerTo(agujero, 2);
		           move oBomo to agujero;
		           bomo_sigue=0;
		           fase = 2;
		           glk_request_timer_events(0); ! desactivamos los mensajes aleatorios
		           mensajes_aleatorios = false; ! ELIUK: avisamos que estan desactivados
              }
              rtrue;
    ],
has scenery objetivo;

Lugar agujero "En el agujero"
  with
    sgw_img pngAgujero,       ! el grafico de la localidad
    sgw_mus sndJungla,
    sgw_vol VOLUMEN_BAJO,
    name 'agujero',
    ayuda 0,
    initial [;
              print (s_underline)"~¿Dass? ¿Dass? ¿Estás vivo?~", " - las palabras de Bomo suenan en la lejanía, acercándose conforme
                     vas recuperando la consciencia. La cabeza parece que te vaya a estallar.^";
              print (s_underline)"~Mmmmm... Creo que sí...~", " - dices.^",(s_underline)"~Al menos de momento...~";
              print "No sabes cuánto tiempo has podido estar sin conocimiento en este lugar, pero miras hacia arriba y la noche es cerrada.";
              print (s_underline)"~¿Cuánto tiempo llevamos aquí?~", " - preguntas. Era mediodía cuando os enfrentábais al ejército imperial.^";
              print (s_underline)"~¡Llevas horas inconsciente! ¡Tenemos que salir de aquí cuanto antes!~", " - exclama Bomo.^";
              rtrue;
            ],
    description "El agujero que han dejado las raices del árbol que derribaron los tanques imperiales es inmenso.^
                 En el exterior ya no se oye nada. Nada que indique batalla. Silencio, sólo silencio. Tienes un mal presentimiento... 
                 ¡debéis salir de este agujero cuanto antes!",
    before [;
      climb: if (noun == u_obj) "La tierra blanda de las paredes del agujero hace que sea imposible trepar por ellas hasta el exterior.";
             rfalse;
      enter: if (noun == u_obj) {
	           print "El borde del agujero parece inalcanzable. Pero lo que es imposible para la mayoría de seres de la Galaxia, no lo es
	                  para un Jedi. Te concentras y el resto es tan fácil como respirar. Tras el breve vuelo que te proporciona el salto
	                  ya estás en el exterior.^";
               playerTo(ladera2,2);
               Achieved(1);
               rtrue;
             }
             rfalse;
      jump: print "El borde del agujero parece inalcanzable. Pero lo que es imposible para la mayoría de seres de la Galaxia, no lo es
	              para un Jedi. Te concentras y el resto es tan fácil como respirar. Tras el breve vuelo que te proporciona el salto
	              ya estás en el exterior.^";
            playerTo(ladera2,2);
            Achieved(1);
            rtrue;
      examine: if (noun == u_obj) {
	              print "La oscuridad de la noche os espera fuera de este agujero, pero el borde exterior está demasiado alto para 
	                    alcanzarlo de forma natural.";
	              if (self.ayuda > 0) print " ¿Cómo saldría un jedi de esta situación?";
	              self.ayuda++;
	              rtrue;
               }
               rfalse;
      Go: if (noun == out_obj or u_obj) {
	          print "No alcanzas el borde del agujero. Está demasiado alto.";
	          if (self.ayuda > 0) print "^Bomo: ",(s_underline) "~A veces dudo de que seas un jedi. ¿Por qué no usas tus poderes para salir de aquí?~";
	          self.ayuda++;
	          rtrue;
          }
          print "Estáis atrapados en un agujero del que sólo se puede salir por el borde superior.";
	      if (self.ayuda > 0) print "^Bomo: ",(s_underline) "~¡Usa tus poderes!¡Al verte creo que cualquiera podría ser un jedi!~";
          self.ayuda++;
          rtrue;
      Exit: print "No alcanzas el borde del agujero. Está demasiado alto.";
	        if (self.ayuda > 0) print "^Bomo: ",(s_underline) "~A veces dudo de que seas un jedi. ¡Usa tus poderes para salir de aquí!~";
            self.ayuda++;
            rtrue;
      !climb: <<climb oParedesAgujero>>;rtrue;
      Dig: print "^Bomo: ",(s_underline) "~¿De veras crees que vas a conseguir algo excavando? ¡Usa tus poderes para salir de aquí!~";
            rtrue;
    ],
    !u_to ladera2,
;

Object -> oAgujero "agujero"
  with
    name 'agujero' 'hoyo' 'boquete' 'hueco',
    description "El agujero en el que estáis atrapados es inmenso. Y profundo. Miras hacia arriba y compruebas lo inalcanzable
                que parece el borde exterior.",
    before [;
      getoff,
      Exit: print "No alcanzas el borde del agujero. Está demasiado alto.";
	        if (agujero.ayuda > 0) print "^Bomo: ",(s_underline) "~A veces dudo de que seas un jedi. ¡Usa tus poderes para salir de aquí!~";
            agujero.ayuda++;
            rtrue;
      Push: print "Empujas con toda tu rabia las paredes de tierra del agujero.";
	        if (agujero.ayuda > 0) print "^Bomo: ",(s_underline) "~¿De veras crees que ibas a conseguir algo con eso?
	                                     A veces dudo de que seas un verdadero jedi~";
            agujero.ayuda++;
            rtrue;
      Dig: print "^Bomo: ",(s_underline) "~¿De veras crees que vas a conseguir algo excavando? ¡Usa tus poderes para salir de aquí!~";
           rtrue;
      Examine: rfalse;
      default: print "^Bomo: ",(s_underline) "~¿De veras crees que ibas a conseguir algo con eso? ¡Sácanos de aquí!"; rtrue;
    ],
has scenery;

Object -> oRaiz "raices"
  with
    name 'raices' 'raiz' 'arbol' 'arboles',
    description "Debían ser inmensas, a tenor del agujero que han dejado. No alcanzas a verlas desde aquí.",
    before [;
      examine: rfalse;
      Sentir, Concentrar: "No sientes nada en un árbol inerte.";
      default: "Ni siquiera alcanzas a verlas desde aquí.";
    ],
has scenery;

Object -> oParedesAgujero "paredes"
  with
    name 'paredes' 'pared' 'tierra' 'blanda',
    description "La tierra blanda de las paredes del agujero hace que sea imposible trepar por ellas hasta el exterior.",
    before [;
      enter,
      climb: "Intentas trepar, pero la tierra de las paredes está demasiado blanda y se desprende. Es imposible trepar por estas paredes";
      Push: print "Empujas con toda tu rabia las paredes de tierra del agujero.";
	        if (agujero.ayuda > 0) print "^Bomo: ",(s_underline) "~¿De veras crees que ibas a conseguir algo con eso?
	                                     A veces dudo de que seas un verdadero jedi~";
            agujero.ayuda++;
            rtrue;
    ],
has scenery;

Object -> oBorde "borde"
  with
    name 'borde' 'exterior' 'superior',
    description "El borde exterior está lo suficientemente alto como para no poder alcanzarlo y salir del agujero..",
    before [;
      climb: "Intentas trepar, pero la tierra de las paredes está demasiado blanda y se desprende. Es imposible trepar por estas paredes.";
      enter: print "El borde del agujero parece inalcanzable. Pero lo que es imposible para la mayoría de seres de la Galaxia, no lo es
	               para un Jedi. Te concentras y el resto es tan fácil como respirar. Tras el breve vuelo que te proporciona el salto
	               ya estás en el exterior.^";
             playerTo(ladera2,2);
             Achieved(1);
             rtrue;
    ],
has scenery;

Lugar ladera2 "Exterior del agujero"
  with
  !sgw_img grfSantaLucia,       ! el grafico de la localidad
    sgw_mus sndJungla,
    sgw_vol VOLUMEN_BAJO,
    name 'ladera',
    description "El desfiladero es ahora un campo sembrado de los cadáveres de los que eran tus soldados 
		         nosaurianos. Los soldados imperiales no han dejado a ninguno con vida... Afortunadamente, parace que no hay
		         stormtroopers a la vista.",
    n_to cima,
    before [;
       Go:
         if (oBomo in agujero) {
	          if (location == ladera2) {
		          print (s_underline) "~¡Eh, Dass! ¡Sácame de aquí!"," - oyes gritar a Bomo desde el fondo del agujero.";
                  rtrue;
	          } 
          }
         if (noun==e_obj or w_obj or s_obj) {
		    print "El puerto espacial de Cadgel Meadows está al norte.";
            rtrue;
	     }
	  examine: if (noun==e_obj or w_obj) "El estrecho desfiladero de Half-Axe discurre de sur a norte, con escarpadas montañas tanto a este como a oeste.";
	           if (noun==s_obj) "El estrecho desfiladero de Half-Axe está al sur, en la parte más baja de Half-Axe.";
	           if (noun==n_obj) "Al norte puedes ver la cima de Half-Axe. El puerto espacial queda en esa dirección.";
	           rfalse; 
    ],
;

Object -> oBoquete "agujero"
  with
    name 'agujero' 'hoyo' 'boquete' 'hueco',
    description [;
       if (oBomo in agujero) "El agujero que han dejado las raices del árbol que derribaron los tanques imperiales es inmenso.
                              ^Puedes ver a Bomo en el interior haciendo señas y lanzando gritos para que lo saques.";
       "El agujero que han dejado las raices del árbol que derribaron los tanques imperiales es inmenso.";
    ],
    before [;
      Enter: "Volver al agujero sería una pérdida de tiempo.";
      attack: if (oBomo in agujero) "Podrías hacer daño a Bomo, que aún sigue dentro.";
              rfalse;
    ],
has scenery;

Object -> oCadaveres "cadaveres"
  with
    name 'cadaveres' 'cadaver' 'soldados' 'soldado' 'nosaurianos' 'nosauriano' 'nativo' 'nativos' 'campo',
    description "Ha sido una auténtica masacre. Cientos de cadáveres de nosaurianos están desparramados por todo el desfiladero. El 
                 ejército imperial de Palpatine y Darth Vader no ha hecho prisioneros...",
    before [;
      Search: "No vas a conseguir nada registrando los cadáveres.";
      Levitar,Take: "Prefieres dejarlos descansar en paz.";
      sentir,concentrar: "Solo sientes la tristeza de Bomo. Los cadáveres no te transmiten nada.";
    ],
has scenery;

Object -> oRaices "raices"
  with
    name 'raices' 'raiz',
    description "Impresiona ver las raices de un árbol tan enorme. Tan grandes que podrían aplastar por sí solas una nave de transporte
       de tamaño medio. No te extraña que hayan hecho semejante boquete al caer.",
    before [;
      attack,cut: "No deberías entretenerte haciendo leña.";
      Levitar: "Aunque podrías levantarlo, no ganarías nada con ello.";
      Sentir, Concentrar: "No sientes nada en un árbol inerte.";
    ],
has scenery;

Object -> oArbolBomo "arbol"
  with
    name 'arboles' 'arbol',
    description "El desfiladero está poblado de gigantescos árboles. ",
    before [;
      attack,
      cut,Levitar: if (oBomo in agujero) "Desafortunadamente todos son demasiado grandes para usarlos como ayuda para que Bomo pueda salir.";
                   "Un Jedi debe respetar y proteger cualquier forma de vida.";
      Sentir, Concentrar: print "La Fuerta está presente en el interior de todos los seres vivos, como en los grandes y fuertes árboles que os rodean.";
              rtrue;
    ],
has scenery;

Object -> oRamaBomo "rama"
  with
    name 'ramas' 'rama',
    description "El desfiladero está poblado de gigantescos árboles. ",
    before [;
      attack,
      cut,Levitar: if (oBomo in agujero) "Desafortunadamente todos son demasiado grandes para usarlos como ayuda para que Bomo pueda salir.";
                   "Un Jedi debe respetar y proteger cualquier forma de vida.";
      Sentir, Concentrar: print "La Fuerta está presente en el interior de todos los seres vivos, como en los grandes y fuertes árboles que os rodean.";
              rtrue;
    ],
has scenery;

Lugar cima "Cima del Paso de Half-Axe"
  with
    sgw_img pngCima,       ! el grafico de la localidad
    sgw_mus sndJungla,
    sgw_vol VOLUMEN_BAJO,
    name 'cima',
    description "En la cima del Paso de Half-Axe todavía se pueden llegar a ver algunos de los cadáveres de los soldados nosaurianos que
                 habían conseguido huir hasta arriba del desfiladero. Desde aquí sale el camino que va directamente al puerto espacial de
                 Cadgel Meadows.",
    s_to ladera2,
    e_to camino,
;

Object -> oCadaveres2 "cadaveres"
  with
    name 'cadaveres' 'soldados' 'nosaurianos' 'campo',
    description "Aun aquí se pueden ver algunos cadáveres de los nosaurianos que lucharon a vuestro lado.",
has scenery;

Object -> oCamino "camino"
  with
    name 'camino' 'via' 'senda' 'vereda' 'itinerario' 'ruta' 'trayecto' 'cadgel' 'meadows' 'trayecto' 'recorrido',
    description "El camino hacia Cadgel Meadows se aleja hacia el este.",
    before [;
      Enter: <<go e_obj>>;
    ],
has scenery;

Object -> oArbolesCima "arboles"
  with
    name 'arboles' 'bosque' 'arbol' 'arbolada' 'arboleda' 'zona' 'zonas',
    description "La oscuridad de la noche y la protección de las zonas arboladas podrían propiciar un buen escondite en caso de que se 
                acercara compañía poco deseable.",
    before [;
      esconder,enter: "En estos momentos no hay ninguna amenaza de la que debáis esconderos.";
    ],
has scenery;

Lugar camino "Camino a Cadgel Meadows"
  with
    sgw_img pngCamino,       ! el grafico de la localidad
    sgw_mus sndJungla,
    sgw_vol VOLUMEN_BAJO,
    name 'camino',
    description "El camino hacia Cadgel Meadows discurre por una zona poblada de zonas boscosas a ambos lados, aunque ya no son los árboles
                 gigantescos que se pueden encontrar en el Paso de Half-Axe.",
    w_to cima,
    e_to extOeste,
;

Object -> oArboles3 "arboles"
  with
    name 'arboles' 'bosque' 'arbol' 'arbolada' 'arboleda' 'zona' 'zonas',
    description "La oscuridad de la noche y la protección de las zonas arboladas podrían propiciar un buen escondite en caso de que se 
                acercara compañía poco deseable.",
    before [;
      esconder,enter: "No hay nada cerca de lo que haya que ocultarse.";
    ],
has scenery;

Lugar extOeste "Exterior de Cadgel Meadows (lado oeste)"
  with
  sgw_img pngExtCadgel,       ! el grafico de la localidad
    name 'exterior',
    description "El puerto espacial de Cadgel Meadows esta rodeado de un muro que lo aisla del exterior. Las zonas arboladas podrían 
                ayudar en caso de que se acercara compañía poco deseable.",
    w_to camino,
    ne_to extNorte,
    se_to extSur,
    each_turn [;
	    if (oSoldado in extNorte) "^Alguien se acerca por el noreste.";
	    if ((oSoldado in self) && (player hasnt descubierto) && (oSoldado hasnt estatico)) "^El soldado imperial se detiene a inspeccionar detrás de unos arbustos.";
	],
	before [;
	  exit: if (player in oArboles4) {
		        give player ~escondido;
                move player to extOeste;
                if (oBomo in oArboles4) move oBomo to extOeste;
                print "Sales de entre los árboles.";
                rtrue;
	        } else {
		        rfalse;
	        };
	  jump: if (player hasnt descubierto) <<jumpover oMuroOeste>>;
	        "No es una buena idea mientras estás siendo apuntado con un rifle láser.^";
	  attack, aturdir, enganyar, inv, examine,look,salidas: rfalse;
	  default: if (player has descubierto) {
		           print "No es una buena idea mientras estás siendo apuntado con un rifle láser.^";
		           rtrue;
	           } else {
		           rfalse;
	           }
	],
;

Object -> oMuroOeste "muro"
  with
    name 'muro',
    description "Un muro de unos 4 metros de altura encierra el puerto espacial de Cadgel Meadows.",
    found_in extOeste hangarOeste,
    before [;
      cut,attack: print "^Bomo: ",(s_underline) "~¿Qué vas a hacer? Tiene pinta de que es demasiado grueso para atravesalo. 
                        Es mejor llegar al otro lado por arriba.^"; rtrue;
      climb: "Después de estudiar las posibilidades, llegas a la conclusión de que es imposible escalar el muro. 
             Afortunadamente, tu entrenamiento como jedi te da dominio sobre la Fuerza.";
      enter, jumpover: if (location==extOeste) {
	                       if (oBomo in location) {
	                           print "Agarras a Bomo y usando tus poderes Jedi, saltas al otro lado del muro.^";
                               move oBomo to hangarOeste;
                               bomo_sigue=1;
                           }
                           playerTo(hangarOeste);
                           if (task_done->5 == 0) Achieved(4);
                       } else {
	                       if (oBomo in location) {
	                           print "Agarras a Bomo y usando tus poderes Jedi, saltas al otro lado del muro.^";
                               move oBomo to extOeste;
                               bomo_sigue=1;
                           }
                           playerTo(extOeste);
                       }
                       rtrue;
    ],
has scenery;

Object -> oArboles4 "bosque"
  with
    name 'arboles' 'bosque' 'arbustos',
    description [;
        if (parent(player) == self) {
          print "La zona de arbustos te proporciona una estupenda cobertura.";
        } else {
          print "La oscuridad de la noche y la protección de las zonas arboladas podrían propiciar un buen escondite en caso de que se 
                acercara compañía poco deseable.";
        };
    ],
    out_to extOeste,
    before [;
      esconder,enter: give player escondido;
                move player to self;
                if (oBomo in location) move oBomo to self;
                print "Te ocultas entre los árboles.^";
                rtrue;
      exit,getoff: give player ~escondido;
            move player to extOeste;
            if (oBomo in self) move oBomo to extOeste;
            print "Sales de entre los árboles.^";
            rtrue;
    ],
has scenery transparent enterable;

Lugar extNorte "Exterior de Cadgel Meadows (lado norte)"
  with
  sgw_img pngExtCadgelB,       ! el grafico de la localidad
    name 'exterior',
    description "El puerto espacial de Cadgel Meadows esta rodeado de un muro que lo aisla del exterior. Las zonas arboladas podrían 
                ayudar en caso de que se acercara compañía poco deseable.",
    se_to extEste,
    sw_to extOeste,
    each_turn [;
	    if (oSoldado in extSur) "^Alguien se acerca por el sureste.";
	    if ((oSoldado in self) && (player hasnt descubierto) && (oSoldado hasnt estatico)) "^El soldado imperial se detiene a inspeccionar detrás de unos arbustos.";
	],
	before [;
	  exit: if (player in oArboles5) {
		        give player ~escondido;
                move player to extNorte;
                if (oBomo in oArboles5) move oBomo to extNorte;
                print "Sales de entre los árboles.";
                rtrue;
	        } else {
		        rfalse;
	        }
	  jump: if (player hasnt descubierto) <<jumpover oMuroNorte>>;
	        "No es una buena idea mientras estás siendo apuntado con un rifle láser.^";
	  attack, aturdir, enganyar, inv, examine,look,salidas: rfalse;
	  default: if (player has descubierto) {
		           print "No es una buena idea mientras estás siendo apuntado con un rifle láser.^";
		           rtrue;
	           } else {
		           rfalse;
	           }
	],
;

Object -> oMuroNorte "muro"
  with
    name 'muro',
    description "Un muro de unos 4 metros de altura encierra el puerto espacial de Cadgel Meadows.",
    found_in extNorte hangarNorte,
    before [;
      cut,attack: print "^Bomo: ",(s_underline) "~¿Qué vas a hacer? Tiene pinta de que es demasiado grueso para atravesalo. 
                        Es mejor llegar al otro lado por arriba.^"; rtrue;
      climb: "Después de estudiar las posibilidades, llegas a la conclusión de que es imposible escalar el muro. 
             Afortunadamente, tu entrenamiento como jedi te da dominio sobre la Fuerza.";
      enter, jumpover: if (location==extNorte) {
	                       if (oBomo in location) {
	                           print "Agarras a Bomo y usando tus poderes Jedi, saltas al otro lado del muro.^";
                               move oBomo to hangarNorte;
                               bomo_sigue=1;
                           }
                           playerTo(hangarNorte,2);
                           if (task_done->5 == 0) Achieved(4);
                       } else {
	                       if (oBomo in location) {
	                           print "Agarras a Bomo y usando tus poderes Jedi, saltas al otro lado del muro.^";
                               move oBomo to extNorte;
                               bomo_sigue=1;
                           }
                           playerTo(extNorte,2);
                       }
                       rtrue;
    ],
has scenery;

Object -> oArboles5 "arboles"
  with
    name 'arboles' 'bosque' 'arbustos',
    description [;
        if (parent(player) == self) {
          print "La zona de arbustos te proporciona una estupenda cobertura.";
        } else {
          print "La oscuridad de la noche y la protección de las zonas arboladas podrían propiciar un buen escondite en caso de que se 
                acercara compañía poco deseable.";
        };
    ],
    out_to extNorte,
    before [;
      esconder,enter: give player escondido;
                move player to self;
                if (oBomo in location) move oBomo to self;
                print "Te ocultas entre los árboles.^";
                rtrue;
      exit,getoff: give player ~escondido;
            move player to extNorte;
            if (oBomo in self) move oBomo to extNorte;
            print "Sales de entre los árboles.^";
            rtrue;
    ],
has scenery transparent enterable;

Lugar extEste "Entrada a Cadgel Meadows"
  with
  !sgw_img grfSantaLucia,       ! el grafico de la localidad
    name 'exterior',
    description "La entrada a Cadgel Meadows está vigilada y protegida por soldados imperiales. Las zonas arboladas podrían 
                ocultaros mientras pensáis cómo entrar.",
    nw_to extNorte,
    sw_to extSur,
    in_to hangarEste,
    each_turn [;
	    if (oSoldado in extSur) "^Alguien se acerca por el suroeste.";
	    if ((oSoldado in self) && (player hasnt descubierto) && (oSoldado hasnt estatico)) "^El soldado imperial se detiene a inspeccionar detrás de unos arbustos.";
	],
	before [;
	    exit: if (player in oArboles6) {
		        give player ~escondido;
                move player to extEste;
                if (oBomo in oArboles6) move oBomo to extEste;
                print "Sales de entre los árboles.";
                rtrue;
	          } else {
		        rfalse;
	          }
	    Enter: if (player has disfrazado) {
	             print "Capitán clon: ", (s_underline) "~¡ALTO! ¿Dónde vas con ese nativo, soldado?~";
	             rtrue;
               }
               if (player has descubierto) {
	             print "Capitán clon: ", (s_underline) "~¡HE DICHO QUE NO SE PUEDE PASAR!~";
	           } else {
	             print "Capitán clon: ", (s_underline) "~¡ALTO EN NOMBRE DEL IMPERIO! ¡NO SE PERMITE ACCEDER AL INTERIOR!~";
		         give player descubierto;
	           }
	           rtrue;
	    go: if (player has disfrazado) {
	          print "Capitán clon: ", (s_underline) "~¡ALTO! ¿Dónde vas con ese nativo, soldado?~";
	          rtrue;
            }
            if (noun == in_obj) {
              if (player has descubierto) {
	            print "Capitán clon: ", (s_underline) "~¡HE DICHO QUE NO SE PUEDE PASAR!~";
	          } else {
	            print "Capitán clon: ", (s_underline) "~¡ALTO EN NOMBRE DEL IMPERIO! ¡NO SE PERMITE ACCEDER AL INTERIOR!~";
		        give player descubierto;
	          };
	          rtrue;
            };
	  attack, aturdir, enganyar, inv, examine,look,salidas: rfalse;
	  default: if (player has descubierto) {
		           print "No es una buena idea mientras estás siendo apuntado con un rifle láser.^";
		           rtrue;
	           } else {
		           rfalse;
	           }
    ],
;

Object -> oSoldado "soldado"
  with
    name 'soldado' 'stormtrooper' 'clon',
    description "Un soldado imperial haciendo patrulla alrededor del puerto espacial.",
    bonif_defensiva 0,
    vida 20,
    dado_golpe 2 6 0, !2d6+0
    parse_name [n w;
	   n=0;
	   w=nextWord();
       !while ((w=nextWord()=='naves') && (n<11)) {
	      if (w=='soldado' or 'stormtrooper' or 'clon' && self in extEste) return 10;
	      if (w=='soldado' or 'stormtrooper' or 'clon') n=1;
       !}
       return n;
     ],
    daemon [;
      if (self notin location) give self ~estatico; !Si el jugador se ha ido, se le permite mover otra vez
      if (self has estatico) rfalse; !El pnj no se puede mover
      if (random(3) ~= 1) rfalse;
      if (self in extOeste) {
	      if ((self in location) && (player hasnt escondido)) {
		      print "Stormtrooper: ", (s_underline) "¡ALTO EN NOMBRE DEL IMPERIO!";
		      give player descubierto;
		      rfalse;
	      }
	      if ((self in location) && (player has escondido)) print "El soldado se aleja por el sureste.";
	      move self to extSur;
	      if (self in location) print "Un soldado imperial haciendo la ronda ha llegado a tu posición.";
	      rfalse;
      }
      if (self in extNorte) {
	      if ((self in location) && (player hasnt escondido)) {
		      print "Stormtrooper: ", (s_underline) "¡ALTO EN NOMBRE DEL IMPERIO!";
		      give player descubierto;
		      rfalse;
	      }
	      if ((self in location) && (player has escondido)) print "El soldado se aleja por el suroeste.";
	      move self to extOeste;
	      if (self in location) print "Un soldado imperial haciendo la ronda ha llegado a tu posición.";
	      rfalse;
      }
      if (self in extEste) {
	      if ((self in location) && (player hasnt escondido)) {
		      print "Stormtrooper: ", (s_underline) "¡ALTO EN NOMBRE DEL IMPERIO!";
		      give player descubierto;
		      rfalse;
	      }
	      if ((self in location) && (player has escondido)) print "El soldado se aleja por el noroeste.";
	      move self to extNorte;
	      if (self in location) print "Un soldado imperial haciendo la ronda ha llegado a tu posición.";
	      rfalse;
      }
      if (self in extSur) {
	      if ((self in location) && (player hasnt escondido)) {
		      print "^Stormtrooper: ", (s_underline) "¡ALTO EN NOMBRE DEL IMPERIO!";
		      give player descubierto;
		      rfalse;
	      }
	      if ((self in location) && (player has escondido)) print "El soldado se aleja por el noreste.";
	      move self to extEste;
	      if (self in location) print "Un soldado imperial haciendo la ronda ha llegado a tu posición.";
	      rfalse;
      }
    ],
    life [;
	    Attack: if (self in extEste) "No conviene atacar al soldado en este momento. Los que vigilan la entrada se os echarían encima. Tendrás
	              que esperar a que esté más solo para atacarle.";
	            give self estatico;
	            move player to parent(self);
	            if (second == nothing) 
	              turno_combate(player,self,oSableLaser);
	            else
	              turno_combate(player,self,second);
	            viewImageSlide(pngSablesLuz);
	            if (self has muerto) {
		            stopdaemon(self);
		            move self to limbo;
		            move oCadaverSoldado to location;
		            give player ~descubierto;
	            }
                rtrue;
    ],
    before [;
        Sentir, Concentrar: print "La Fuerta está presente en el interior de todos los seres vivos.";
              rtrue;
	    Push, Aturdir: if (self in extEste) "No conviene atacar al soldado en este momento. Los que vigilan la entrada se os echarían encima. Tendrás
	                       que esperar a que esté más solo para atacarle.";
	                   give self estatico;
	                   move player to parent(self);
                       turno_combate(player,self,oFuerza);
                       viewImageSlide(pngSablesLuz);
	                   if (self has muerto) {
		                 stopdaemon(self);
		                 move self to limbo;
		                 move oCadaverSoldado to location;
		                 give player ~descubierto;
	                   }
	                   rtrue;
        Enganyar: if (player has descubierto) {
	                 give player ~descubierto;
	                 give self ~estatico;
	                 print "Dass: ",(s_underline) "No has encontrado a ningún extraño.^"; 
	                 print "Stormtrooper: ",(s_underline) "~No he encontrado a ningún extraño.~^"; 
	                 print "Dass: ",(s_underline) "Puedes continuar con tu ronda.^"; 
	                 print "Stormtrooper: ",(s_underline) "~Puedo continuar con mi ronda.~^";
	                 if (self in extOeste) {
	                   print "El soldado continúa con su patrulla hacia el sureste.^";
	                   move oSoldado to extSur;
	                   rtrue;
                     }
	                 if (self in extSur) {
	                   print "El soldado continúa con su patrulla hacia el noreste.^";
	                   move oSoldado to extEste;
	                   rtrue;
                     }
	                 if (self in extEste) {
	                   print "El soldado continúa con su patrulla hacia el noroeste.^";
	                   move oSoldado to extNorte;
	                   rtrue;
                     }
	                 if (self in extNorte) {
	                   print "El soldado continúa con su patrulla hacia el suroeste.^";
	                   move oSoldado to extOeste;
	                   rtrue;
                     }
                  }
                  rtrue;
	    Levitar: "No deberías ir alardeando de tus poderes de jedi... son tiempos oscuros para los de tu Orden.";
    ],
has animate transparent;

Object ->-> oBlaster "rifle láser"
  with
    name 'rifle' 'blaster' 'laser',
    !adjectives 'soldado' 'clon' 'stormtrooper' 'legion',
    description "El típico blaster que llevan las tropas imperiales. Parece que ha quedado inservible tras el combate.",
    before [;
      take: "No crees que el soldado se deje arrebatar el rifle.";
      Levitar: "No podrás hacerlo mientras lo tenga entre las manos.";
    ],
;

Object oCadaverSoldado "cadaver"
  with
    name 'cadaver' 'soldado' 'stormtrooper' 'clon' 'muerto' 'cuerpo',
    short_name "cadáver del soldado",
    article "el",
    description [;
      print "Es el cadáver del soldado que habéis matado. Posiblemente estaba haciendo patrulla por el exterior del puerto espacial de Cadgel Meadows. ";
      if (parent(oTrajeTrooper) == self) print "Viste con los colores de la Legión 501 del ejército imperial, la misma a la que os
        enfrentabais en el desfiladero.";
      rtrue;
    ],
    react_before [;
      remove: if (noun == oTrajeTrooper) {
                  print "Le quitas el traje al cadáver y te lo pones. Escondes el cuerpo entre los árboles para que nadie lo vea.";
                  move oTrajeTrooper to player;
                  move oCadaverSoldado to limbo;
                  give oTrajeTrooper worn;
                  give player disfrazado;
                  Achieved(3);
              };
              rtrue;
    ],
    before [;
      Levitar: "Podrías elevarlo sin esfuerzo, pero sería perder el tiempo en tonterías.";
      Search: <<examine self>>;
    ],
has static transparent animate;

Object -> oTrajeTrooper "traje de soldado clon"
  with
    name 'traje' 'uniforme',
    !adjectives 'soldado' 'clon' 'stormtrooper' 'legion',
    description "Un traje no muy diferente del resto de clones del ejército imperial. Cubre el cuerpo entero, incluso la cabeza, y sirve
           como protección contra armas ligeras. Está decorado con los colores de la Legión 501.",
    before [;
      PutOn,
      SetTo: "No es de su talla.";
      take: if (self in oCadaverSoldado) {
	          print "Le quitas el traje al cadáver y te lo pones. Escondes el cuerpo entre los árboles para que nadie lo vea.";
            } else {
	          print "Coges el traje de soldado imperial.";
            }
            move oTrajeTrooper to player;
            move oCadaverSoldado to limbo;
            give oTrajeTrooper worn;
            give player disfrazado;
            Achieved(3);
            rtrue;
      wear: print "Te pones el traje. Ahora tienes la apariencia de un soldado imperial de la Legión 501.";
            move oTrajeTrooper to player;
            give oTrajeTrooper worn;
            give player disfrazado;
            rtrue;
      disrobe: print "Te quitas el traje de soldado. Vuelves a tener el aspecto de siempre.";
               give player ~disfrazado;
               give oTrajeTrooper ~worn;
               rtrue;
      Levitar: if (self has worn) {
	             print "Si quieres hacer levitar el traje, conviene que primero te lo quites.";
	             rtrue;
               }
               "Podrías elevarlo sin esfuerzo, pero sería perder el tiempo en tonterías.";
    ],
has clothing;

Object -> oRifleLaser "rifle láser"
  with
    name 'rifle' 'blaster' 'laser',
    !adjectives 'soldado' 'clon' 'stormtrooper' 'legion',
    description "El arma ligera que llevan las tropas imperiales. Parece que ha quedado inservible tras el combate.",
    before [;
      take: "Está inservible, así que lo vuelves a dejar en el suelo.";
      Levitar: "Podrías elevarlo sin esfuerzo, pero sería perder el tiempo en tonterías.";
    ],
;

Object oPatrulla "patrulla" extEste
  with
    name 'patrulla' 'guardia' 'soldados' 'capitan' 'soldado' 'clon' 'clones' 'entrada' 'acceso' 'interior',
    description "Una patrulla de clones controla la única entrada al puerto espacial. Puedes contar hasta 6 soldados imperiales 
                 cuidando el acceso al interior.",
    bonif_defensiva 0,
    bonif_ofensiva 5,
    vida 20,
    topvida 20,
    dado_golpe 1 6 0, !1d6+0
    multiple 6,
    name_boss "el capitán",
    name_tropa "un soldado",
    printname [nom;
      nom="";
      if (self.multiple>1) nom= self.name_tropa;
      else {
	      if (self provides name_boss ) nom= self.name_boss;
	      else nom= self.name_tropa;
      } 
      return nom;
    ],
    printcasename [nom;
      nom="";
      if (self.multiple>1) nom= Cap(self.name_tropa);
      else {
	      if (self provides name_boss) nom= Cap(self.name_boss);
          else nom= Cap(self.name_tropa);
      }
      return nom;
    ],
    life [tema;
	    Attack: "Son demasiado numerosos para un ataque directo contra ellos.";
! 	            give self estatico;
! 	            move player to parent(self);
! 	            if (second == nothing) 
! 	              multi_combate(player,self,oSableLaser);
! 	            else
! 	              multi_combate(player,self,second);
! 	            if (self has muerto) {
! 		            !stopdaemon(self);
! 		            move self to limbo;
! 		            !move oCadaverSoldado to location;
! 		            give player ~descubierto;
! 	            }
!                 rtrue;
	    Answer,ask,tell: tema=AveriguarTema(AskTopics);
	         switch (tema) {
		       t_tacos: print "Son muchos. No conviene enfadarlos.";
               t_jedis: print "Capitán clon: ", (s_underline) "~Los jedis son traidores al Imperio.~";
               t_republica: print "Capitán clon: ", (s_underline) "~La República se ha acabado. Nosotros servimos al Imperio.~";
               t_imperio: print "Capitán clon: ", (s_underline) "~Nosotros somos el ejército del Imperio Galáctico y servimos al emperador.~";
               t_mision,t_ejercito,t_halfaxe,
               t_guerra: print "Capitán clon: ", (s_underline) "~Vinimos a este planeta para aplastar a la resistencia y hemos cumplido nuestra misión. 
                               Ahora esperamos a que el Comandante Vill nos comunique el nuevo destino.~";
               t_vill: print "Capitán clon: ",(s_underline) "~El Comandante Vill está al mando. Su puesto se encuentra en el hangar norte.~";
               t_cadgel,
               t_naves: print "Capitán clon: ",(s_underline) "~El Comandante Vill ha ordenado que ninguna nave despegue.~";
               t_bomo, t_fugitivos,
               t_prisionero: print "Le dices al capitán de la patrulla que encontraste a tu prisionero husmeando por las cercanías 
                                    mientras hacías la ronda.^";
                             print "Capitán clon: ",(s_underline) "~Bien hecho. Llévalo al cuartel de mando en el hangar norte. 
                                    Ahí sabrán qué hacer con él.~";
                             playerTo(hangarEste,2);
	                         move oBomo to hangarEste;
	                         if (task_done->4 == 0) Achieved(5);
               default: print "Capitán clon: ",(s_underline) "~¿Qué dices? No me tomes el pelo o tendrás problemas, soldado.~"; 
             };
             rtrue;
    ],
    orders [;
      Mild, Strong: "Son muchos. No conviene enfadarlos.";
      NotUnderstood, Tell: <<Ask self>>;
    ],
    before [;
        Sentir, Concentrar: print "La Fuerta está presente en el interior de todos los seres vivos.";
              rtrue;
        Levitar,
	    Push, Aturdir: "Hay demasiados soldados para usar la Fuerza contra ellos.";
        Enganyar: if (player has descubierto) {
	                 give player ~descubierto;
	                 print "Dass: ",(s_underline) "~No somos ningunos extraños.~^"; 
	                 print "Capitán clon: ",(s_underline) "~No son extraños.~^"; 
	                 print "Dass: ",(s_underline) "~Podemos pasar al interior del puerto espacial.~^"; 
	                 print "Capitán clon: ",(s_underline) "~Pueden pasar al interior del puerto espacial.~^";
	                 playerTo(hangarEste,2);
	                 move oBomo to hangarEste;
	                 if (task_done->4 == 0) Achieved(5);
                  } else {
	                 print "Al acercaros a la entrada, los guardias os descubren...^"; 
	                 print "Capitán clon: ", (s_underline) "¡ALTO EN NOMBRE DEL IMPERIO! ¡NO SE PERMITE ENTRAR AL RECINTO!";
		             give player descubierto;
                  }
                  rtrue;
    ],
has female animate;

Object -> oArboles6 "arboles"
  with
    name 'arboles' 'bosque' 'arbustos',
    description [;
        if (parent(player) == self) {
          print "La zona de arbustos te proporciona una estupenda cobertura.";
        } else {
          print "La oscuridad de la noche y la protección de las zonas arboladas podrían propiciar un buen escondite en caso de que se 
                acercara compañía poco deseable.";
        };
    ],
    out_to extEste,
    before [;
      esconder,enter: give player escondido;
                move player to self;
                if (oBomo in location) move oBomo to self;
                print "Te ocultas entre los árboles.^";
                rtrue;
      exit,getoff: give player ~escondido;
            move player to extEste;
            if (oBomo in self) move oBomo to extEste;
            print "Sales de entre los árboles.^";
            rtrue;
    ],
has scenery transparent enterable;

Lugar extSur "Exterior de Cadgel Meadows (lado sur)"
  with
  sgw_img pngExtCadgelC,       ! el grafico de la localidad
    name 'exterior',
    description "El puerto espacial de Cadgel Meadows esta rodeado de un muro que lo aisla del exterior. Las zonas arboladas podrían 
                ayudar en caso de que se acercara compañía poco deseable.",
    ne_to extEste,
    nw_to extOeste,
    each_turn [;
	    if (oSoldado in extOeste) "^Alguien se acerca por el noroeste.";
	    if ((oSoldado in self) && (player hasnt descubierto) && (oSoldado hasnt estatico)) "^El soldado imperial se detiene a inspeccionar detrás de unos arbustos.";
	],
	before [;
	  exit: if (player in oArboles7) {
		        give player ~escondido;
                move player to extSur;
                if (oBomo in oArboles7) move oBomo to extSur;
                print "Sales de entre los árboles.";
                rtrue;
	        } else {
		        rfalse;
	        }
	  jump: if (player hasnt descubierto) <<jumpover oMuroSur>>;
	        "No es una buena idea mientras estás siendo apuntado con un rifle láser.^";
	  attack, aturdir, enganyar, inv, examine,look,salidas: rfalse;
	  default: if (player has descubierto) {
		           print "No es una buena idea mientras estás siendo apuntado con un rifle láser.^";
		           rtrue;
	           } else {
		           rfalse;
	           }
	],
;

Object -> oMuroSur "muro"
  with
    name 'muro',
    description "Un muro de unos 4 metros de altura encierra el puerto espacial de Cadgel Meadows.",
    found_in extSur hangarSur,
    before [;
      cut,attack: print "^Bomo: ",(s_underline) "~¿Qué vas a hacer? Tiene pinta de que es demasiado grueso para atravesalo. 
                        Es mejor llegar al otro lado por arriba.^"; rtrue;
      climb: "Después de estudiar las posibilidades, llegas a la conclusión de que es imposible escalar el muro. 
             Afortunadamente, tu entrenamiento como jedi te da dominio sobre la Fuerza.";
      enter, jumpover: if (location==extSur) {
	                       if (oBomo in location) {
	                           print "Agarras a Bomo y usando tus poderes Jedi, saltas al otro lado del muro.^";
                               move oBomo to hangarSur;
                               bomo_sigue=1;
                           }
                           playerTo(hangarSur,2);
                           if (task_done->5 == 0) Achieved(4);
                       } else {
	                       if (oBomo in location) {
	                           print "Agarras a Bomo y usando tus poderes Jedi, saltas al otro lado del muro.^";
                               move oBomo to extSur;
                               bomo_sigue=1;
                           }
                           playerTo(extSur,2);
                       }
                       rtrue;
    ],
has scenery;

Object -> oArboles7 "arboles"
  with
    name 'arboles' 'bosque' 'arbustos',
    description [;
        if (parent(player) == self) {
          print "La zona de arbustos te proporciona una estupenda cobertura.";
        } else {
          print "La oscuridad de la noche y la protección de las zonas arboladas podrían propiciar un buen escondite en caso de que se 
                acercara compañía poco deseable.";
        };
    ],
    out_to extSur,
    before [;
      esconder,enter: give player escondido;
                move player to self;
                if (oBomo in location) move oBomo to self;
                print "Te ocultas entre los árboles.^";
                rtrue;
      exit,getoff: give player ~escondido;
            move player to extSur;
            if (oBomo in self) move oBomo to extSur;
            print "Sales de entre los árboles.^";
            rtrue;
    ],
has scenery transparent enterable;

Lugar hangarNorte "Hangar Norte"
  with
    sgw_img pngHangarNorte,       ! el grafico de la localidad
    name 'hangar',
    !sgw_mus sndIntro,  ! la musica de la localida
    !sgw_vol VOLUMEN_ALTO,
    description "Este es el hangar de la parte norte del puerto espacial de Cadgel Meadows. Este hangar está totalmente ocupado por naves imperiales,
                 tanto de transporte como de combate. Algunas están siendo repostadas, otras revisadas y otras cargadas. Tras las naves, puedes ver 
                 la entrada al cuartel de mando.",
    desc_extra 0,
    describe [;
      self.Lugar::describe();
      if (self.desc_extra==0 && oBomo in location) {
        print "^Bomo (susurrando): ", (s_underline) "~Mira todas esas naves, Dass. No ha despegado ninguna... Los imperiales controlan el puerto...
              ¡Esto me huele muy mal!¡Deberíamos averiguar donde está a mi familia y el resto de refugiados!~";
        hangarOeste.desc_extra=1;
        hangarEste.desc_extra=1;
        hangarNorte.desc_extra=1;
        hangarSur.desc_extra=1;
      }
      if (self.desc_extra==1 && oBomo.orvax==1 && oBomo in location) {
        print "^Bomo (susurrando): ", (s_underline) "~Se han llevado a Mesa y Resa para venderlas como esclavos, Dass... ¡Debemos conseguir 
              alguna de las naves y escapar de aquí para encontrar a mi familia!~";
        hangarOeste.desc_extra=2;
        hangarEste.desc_extra=2;
        hangarNorte.desc_extra=2;
        hangarSur.desc_extra=2;
      }
      rtrue;
    ],
    s_to pista,
    before [;
      go: if (noun == in_obj) {
	        <<enter oCuartelMando>>;
          };
    ],
;

! Object -> oRukia "Rukia"
!   with
!     name 'rukia',
!     description "La Rukia es un carguero de la clase TL-1800. No parece que haya ningún tipo de actividad alrededor de esta nave.",
! has scenery;
! 
! Object -> oSothus "Sothus"
!   with
!     name 'sothus',
!     description "La Sothus es una nave de transporte ligero de la clase Etti. No parece que haya ningún tipo de actividad alrededor de esta nave.",
! has scenery;
! 
! Object -> oNegos "Negos"
!   with
!     name 'negos',
!     description "La Negos es un carguero de la clase AA-9. No parece que haya ningún tipo de actividad alrededor de esta nave.",
! has scenery;


Object -> oNaves "naves"
with
!     name 'naves',
     parse_name [n w;
	   n=0;
	   w=nextWord();
       !while ((w=nextWord()=='naves') && (n<11)) {
	      if (w=='naves' or 'nave') n=1;
	      if (w=='nave' && oVwing in parent(self)) n=-1;
       !}
       return n;
     ],
     description[;
       switch(location) {
	       hangarNorte: "Puedes ver tanto naves de transporte como naves de combate.";
	       hangarSur: "Puedes ver atracadas las naves Nuitedes, Valance y Vindus.";
	       hangarEste: "Puedes ver atracadas las naves Solaine, Aeolus y Uhumele.";
	       hangarOeste: "Puedes ver atracadas las naves Thorene, Haltia y Dzina.";
	       default: "Puedes ver tanto naves de transporte como naves de combate.";
       }
     ],
     found_in hangarNorte hangarSur hangarEste hangarOeste,
     before [;
       Enter: "Seguramente te harían preguntas incómodas antes de subir a cualquiera de ellas, lo que haría que te metieras en líos inútiles.";
       Levitar: "Sólo los jedis más poderosos podrían hacer levitar semenajante peso.";
       Take: "Demasiado peso incluso para ti.";
     ],
has scenery female pluralname;

Object -> oNavesTransporte "naves de transporte"
with
!      name 'naves' 'de' 'transporte',
!      adjectives 'transporte',
     parse_name [n w;
	   n=0;
	   w=nextWord();
       while ((w=='naves' or 'nave' or 'transporte' or 'de//') && (n<11)) {
	      if (w=='naves' or 'nave') n=-1;
	      if (w=='transporte') n=2;
	      if (w=='de' && nextWord()=='transporte') n=3;
	      w=nextWord();
       }
       return n;
     ],
     description "Sin duda, son naves para transportar tropas y provisiones para el ejército imperial. Algunas están siendo cargadas y otras descargadas.",
     before [;
       Enter: "Seguramente te harían preguntas incómodas antes de subir a cualquiera de ellas, lo que haría que te metieras en líos inútiles.";
       Levitar: "Sólo los jedis más poderosos podrían hacer levitar semenajante peso.";
       Take: "Demasiado peso incluso para ti.";
     ],
has scenery female pluralname;

Object -> oNavesCombate "naves de combate"
with
!       name 'naves' 'de' 'combate',
!       adjectives 'combate',
     parse_name [n w;
	   n=0;
	   w=nextWord();
       while ((w=='naves' or 'nave' or 'combate' or 'de//') && (n<11)) {
	      if (w=='naves' or 'nave') n=-1;
	      if (w=='combate') n=2;
	      if (w=='de' && nextWord()=='combate') n=3;
	      w=nextWord();
       }
       return n;
     ],
     description "Puedes ver multitud de naves de combate listas para despegar en cualquier momento, sin ningún tipo de buenas intenciones.",
     before [;
       Enter: "Seguramente te harían preguntas incómodas antes de subir a cualquiera de ellas, lo que haría que te metieras en líos inútiles.";
       Levitar: "Sólo los jedis más poderosos podrían hacer levitar semenajante peso.";
       Take: "Demasiado peso incluso para ti.";
     ],
has scenery female pluralname;

object -> oCuartelMando "cuartel de mando" 
with 
    name 'cuartel' 'mando' 'entrada',
    !adjectives 'san marcos',
    description "Es la entrada al cuartel de mando de las tropas imperiales que dominan el puerto espacial de Cadgel Meadows. 
                 En el interior debería estar el comandante al mando en Nuevo Plympto.",
    before [;
      Enter:
        if (oComandanteVill.cabreado > 0) {
          print "Después del enfado que le has causado al Comandante Vill, no es buena idea volver al cuartel de mando.";
          rtrue;
        }
        if (player hasnt disfrazado && oBomo in location) {
	        print (s_underline) "~¿No pensarás entrar así como así a la madriguera, verdad?~ ", "- te avisa Bomo.^";
	        print (s_underline) "~¡Maldita sea! ¡Tiene razón!~ ", "- piensas. Debes buscar otra forma de entrar.^";
	        rtrue;
        }
        if (player has disfrazado && oBomo in location && bomo_sigue==1) {
	        print "Disfrazado de soldado clon y con Bomo haciendo de prisionero entráis sin mayor problema al interior del cuartel de mando imperial.^";
            playerTo(CuartelMando, 2);
            move oBomo to CuartelMando;
            rtrue;
        }
        if (player has disfrazado && oBomo in location && bomo_sigue==0) {
	        print (s_underline) "~ ¡Un momento, Dass! He pensado que si me usas como prisionero, quizás el capitán te haga algo de caso...~ ", "- te dice Bomo mientras te agarra del brazo.^";
	        print (s_underline) "~ ¡Buena idea Bomo!~ ", "- le contestas.^";
	        bomo_sigue=1;
	        rtrue;
        }
        if (player has disfrazado && oBomo notin location) {
	        print "Disfrazado de soldado clon entras al cuartel de mando imperial.^";
            print (s_underline) "~¡Eh, tú!¡No quiero que se me moleste!¡Vuelve a tu ronda, soldado!~ ", "- te grita malhumorado el capitán.^";            
            print "Así que te das media vuelta y sales por donde has entrado, no sin antes fijarte en el holograma con el que está hablando el
                   capitán: el mismísimo Darth Vader. ^Necesitarás otro plan si quieres entrar al cuartel de mando.^";            
            rtrue;
        }
        print "No sería buena idea entrar al cuartel de mando ahora mismo. Te acribillarían los troopers con sus blasters antes de que pudieras 
               reaccionar siquiera. Necesitas un plan si quieres entrar al cuartel.^";
        rtrue;
    ]
has scenery;

Lugar CuartelMando "Cuartel de Mando de Cadgel Meadows"
  with
    sgw_img pngCuartelMando,       ! el grafico de la localidad
    sgw_mus sndVill,
    sgw_vol VOLUMEN_BAJO,
    name 'cuartel' 'mando',
    describe [;
      print "Estas en el interior del cuartel de mando imperial del puerto espacial Cadgel Meadows.";
      if (self hasnt visited) {
	      EsperarTecla("^[Pulsa una tecla]^");
	      print "^Cuando entras, el Comandante Vill está teniendo una comunicación con Darth Vader...^";
	      print "^Comandante Vill: ", (s_underline) "~Se acabó, Lord Vader. La resistencia separatista ha sido destruida. No hay supervivientes.~^";
	      print "^Darth Vader: ", (s_underline) "~¿Y qué hay del jedi humano que se rumoreaba que los lideraba?~^";
	      print "^Comandante Vill: ", (s_underline) "~No hemos encontrado rastro de ningún jedi, milord. Todos los cadáveres eran nosaurianos.~^";
	      print (s_underline) "~Lord Vader... ahora que la lucha ha acabado, ¿hay algún plan para mis hombres y para mi? Vivimos para servir, pero un soldado necesita 
	             sentirse útil...~^";
	      print "^Darth Vader: ", (s_underline) "~Estoy seguro de que el Emperador tiene un plan, comandante. Hablaremos a vuestro regreso a Coruscant.~^";
	      print "^Comandante Vill: ", (s_underline) "~Milord, no estoy seguro de cuando volveremos. Nuestro transporte ha sido reasignado por orden
	             del Emperador.~^";
	      print "^Darth Vader: ", (s_underline) "~¿A dónde lo ha enviado?~^";
	      print "^Comandante Vill: ", (s_underline) "~La nave transporta a los prisioneros civiles nosaurianos al mercado de esclavos de Orvax IV. 
	             Principalmente hembras y jóvenes... ¿Lord Vader?~^";
	      print (s_block) "^- FIN DE LA COMUNICACIÓN -^";
	      Achieved(7);
      }
      rtrue;
    ],
    out_to hangarNorte,
;

Object -> oComandanteVill "Comandante Vill"
  with
    name 'comandante' 'vill',
    description "El comandante Vill es el clon que está al mando de la Legión 501 desplazada al planeta.", 
    cabreado 0,
    life [tema;
	    Attack: print "No es una buena idea. Todos los imperiales del puerto espacial se te echarían encima.";
                rtrue;
        tell, ask, answer: 
              tema=AveriguarTema(AskTopics);
              switch(tema) {
	           t_bomo, t_familiabomo, t_ayuda,
               t_prisionero: print "^Comandante Vill: ", (s_underline) "~El transporte con los prisioneros nosaurianos ya ha partido hacia el mercado de esclavos 
                                   de Orvax IV. Este nativo ya no nos sirve para nada. Llévate al prisionero al exterior del puerto espacial y mátalo.~";
                             oBomo.orvax=1;
               t_fugitivos,
               t_jedis: print "^Comandante Vill: ", (s_underline) "~Los jedis son traidores al imperio. El emperador nos envió aquí porque piensa que un jedi 
                              humano lideraba la resistencia en este planeta. Pero estaba equivocado. Hemos aplastado completamente a los nativos y no hemos 
                              encontrado rastro de ningún humano, jedi o no jedi.~";
               t_republica: print "^Comandante Vill: ", (s_underline) "~La República se ha acabado. Nosotros servimos al emperador Palpatine.~";
               t_ejercito,
               t_imperio: print "^Comandante Vill: ", (s_underline) "~Nosotros somos el ejército del Imperio Galáctico y servimos al emperador Palpatine.~";
               t_cadgel,
               t_naves: print "^Comandante Vill: ", (s_underline) "~No permitiremos que ninguna nave despegue. Hay que inspeccionarlas todas en busca de
                              posibles fugitivos.~";
               t_vader,
               t_halfaxe: print "^Comandante Vill: ", (s_underline) "~No dejamos a ningún nativo con vida. Ha sido una gran victoria. Lord Vader nos ha
                                felicitado en persona.~";
               t_orvax: print "^Comandante Vill: ", (s_underline) "~Hay que ocuparse de los separatistas nosaurianos, obligándoles a trabajar. Harán
                              una contribución positiva al Imperio y se les perdonará la vida. Es una alternativa piadosa a lo que sería necesario
                              de lo contrario.~";
               t_mision,
               t_guerra: print "^Comandante Vill: ", (s_underline) "~Vinimos a este planeta para aplastar a la resistencia y hemos cumplido nuestra misión. 
                               Pronto volveremos a Coruscant y se nos asignará un nuevo destino.~";
               t_nombre: print "^Comandante Vill: ", (s_underline) "~¿No sabes quién es tu Comandante, soldado?~";
               t_simismo,
               t_vill: print "^Comandante Vill: ", (s_underline) "~Soy el Comandante Vill. Estoy al mando de la Legion 501 en este planeta.~";
               t_tacos: self.cabreado++;
                        print "^Comandante Vill: ", (s_underline) "~¡Lárgate de aquí, maldita escoria! ¡Como vuelva a verte serás comida
	                             de los animales!~";
	                    playerTo(hangarNorte, 2);
                        if (oBomo in location) move oBomo to hangarNorte;
               default: switch(random(6)) {
	                      1: print "^Comandante Vill: ", (s_underline) "~¿Qué dices? No me tomes el pelo o tendrás problemas, soldado.~"; 
	                      2: print "^Comandante Vill: ", (s_underline) "~¿Para eso me molestas? Vuelve a tu puesto, soldado.~"; 
	                      3: print "^Comandante Vill: ", (s_underline) "~No tengo tiempo para tonterías, soldado.~"; 
	                      4: print "^Comandante Vill: ", (s_underline) "~Ahora no puedo atenderte, soldado.~"; 
	                      5: print "^Comandante Vill: ", (s_underline) "~No puedo darte esa información, soldado.~"; 
	                      6: print "^Comandante Vill: ", (s_underline) "~¿Qué dices? No me tomes el pelo o tendrás problemas, soldado.~"; 
                        };
             };
             rtrue;
    ],
    orders [;
        Mild, Strong: self.cabreado++;
                      if (self.cabreado > 0) {
	                      print "^Comandante Vill: ", (s_underline) "~¡Lárgate de aquí, maldita escoria! ¡Como vuelva a verte serás comida
	                             de los animales!~";
	                      playerTo(hangarNorte, 2);
                          if (oBomo in location) move oBomo to hangarNorte;
	                      rtrue;
                      } 
      NotUnderstood, Tell: <<Ask self>>;
    ],
    before [;
        Levitar,
	    Push, Aturdir: print "No es una buena idea. Todos los imperiales del puerto espacial se te echarían encima.";
	                   rtrue;
        Enganyar: "La persuasión mediante la Fuerza sólo funciona con seres de mente débil, y el Comandante Vill no es uno de ellos.";
        Sentir, 
        Concentrar: print "La Fuerza está presente en todos los seres vivos.";
              rtrue;
    ],
has animate proper;

Lugar hangarSur "Hangar Sur"
  with
    sgw_img pngHangarSur,       ! el grafico de la localidad
    name 'hangar',
    description "Este es el hangar de la parte sur del puerto espacial de Cadgel Meadows. Puedes ver atracadas las naves Nuitedes, Valance y Vindus.",
    desc_extra 0,
    describe [;
      print (string) self.description;
      if (self hasnt visited) {
	      print "^Puedes ver como unos cuantos stormtroopers suben un cargamento de armas a la Valance. Antes de irse, chocan la mano del que parece
	             ser el capitán de la nave y éste vuelve al interior de la misma, cerrando la escotilla de acceso.";
	      Achieved(6);
      }
      print "^";
      <Salidas>;
      if (self.desc_extra==0 && oBomo in location) {
        print "^Bomo (susurrando): ", (s_underline) "~Mira todas esas naves, Dass. No ha despegado ninguna... Los imperiales controlan el puerto...
              ¡Esto me huele muy mal!¡Deberíamos averiguar donde está a mi familia y el resto de refugiados!~";
        hangarOeste.desc_extra=1;
        hangarEste.desc_extra=1;
        hangarNorte.desc_extra=1;
        hangarSur.desc_extra=1;
      }
      if (self.desc_extra==1 && oBomo.orvax==1 && oBomo in location) {
        print "^Bomo (susurrando): ", (s_underline) "~Se han llevado a Mesa y Resa para venderlas como esclavos, Dass... ¡Debemos robar 
              alguna de las naves y escapar de aquí para encontrar a mi familia!~";
        hangarOeste.desc_extra=2;
        hangarEste.desc_extra=2;
        hangarNorte.desc_extra=2;
        hangarSur.desc_extra=2;
      }
      rtrue;
    ],
    n_to pista,
;

Object -> oNuitedes "Nuitedes" 
  with
    name 'nuitedes',
    description "La Nuitedes es un carguero de la clase YT-2550. No parece que haya ningún tipo de actividad alrededor de esta nave.",
    before [;
      Disparar: if (location==CazaVwingS) "La Nuitedes no debería ser tu objetivo... La nave aliada con los imperiales es otra.^";
                print "No dispones de ningún arma de fuego a tu alcance.^";
                rtrue;
      Attack: if (location == CazaVwingS) {
	            <<disparar self>>;
              } else {
	            print "Sólo le causarías daño atacando con algo más potente que tu sable.";
              }
              rtrue;
      Take, Levitar: "Demasiado grande para ti. No eres tan poderoso.";
      Enter: "Estando cerrados los accesos, no encuentras ninguna forma de entrar a ",(the) self;
    ],
has scenery female objetivo;

Object -> oValance "Valance"
  with
    name 'valance',
    description "La Valance es un transporte de la clase Corona. No parece que haya ningún tipo de actividad alrededor de esta nave.",
    before [;
      Disparar: if (location==CazaVwingS) {
	              !silenceAll();
	              !playSound(chan1,sndMainTheme,1,VOLUMEN_ALTO);
	              Damusix.PararTodo();
	              Damusix.TocarV(sndExplosion,VOLUMEN_ALTO);
	              Damusix.AsignarCanal(sndMainTheme,0,VOLUMEN_ALTO,1);
	              Damusix.Tocar(sndMainTheme,0);
                  print "Liberas toda la potencia de fuego del caza sobre la Valance. Al ser un objetivo estático no tienes el menor problema en
                       alcanzarla de lleno, destruyéndola por completo.
                       ^Puedes ver como, tras recibir el aviso por radio del capitán de la Uhumele de que las tropas imperiales están atacando,
                       el resto de naves atracadas en Cadgel Meadows comienzan a despegar prácticamente a la vez, incluida la Uhumele. 
                       ^Aunque el ejército imperial comienza a disparar, el número de naves huyendo les sobrepasa y casi todas consiguen huir, dejándote
                       con la satisfacción del deber cumplido. Huyes tú también con el caza robado, hacia la Uhumele para reunirte con Bomo y con el 
                       resto de la tripulación.
                       ^^Próximo destino: Orvax IV.";
                  Achieved(10);
                  deadflag = 2; !FIN DEL JUEGO
                  rtrue;
                } else {
	                print "No dispones de ningún arma de fuego a tu alcance.^"; 
	                rtrue;
                }
      Attack: if (location == CazaVwingS) {
	            <<disparar self>>;
              } else {
	            print "Sólo le causarías daño atacando con algo más potente que tu sable.";
              }
              rtrue;
      Take, Levitar: "Demasiado grande para ti. No eres tan poderoso.";
      Enter: "Has visto como esta nave hacía negocios con las tropas imperiales. Seguramente colabora con ellos y te delatarían en cuanto
              entrases.";
    ],
has scenery female objetivo;

Object -> oVindus "Vindus"
  with
    name 'vindus',
    description "La Vindus es un carguero ligero de la clase B-7. No parece que haya ningún tipo de actividad alrededor de esta nave.",
    before [;
      Disparar: if (location==CazaVwingS) "La Vindus no debería ser tu objetivo... La nave aliada con los imperiales es otra.";
                print "No dispones de ningún arma de fuego a tu alcance.^";
                rtrue;
      Attack: if (location == CazaVwingS) {
	            <<disparar self>>;
              } else {
	            print "Sólo le causarías daño atacando con algo más potente que tu sable.";
              }
              rtrue;
      Take, Levitar: "Demasiado grande para ti. No eres tan poderoso.";
      Enter: "Estando cerrados los accesos, no encuentras ninguna forma de entrar a ",(the) self;
    ],
has scenery female objetivo;

Lugar hangarEste "Hangar Este"
  with
    sgw_img pngHangarEste,       ! el grafico de la localidad
    name 'hangar',
    description "Este es el hangar de la parte este del puerto espacial de Cadgel Meadows. Puedes ver atracadas las naves Solaine, Aeolus y Uhumele.",
    desc_extra 0,
    describe [;
      self.Lugar::describe();
      if (self.desc_extra==0 && oBomo in location) {
        print "^Bomo (susurrando): ", (s_underline) "~Mira todas esas naves, Dass. No ha despegado ninguna... Los imperiales controlan el puerto...
              ¡Esto me huele muy mal!¡Deberíamos averiguar donde está a mi familia y el resto de refugiados!~";
        hangarOeste.desc_extra=1;
        hangarEste.desc_extra=1;
        hangarNorte.desc_extra=1;
        hangarSur.desc_extra=1;
      }
      if (self.desc_extra==1 && oBomo.orvax==1 && oBomo in location) {
        print "^Bomo (susurrando): ", (s_underline) "~Se han llevado a Mesa y Resa para venderlas como esclavos, Dass... ¡Debemos robar 
              alguna de las naves y escapar de aquí para encontrar a mi familia!~";
        hangarOeste.desc_extra=2;
        hangarEste.desc_extra=2;
        hangarNorte.desc_extra=2;
        hangarSur.desc_extra=2;
      }
      rtrue;
    ],
    w_to pista,
    out_to extEste,
    before [;
	    go: if (noun == out_obj) {
		      if (player has disfrazado && oBomo in location) {
	            print "Capitán clon: ", (s_underline) "¡Soldado! ¡Entrega al prisionero en el cuartel de mando del hangar norte!";
	            rtrue;
              }
              if (player has disfrazado && oBomo notin location) {
	            playerTo(extEste,2);
	            bomo_sigue=0;
	            rtrue;
              }
              if (player has descubierto) {
	             print "Capitán clon: ", (s_underline) "¡HE DICHO QUE NO SE PUEDE PASAR!";
	          } else {
	            print "Capitán clon: ", (s_underline) "¡ALTO EN NOMBRE DEL IMPERIO! ¡NO SE PERMITE SALIR DEL RECINTO!";
		        give player descubierto;
	          };
	          rtrue;
            };
            if (noun == in_obj) {
		        if (oUhumele.abierta==0) {
			        print "La rampa de acceso a la nave está cerrada. Deberás esperar a que alguien la abra.^";
			        rtrue;
		        }
		        if (oUhumele.abierta==1) {
			        print "No podéis entrar a la Uhumele. Una mujer bloquea la única entrada.^";
		            rtrue;
		        };
		        if (oUhumele.abierta==2) {
			        print "Sin nadie vigilando el acceso a la Uhumele, entráis libremente al interior de la Uhumele.^";
			        playerTo(interiorUhumele,2);
			        move oBomo to interiorUhumele;
			        Achieved(8);
		            rtrue;
		        };
            };
    ],
;

Object -> oPatrulla2 "patrulla" 
  with
    name 'patrulla' 'guardia' 'soldados' 'capitan' 'soldado' 'clon' 'clones' 'salida' 'acceso' 'exterior',
    description "Una patrulla de clones controla la salida del puerto espacial. Puedes contar hasta 8 soldados imperiales 
                 cuidando el acceso al exterior de Cadgel Meadows.",
    bonif_defensiva 15,
    vida 60,
    dado_golpe 3 6 0, !3d6+0

    life [tema;
	    Attack: "Son demasiado numerosos para un ataque directo contra ellos.";
	    Tell, Ask,
	    Answer: tema=AveriguarTema(AskTopics);
	         switch (tema) {
		       t_tacos: print "Son muchos. No conviene enfadarlos.";
               t_jedis: print "Capitán clon: ", (s_underline) "~Los jedis son traidores al imperio.~";
               t_republica: print "Capitán clon: ", (s_underline) "~La República se ha acabado. Nosotros servimos al Imperio.~";
               t_imperio: print "Capitán clon: ", (s_underline) "~Nosotros somos el ejército del Imperio Galáctico y servimos al emperador.~";
               t_mision,t_ejercito,t_halfaxe,
               t_guerra: print "Capitán clon: ", (s_underline) "~Vinimos a este planeta para aplastar a la resistencia y hemos cumplido nuestra misión. 
                               Ahora esperamos a que comuniquen al Comandante Vill nuestro nuevo destino.~";
               t_cadgel,
               t_naves: print "Capitán clon: ",(s_underline) "~El Comandante Vill ha ordenado que ninguna nave despegue.~";
               t_bomo, t_fugitivos,t_vill,
               t_prisionero: print "Le dices al capitán de la patrulla que el Comandante Vill te ha ordenado llevar al prisionero al exterior para matarlo.^";
                             print "Capitán clon: ",(s_underline) "~En ese caso puedes pasar, soldado.~";
                             playerTo(extEste,2);
	                         move oBomo to extEste;
               default: print "~¿Qué dices? No me tomes el pelo o tendrás problemas, soldado.~"; 
             };
             rtrue;
    ],
    orders [;
      Mild, Strong: "Son muchos. No conviene enfadarlos.";
      NotUnderstood, Tell: <<Ask self>>;
    ],
    before [;
        Sentir, Concentrar: print "La Fuerta está presente en el interior de todos los seres vivos.";
              rtrue;
	    Levitar,
        Push, Aturdir: "Hay demasiados soldados para usar la Fuerza contra ellos.";
        Enganyar: if (player has descubierto) {
	                 give player ~descubierto;
	                 print "Dass: ",(s_underline) "~Somos amigos del Imperio.~^"; 
	                 print "Capitán clon: ",(s_underline) "~Son amigos del Imperio.~^"; 
	                 print "Dass: ",(s_underline) "~Se nos permite salir al exterior del puerto espacial.~^"; 
	                 print "Capitán clon: ",(s_underline) "~Se les permite salir al exterior del puerto espacial.~^";
	                 playerTo(extEste,2);
	                 move oBomo to extEste;
                  } else {
	                 print "Al acercaros a la salida, los guardias os descubren...^"; 
	                 print "Capitán clon: ", (s_underline) "~¡ALTO EN NOMBRE DEL IMPERIO! ¡NO SE PERMITE SALIR DEL RECINTO!~";
		             give player descubierto;
                  }
                  rtrue;
    ],
has female animate;

Object -> oSolaine "Solaine"  
  with
    name 'solaine',
    description "La Solaine es un carguero ligero de la clase HWK-290. No parece que haya ningún tipo de actividad alrededor de esta nave.",
    before [;
      Disparar: if (location == CazaVwingE) "La Solaine no debería ser tu objetivo... La nave aliada con los imperiales es otra.";
                print "No dispones de ningún arma de fuego a tu alcance.^";
                rtrue;
      Attack: if (location == CazaVwingE) {
	            <<disparar self>>;
              } else {
	            print "Sólo le causarías daño atacando con algo más potente que tu sable.";
              }
              rtrue;
      Take, Levitar: "Demasiado grande para ti. No eres tan poderoso.";
      Enter: "Estando cerrados los accesos, no encuentras ninguna forma de entrar a ",(the) self;
    ],
has scenery female objetivo;

Object -> oAeolus "Aeolus"
  with
    name 'aeolus',
    description "La Aeolus es un carguero ligero de la clase MC-18. No parece que haya ningún tipo de actividad alrededor de esta nave.",
    before [;
      Disparar: if (location == CazaVwingE) "La Aeolus no debería ser tu objetivo... La nave aliada con los imperiales es otra.";
                print "No dispones de ningún arma de fuego a tu alcance.^";
                rtrue;
      Attack: if (location == CazaVwingE) {
	            <<disparar self>>;
              } else {
	            print "Sólo le causarías daño atacando con algo más potente que tu sable.";
              }
              rtrue;
      Take, Levitar: "Demasiado grande para ti. No eres tan poderoso.";
      Enter: "Estando cerrados los accesos, no encuentras ninguna forma de entrar a ",(the) self;
   ],
has scenery female objetivo;

Object -> oUhumele "Uhumele"
  with
    name 'uhumele' 'nave',
    description [;
       if (self.abierta==0) "La Uhumele es una nave de transporte de la clase L4000. No parece que haya ningún tipo de actividad alrededor de esta nave.";
       else if (self.abierta==1) "La Uhumele es una nave de transporte de la clase L4000. La rampa de acceso está abierta, pero una mujer vigila el acceso.";
            else "La Uhumele es una nave de transporte de la clase L4000. La rampa de acceso está abierta.";
    ],
    abierta 0, !0: cerrada, 1:abierta (pero se cerrará siempre), 2:abierta definitiva
    each_turn [;
      if (self.abierta==2) rtrue;
      switch(random(3)) {
	      1: if (self.abierta==0) {
		       print "^Notas actividad cerca de la Uhumele. La rampa de acceso se abre y una mujer humana sale al exterior.";
		       self.abierta = 1;
		       move oCrys to hangarEste;
		       move oCrysAusente to limbo;
		       if (player has disfrazado) {
			       print "^La mujer repara en tí mientras murmura algo que no alcanzas a oir...";
			       print "^~Malditos imperiales...~ - es lo único que puedes leer en su mente antes de que se gire y vuelva al 
			             interior de la nave, cerrando la rampa de acceso tras ella, no sin antes echarte una última mirada 
			             llena de odio.";
			       self.abierta = 0;
			       move oCrys to limbo;
			       move oCrysAusente to hangarEste;
		       }
	         }
	      2: rtrue;
	      3: if (self.abierta==1) {
		       print "^La rampa de acceso de la Uhumele cierra justo después de que la mujer vuelva al interior.";
		       self.abierta = 0;
   		       move oCrys to limbo;
   		       move oCrysAusente to hangarEste;
	         }
	         if (oBomo.orvax==0) {
   		       switch(random(4)) {
	             1: print "^Bomo (susurrando): ", (s_underline) "~Dass... Deberíamos averiguar donde está a mi familia...~";
                 2: print "^Bomo (susurrando): ", (s_underline) "~No ha despegado ninguna nave... ¿Dónde estarán Mesa y Resa, Dass?.~";
                 3: print "^Bomo (susurrando): ", (s_underline) "~¿Por qué no habrán escapado todas estas naves? ¿Y dónde están Mesa y Resa?~";
               };
             } 
             if (oBomo.orvax==1) {
   		       switch(random(4)) {
	             1: print "^Bomo (susurrando): ", (s_underline) "~Dass... mi mujer y mi hija van a ser vendidas como esclavas...
	                      ¡Tenemos que salir de aquí e ir a buscarlas!~";
                 2: print "^Bomo (susurrando): ", (s_underline) "~Dass... Ayúdame a conseguir una nave para ir a buscar a mi familia.~";
                 3: print "^Bomo (susurrando): ", (s_underline) "~¡Tenemos que conseguir una nave y escapar de aquí como sea!~";
               };
             }
      }
      rtrue;
    ],
    before [;
      Enter:
        if (oUhumele.abierta==0) {
	        print "La rampa de acceso a la nave está cerrada. Deberás esperar a que alguien la abra.^";
	        rtrue;
        }
        if (oUhumele.abierta==1) {
	        print "No podéis entrar a la Uhumele. Una mujer bloquea la única entrada.^";
            rtrue;
        };
        if (oUhumele.abierta==2) {
	        print "Sin nadie vigilando el acceso a la Uhumele, entráis libremente al interior.^";
	        playerTo(interiorUhumele,2);
	        move oBomo to interiorUhumele;
	        Achieved(8);
            rtrue;
        };
      Disparar: if (location == CazaVwingE) "La Uhumele no debería ser tu objetivo... matarías a tu amigo Bomo y al resto de la tripulación.";
                print "No dispones de ningún arma de fuego a tu alcance.^";
                rtrue;
      Attack: if (location == CazaVwingE) {
	            <<disparar self>>;
              } else {
	            print "Sólo le causarías daño atacando con algo más potente que tu sable.";
              }
              rtrue;
      Levitar: "Demasiado grande para ti. No eres tan poderoso.";
    ],
has scenery female objetivo;

Object oCrys "Crys Taanzer" limbo
  with
    name 'crys' 'mujer' 'piloto' 'humana' 'chica',
    description [;
      if (self hasnt conocido) "Una hermosa mujer de raza humana de pelo largo y rubio y de ojos verdes. Por sus rasgos dirías que es originaria
        de algún remoto planeta del Borde Exterior, probablemente de Nadiem.";
      else "Crys Taanzer, la piloto de la Uhumele. Una belleza humana de ojos verdes y pelo largo y rubio.";
    ], 
    life [tema;
	    Attack: if (self hasnt conocido) {
		          print "De un salto te lanzas contra la mujer, empujándola al interior de la nave. La chica queda
	                  inconsciente al golpearse con una de las paredes.";
                  move self to limbo;
                  give self muerto;
                  oUhumele.abierta=2;
                } else {
	              print "Podría ser vuestra oportunidad de salir de Cadgel Meadows, así que no os conviene enfadarla.";
                }
                rtrue;
        tell,answer,
        ask: tema=AveriguarTema(AskTopics);
             if (self hasnt conocido) {
	           switch(tema) {
		         t_prisionero,
                 t_familiabomo,t_bomo: print "^Desconocida: ", (s_underline) "~Todos los nativos fueron capturados por las fuerzas
                       imperiales. Ahora idos~";
                 t_halfaxe,t_guerra: print "^Desconocida: ", (s_underline) "~Odio esta maldita guerra y a todos los que la han provocado.~";
                 t_fugitivos: print "^Desconocida: ", (s_underline) "~Si os buscan los imperiales no es asunto mio.~";
                 t_ayuda: print "^Desconocida: ", (s_underline) "~¿Por qué debería ayudaros?~";
                 t_cadgel,
                 t_naves: print "^Desconocida: ", (s_underline) "~Los imperiales han bloqueado todas las naves del puerto espacial y no 
                                nos dejan despegar.~";
                 t_hijocrys: print "^Desconocida: ", (s_underline) "~¿Quien te ha hablado de mi hijo? ¿Acaso eres un jedi?~";
                 t_jedis: print "^Desconocida: ", (s_underline) "~Odio a los jedis... no son de fiar. Odio a todos los que han provocado esta maldita Guerra.~";
                 t_ejercito,
                 t_imperio: print "^Desconocida: ", (s_underline) "~Odio al Imperio. Odio a todos los que han provocado esta maldita Guerra.~";
                 t_republica: print "^Desconocida: ", (s_underline) "~Odio a la República. Odio a todos los que han provocado esta maldita Guerra.~";
                 t_simismo,t_crys: print "^Desconocida: ", (s_underline) "~No te voy a hablar sobre mi. Vete si no quieres tener problemas.~";
                 t_nombre: print "^Desconocida: ", (s_underline) "~No te voy a decir mi nombre.~";
                 t_tacos: print "^Desconocida: ", (s_underline) "~¿Acaso buscáis problemas?.~";
                 default: print "^Desconocida: ", (s_underline) "~¿Qué dices? No me molestes o tendrás problemas.~"; 
               };
             } else {
	           switch(tema) {
                 t_hijocrys: print "^Crys Taanzer: ", (s_underline) "~¿Quien te ha hablado de mi hijo? ¿Acaso eres un jedi?~";
                 t_jedis: print "^Crys Taanzer: ", (s_underline) "~Odio a los jedis... no son de fiar. Odio a todos los que han provocado esta maldita guerra.~";
                 t_imperio: print "^Crys Taanzer: ", (s_underline) "~Odio al Imperio. Odio a todos los que han provocado esta maldita guerra.~";
                 t_republica: print "^Crys Taanzer: ", (s_underline) "~Odio a la República. Odio a todos los que han provocado esta maldita guerra.~";
                 t_nombre: print "^Crys Taanzer: ", (s_underline) "~Crys Taanzer, pero ya lo sabes.~";
                 t_simismo,t_crys: print "^Crys Taanzer: ", (s_underline) "~Ahora mismo no tengo ganas de hablar sobre mi.~";
                 t_guerra: print "^Crys Taanzer: ", (s_underline) "~Odio esta maldita guerra y a todos los que la han provocado.~";
                 default: print "^Crys Taanzer: ", (s_underline) "~Lo siento, no te puedo contestar a eso.~"; 
               };
             }
             viewImageSlide(pngCrys);
             rtrue;
    ],
    before [;
	    Push, Aturdir: if (self hasnt conocido) {
		                 print "Con una ráfaga de Fuerza que sale de tu mano abierta lanzas a la mujer al interior de la nave, quedando inconsciente
	                       al golpearse con una de las paredes.";
	                     move self to limbo;
	                     give self muerto;
	                     oUhumele.abierta=2;
                       } else {
	                     print "Podría ser vuestra oportunidad de salir de Cadgel Meadows, así que no os conviene enfadarla.";
                       }
	                   rtrue;
	    Levitar: "No deberías ir alardeando de tus poderes de jedi... son tiempos oscuros para los de tu Orden.";
        Enganyar: "La persuasión mediante la Fuerza sólo funciona con seres de mente débil.";
        Sentir, 
        Concentrar: print "Una gran pérdida entristece su buen corazón de madre, a la par que le da fuerzas para seguir adelante.";
              rtrue;
    ],
has female animate proper;

Object oCrysInconsciente "Crys Taanzer inconsciente" limbo
  with
    name 'crys' 'mujer' 'piloto' 'humana' 'chica' 'cuerpo' 'inconsciente',
    description [;
      if (location ~= interiorUhumele) "El cuerpo de la humana está en el interior de la nave. Debes acercarte para examinarlo.";
      if (oCrys hasnt conocido) "Una hermosa mujer de raza humana de pelo largo y rubio y de ojos verdes. Por sus rasgos dirías que es originaria
        de algún remoto planeta del Borde Exterior, probablemente de Nadiem. La has dejado inconsciente con tu ataque";
      else "Crys Taanzer, la piloto de la Uhumele. Una belleza humana de ojos verdes y pelo largo y rubio. Está inconsciente debido a tu ataque";
    ], 
    life [;
      default: "Está inconsciente.";
    ],
    before [;
	  Levitar: "No deberías ir alardeando de tus poderes de jedi... son tiempos oscuros para los de tu Orden.";
      Sanar: if (location ~= interiorUhumele) "El cuerpo de la humana está en el interior de la nave. Debes acercarte primero.";
             if (oSchurkHeren hasnt conocido) {
	            "Será mejor que no te acerques a la mujer mientras el resto de la tripulación te está apuntando.";
             } else {
	            "No deberías ir alardeando de tus poderes de jedi... son tiempos oscuros para los de tu Orden.";
             }
      Take,Push,PushDir,
      Pull,Kiss,
      WakeOther,Smell: if (location ~= interiorUhumele) "El cuerpo de la humana está en el interior de la nave. Debes acercarte primero.";
                       if (oSchurkHeren hasnt conocido) {
	                       "Será mejor que no te acerques a la mujer mientras el resto de la tripulación te está apuntando.";
                       } else {
	                       rfalse;
                       }
    ],
has scenery female animate;

Object oCrysAusente "Crys Taanzer" limbo
  with
    name 'crys' 'mujer' 'piloto' 'humana' 'chica',
    description "Una hermosa mujer de raza humana de pelo largo y rubio y de ojos verdes.", 
    before [;
      !Examine: "Una hermosa mujer de raza humana de pelo largo y rubio y de ojos verdes.";
      default: "La mujer ha vuelto al interior de la nave.";
    ],
has scenery female animate proper;

Lugar interiorUhumele "Interior de la Uhumele"
with 
  name 'uhumele',
  describe [;
      print "Te encuentras en el interior de la Uhumele. Aunque por fuera la nave está poco cuidada, el interior tiene muy buen aspecto, dando sensación
             de amplitud, calidez y limpieza. Puedes ver a su tripulación al completo.^";
      if (self hasnt visited) {
	      print (s_underline) "^~Vaya, vaya, vaya... Parece que tenemos invitados... Dadme un motivo satisfactorio para que no ordene a mi tripulación 
	          que abra fuego inmediatamente por atacar a uno de los míos...~"," -se dirige a vosotros un yarkora, que debe ser el capitán, mientras el 
	          resto de la tripulación os apunta con sus armas y cara de pocos amigos.^";
      }
      rtrue;
  ],
  out_to hangarEste,
  before [;
    go: if (oSchurkHeren hasnt conocido) {
	      print "^Capitán: ", (s_underline) "~¿No pensaréis iros sin decirme por qué entráis a mi nave atacando a mi tripulación y escondiéndoos?
                 Cualquiera diría que sois fugitivos del imperio...~";
          viewImageSlide(jpgSchurk);
          rtrue;
        }
        if (noun == out_obj && bomo_sigue==1 && oVwing in hangarNorte) {
	      print "Bomo: ", (s_underline) "~Dass, si no te importa, creo que estaré más seguro quedándome en la nave.~";
	      bomo_sigue=0;
	      move oCrys to self;
	      give oCrys ~muerto;
	      viewImageSlide(pngBomo);
	      print "^^";
        };
        if (noun == out_obj && oVwing in hangarNorte) {
	      print "Produciendo un ruido ensordecedor, una nave de combate pasa cerca de tu posición y aterriza en el hangar norte.^^";
        };
        rfalse;
  ],
;

Object oSchurkHeren "Schurk Heren" interiorUhumele
  with
    name 'capitan' 'yarkora' 'schurk' 'heren' 'humanoide',
    sgw_img jpgSchurk,
    cabreado 0,
    description "El capitán de la Uhumele es un yarkora, de alrededor de 2 metros de alto. Como todos los de su raza, sus manos son enormes, con tres
                dedos en cada una. Su gran nariz tiene forma de hocico y termina en unos mostachos a ambos lados de la misma.", 
    life [tema;
	    Attack: print "Podría ser vuestra oportunidad de salir de Cadgel Meadows, así que no os conviene enfadarlo.";
                rtrue;
        tell,answer,
        ask: tema=AveriguarTema(AskTopics);
               if (self hasnt conocido) {
	               switch (tema) {
		             t_prisionero,
                     t_familiabomo,t_bomo: print "^Capitán: ", (s_underline) "~Todos los refugiados nosaurianos fueron capturados por las fuerzas
                       imperiales. Los reunieron a todos y los subieron a una nave. ¡El imperio va a venderlos como esclavos a Orvax IV!~";
                       give self conocido;
                       oBomo.orvax=1;
                     t_halfaxe,t_guerra: print "^Capitán: ", (s_underline) "~¿El paso de Half-Axe? Si habréis sobrevivido a esa batalla debéis 
                       haber sido los únicos.~";
                       give self conocido;
                     t_imperio,
                     t_fugitivos: print "^Capitán: ", (s_underline) "~Así que no sois amigos del imperio... Entonces sois bienvenidos a mi nave.
                       Ninguno de los miembrose de mi tripulación siente simpatía por esos soldados. Además, nos mantienen atracados en el puerto 
                       espacial sin dejarnos salir de aquí.~";
                       give self conocido;
                     t_carga: print "^Capitán: ", (s_underline) "~¿Acaso sois jedis? Soy un simple mercader~";
                     t_ayuda: print "^Capitán: ", (s_underline) "~¿Por qué debería ayudaros si os negáis a responder a mi pregunta? ¿De dónde venís y
                                    de quién estáis huyendo?~";
                     default: if (self.cabreado==0) {
	                            print "^Capitán: ", (s_underline) "~Decidme, ¿por qué entráis a mi nave atacando a mi tripulación y escondiéndoos?
                                      Cualquiera diría que sois fugitivos del imperio...~";
                                self.cabreado = 1;
                              } else {
	                            print "^Capitán: ", (s_underline) "~No estáis respondiendo a mi pregunta. ¿De quien o qué huís que os ha traido 
	                                  hasta mi nave?~";
                                switch(random(3)) {
	                                1: print "^Bomo (susurrando): ", (s_underline) "~Dass... Creo que deberías decirle que buscamos a mi familia...~";
                                    2: print "^Bomo (susurrando): ", (s_underline) "~Dass... Tal vez debería saber que escapamos de Half Axe.~";
                                    3: print "^Bomo (pegándote un codazo): ", (s_underline) "~La cosa se pone fea... Creo que deberías contestar
                                              a lo que nos pregunta...~";
                                };
                              }; 
	               }
                   viewImageSlide(jpgSchurk);
	               rtrue;
               };
	           switch(tema) {
                 t_familiabomo,t_bomo: print "^Capitán: ", (s_underline) "~Todos los refugiados nosaurianos fueron capturados por las fuerzas
                     imperiales. Los reunieron a todos y los subieron a una nave. ¡El imperio va a venderlos como esclavos a Orvax IV!~";
                     give self conocido;
                     oBomo.orvax=1;
                 t_jedis,
                 t_imperio,
                 t_republica: print "^Capitán: ", (s_underline) "~A algunos de nosotros, Ko Vakier, Mezgraf y yo mismo, los excesos de la
                     República nos desbarataron la vida.^Otros, Crys, Meekerdin-Mass, deben su situación actual a la violencia del movimiento
                     separatista. Pero ninguno de nosotros tiene razón alguna para confiar en este nuevo Imperio... y no puede salir nada bueno
                     de que sus tropas inspeccionen nuestra nave.~";
                 t_simismo,t_tripulacion,t_nombre: print "^Capitán: ", (s_underline) "~Me llamo Schurk Heren, capitán de la Uhumele. La que atacásteis 
                     es mi piloto, Crys Taanzer. Con ella está Sniffles, el copiloto. Y a este lado están Mezgraf, Ko Valkier y el ingeniero 
                     Meekerdin-Maa y su ayudante Janks~";
                     give oCrys conocido;
                 t_crys: print "^Capitán: ", (s_underline) "~Es mi piloto, Crys Taanzer.~";
                         give oCrys conocido;
                 t_halfaxe,t_guerra: print "^Capitán: ", (s_underline) "~¿El paso de Half-Axe? Si habréis sobrevivido a esa batalla debéis haber sido
                                            los únicos.~";
                                     give self conocido;
                 t_ejercito: print "^Capitán: ", (s_underline) "~Acabo de recibir un mensaje de la Thorene. Los stormtroopers están 
                     inspeccionando todas las naves. Debemos escapar del bloqueo cuanto antes...~";
                 t_cadgel,
                 t_naves: print "^Capitán: ", (s_underline) "~Los imperiales han bloqueado todas las naves del puerto espacial y no permiten
                     despegar a ninguna. Necesitamos un plan para escapar.~";
                 t_mision: print "^Capitán: ", (s_underline) "~Sólo con un plan podriamos hacer que los capitanes del resto de naves despegaran todos al mismo
                     tiempo y colapsariamos las defensas imperiales. Así tendriamos una oportunidad de escapar.~";
                          print "^Sniffles: ", (s_underline) "~Jamás funcionará. La tripulación de la Valance está colaborando con los imperiales
                                para irse de rositas.~";
                          print "^Capitán: ", (s_underline) "~Dass, si consigues destruir la Valance, avisaremos por radio al resto de naves diciendo
                                que las tropas imperiales están atacando y así todas querrán despegar y huir al mismo tiempo.~";
                          move oVwing to hangarNorte;
                 t_ayuda,
                 t_orvax: print "^Capitán: ", (s_underline) "~Os ayudaremos a llegar a Orvax IV. Debemos hacer lo que podamos por
                     ayudar a nuestros camaradas esclavos. Pero primero debemos escapar de este bloqueo.~";
                     oBomo.orvax=1;
                 t_prisionero: print "^Capitán: ", (s_underline) "Se los han llevado a todos a Orvax IV. En estos tiempos convulsos hay suficiente
                     demanda para que los comperciantes puedan encontrar un comprador para prácticamente cualquier esclavo.";
                     oBomo.orvax=1;
                 t_carga: print "^Capitán: ", (s_underline) "~Digamos que ninguno queremos que los imperiales inspeccionen esta nave... Es todo lo 
                     que debes saber por ahora. Necesitamos un plan para escapar.~";
                 default: print "^Capitán: ", (s_underline) "~Lo siento, no te puedo contestar a eso.~"; 
               };
             viewImageSlide(jpgSchurk);
             rtrue;
    ],
    orders [;
        Mild, Strong: self.cabreado++;
                      if (self.cabreado < 2) {
	                      print "^Capitán: ", (s_underline) "~Haré como que no he escuchado eso que has dicho...~";
                          viewImageSlide(jpgSchurk);
	                      rtrue;
                      } 
                      if (self.cabreado < 3) {
	                      print "^Capitán: ", (s_underline) "~¿Vienes a mi nave a insultarme a mi y a mi tripulación? Vuelve a hacerlo y no tendré
	                            piedad contigo ni con tu amigo.~";
                          viewImageSlide(jpgSchurk);
	                      rtrue;
                      } else {
	                      print "Sin mediar palabra, ",(the) oSchurkHeren," ordena a su tripulación que abra fuego contra vosotros. Estáis rodeados
	                            y a escasa distancia. Sois un blanco demasiado fácil.";
	                      deadflag=5;
	                      rtrue;
                      }
      NotUnderstood, Tell: <<Ask self>>;
    ],
    before [;
	    Levitar: "No deberías ir alardeando de tus poderes de jedi... son tiempos oscuros para los de tu Orden.";
	    Push, Aturdir: print "Podría ser vuestra oportunidad de salir de Cadgel Meadows, así que no os conviene enfadarlo.";
	                   rtrue;
        Enganyar: "La persuasión mediante la Fuerza sólo funciona con seres de mente débil.";
        Sentir, 
        Concentrar: print "Aunque exteriormente no lo aparenta, el capitán Heren está inquieto por la posibilidad de que las tropas del imperio
              entren en la nave para inspeccionarla. Lo más probable es que sea un contrabandista y oculte alguna carga valiosa.";
              rtrue;
    ],
has animate proper objetivo transparent;

Object decorado_schurk oSchurkHeren
class decorado
with  describe
       'manos' "Son enormes. Como todos los de su raza, tiene 3 dedos en cada una." G_FEMENINO+G_PLURAL
       'mano' "Son enormes. Como todos los de su raza, tiene 3 dedos en cada una." G_FEMENINO
       'dedos' "Como todos los de su raza, tiene 3 dedos en cada mano." G_PLURAL
       'dedo' "Como todos los de su raza, tiene 3 dedos en cada mano." 0
       'nariz' "Tiene forma de hocico." G_FEMENINO
       'mostacho' "Como a todos los de su raza, el mostacho le cae por ambos lados del hocico." 0
       'mostachos' "Como a todos los de su raza, el mostacho le cae por ambos lados del hocico." G_PLURAL
       'hocico' "Grande y con mostachos a ambos lados." 0,
  before[;
    examine: rfalse;
    default: print "No conviene hacer eso."; rtrue;
  ],
;

Object oMezgraf "Mezgraf" interiorUhumele
  with
    name 'mezgraf' 'humanoide' 'togoriano' 'leon',
    description "Mezgraf es un togoriano de pelo blanco, un humanoide con aspecto de león. Lleva una marca de esclavo en su brazo derecho.", 
    life [tema;
	    Attack: print "Podría ser vuestra oportunidad de salir de Cadgel Meadows, así que no os conviene enfadarlo.";
                rtrue;
        tell,answer,
        ask: tema=AveriguarTema(AskTopics);
               if (oSchurkHeren hasnt conocido) {
	               print "^Mezgraf: ", (s_underline) "~Habla con el capitán.~";
	               rtrue;
               };
	           switch(tema) {
                 t_familiabomo,t_bomo: print "^Mezgraf: ", (s_underline) "~Todos los refugiados nosaurianos fueron caputurados por las fuerzas
                     imperiales. Los reunieron a todos y los subieron a una nave. ¡El imperio va a venderlos como esclavos a Orvax IV!~";
                     oBomo.orvax=1;
                 t_jedis,
                 t_republica: print "^Mezgraf: ", (s_underline) "~Los excesos de la República me llevaron a sufir la esclavitud en mis carnes.~";
                 t_simismo,t_nombre: print "^Mezgraf: ", (s_underline) "~Soy Mezgraf. Fui un esclavo antes de unirme a la Uhumele como cocinero.~";
                 t_halfaxe,t_guerra: print "^Mezgraf: ", (s_underline) "~Half-Axe ha sido una masacre. Los imperiales no hicieron prisioneros.~";
                 t_imperio,
                 t_ejercito: print "^Mezgraf: ", (s_underline) "~No confio en el recién creado Imperio Galáctico.~";
                 t_cadgel,
                 t_naves: print "^Mezgraf: ", (s_underline) "~Si conseguimos deshacernos de las que colaboran con el imperio, el resto de naves 
                    son de confianza y nos seguirán.~";
                 t_ayuda,t_mision: print "^Mezgraf: ", (s_underline) "~El plan del capitán es arriesgado pero podría funcionar.~";
                 t_orvax,
                 t_prisionero: print "^Mezgraf: ", (s_underline) "Para un esclavo, Orvax IV es el infierno en vida. No conozco ningún lugar
                     peor. Los esclavistas de allí comercian con cualquiera en el que vean algún beneficio. En los viejos tiempos, se quedaban
                     sólo con los que realmente se pudiesen vender... a los demás, normalmente niños o débiles, los expulsaban por las exlcusas
                     durante el transporte.";
                     oBomo.orvax=1;
                 t_tripulacion: print "^Mezgraf: ", (s_underline) "~Soy el cocinero de la Uhumele.~"; 
                 default: print "^Mezgraf: ", (s_underline) "~Lo siento, no te puedo contestar a eso.~"; 
               };
             rtrue;
    ],
    orders [;
        Mild, Strong: oSchurkHeren.cabreado++;
                      if (self.cabreado < 2) {
	                      print "^Capitán: ", (s_underline) "~Haré como que no he escuchado eso que has dicho...~";
	                      rtrue;
                      } 
                      if (self.cabreado < 3) {
	                      print "^Capitán: ", (s_underline) "~¿Vienes a mi nave a insultarme a mi y a mi tripulación? Vuelve a hacerlo y no tendré
	                            piedad contigo ni con tu amigo.~";
	                      rtrue;
                      } else {
	                      print "Sin mediar palabra, ",(the) oSchurkHeren," ordena a su tripulación que abra fuego contra vosotros. Estáis rodeados
	                            y a escasa distancia. Sois un blanco demasiado fácil.";
	                      deadflag=5;
	                      rtrue;
                      }
      NotUnderstood, Tell: <<Ask self>>;
    ],
    before [;
	    Levitar: "No deberías ir alardeando de tus poderes de jedi... son tiempos oscuros para los de tu Orden.";
	    Push, Aturdir: print "Podría ser vuestra oportunidad de salir de Cadgel Meadows, así que no os conviene enfadarlo.";
	                   rtrue;
        Enganyar: "La persuasión mediante la Fuerza sólo funciona con seres de mente débil.";
        Sentir, 
        Concentrar: print "El sufrimiento de su vida de esclavo está grabado en su interior.";
              rtrue;
    ],
has animate proper objetivo transparent;

Object decorado_mezgraf oMezgraf
class decorado
with  describe
       'pelo' "Una hermosa cabellera blanca." 0
       'brazo' "En el derecho destaca una marca típica de esclavo." 0
       'brazos' "En el derecho tiene una marca de esclavo." G_PLURAL
       'tatuaje' "Es una señal con la que suelen marcar a los esclavos." 0
       'marca' "Es una señal con la que suelen marcar a los esclavos." G_FEMENINO,
  before[;
    examine: rfalse;
    default: print "No conviene hacer eso."; rtrue;
  ],
;

Object oSniffles "Sniffles" interiorUhumele
  with
    name 'sniffles' 'elomin' 'humanoide',
    description "Sniffles es un elomin, un humanoide delgado con grandes orejas puntiagudas y cuatro protuberancias parecidas a pequeños 
                cuernos sobre su cabeza. Mide 1.90 de altura y su color de piel es granate brillante.", 
    life [tema;
	    Attack: print "Podría ser vuestra oportunidad de salir de Cadgel Meadows, así que no os conviene enfadarlo.";
                rtrue;
        tell,answer,
        ask: tema=AveriguarTema(AskTopics);
               if (oSchurkHeren hasnt conocido) {
	               print "^Sniffles: ", (s_underline) "~¡Responde al capitán!~";
	               rtrue;
               };
	           switch(tema) {
                 t_familiabomo,t_bomo: print "^Sniffles: ", (s_underline) "~Todos los refugiados nosaurianos fueron caputurados por las fuerzas
                     imperiales. Los reunieron a todos y los subieron a una nave. ¡El imperio va a venderlos como esclavos a Orvax IV!~";
                     oBomo.orvax=1;
                 t_jedis,
                 t_republica: print "^Sniffles: ", (s_underline) "~Los excesos de la República nos han llevado a esta situación.~";
                 t_simismo,t_nombre: print "^Sniffles: ", (s_underline) "~Soy Sniffles, copiloto de la nave.~";
                 t_halfaxe,t_guerra: print "^Sniffles: ", (s_underline) "~Half-Axe ha sido una masacre. Los imperiales no hicieron prisioneros.~";
                 t_imperio,
                 t_ejercito: print "^Sniffles: ", (s_underline) "~No confio en el recién creado Imperio Galáctico.~";
                 t_cadgel,
                 t_naves: print "^Sniffles: ", (s_underline) "~Si conseguimos deshacernos de las que colaboran con el imperio, el resto de naves 
                    son de confianza y nos seguirán.~";
                 t_ayuda,t_mision: print "^Sniffles: ", (s_underline) "~El plan del capitán es arriesgado pero podría funcionar.~";
                 t_orvax,t_prisionero: print "^Sniffles: ", (s_underline) "~Quien mejor te puede hablar sobre Orvax es Mezgraf.~"; 
                 t_tripulacion: print "^Sniffles: ", (s_underline) "~Soy el copiloto de la Uhumele.~"; 
                 default: print "^Sniffles: ", (s_underline) "~Lo siento, no te puedo contestar a eso.~"; 
               };
             rtrue;
    ],
    orders [;
        Mild, Strong: oSchurkHeren.cabreado++;
                      if (self.cabreado < 2) {
	                      print "^Capitán: ", (s_underline) "~Haré como que no he escuchado eso que has dicho...~";
	                      rtrue;
                      } 
                      if (self.cabreado < 3) {
	                      print "^Capitán: ", (s_underline) "~¿Vienes a mi nave a insultarme a mi y a mi tripulación? Vuelve a hacerlo y no tendré
	                            piedad contigo ni con tu amigo.~";
	                      rtrue;
                      } else {
	                      print "Sin mediar palabra, ",(the) oSchurkHeren," ordena a su tripulación que abra fuego contra vosotros. Estáis rodeados
	                            y a escasa distancia. Sois un blanco demasiado fácil.";
	                      deadflag=5;
	                      rtrue;
                      }
      NotUnderstood, Tell: <<Ask self>>;
    ],
    before [;
	    Levitar: "No deberías ir alardeando de tus poderes de jedi... son tiempos oscuros para los de tu Orden.";
	    Push, Aturdir: print "Podría ser vuestra oportunidad de salir de Cadgel Meadows, así que no os conviene enfadarlo.";
	                   rtrue;
        Enganyar: "La persuasión mediante la Fuerza sólo funciona con seres de mente débil.";
        Sentir, 
        Concentrar: print "La Fuerza no percibe nada extraño en el interior de Sniffles.";
              rtrue;
    ],
has animate proper objetivo transparent;

Object decorado_sniffles oSniffles
class decorado
with  describe
       'oreja' "Grandes y puntiagudas." G_FEMENINO
       'orejas' "Grandes y puntiagudas." G_FEMENINO+G_PLURAL
       'cuernos' "Cuatro pequeñas protuberancias en su cabeza." G_PLURAL
       'cuerno' "Cuatro pequeñas protuberancias en su cabeza." 0
       'protuberancia' "Cuatro pequeños cuernos en su cabeza." G_FEMENINO
       'protuberancias' "Cuatro pequeños cuernos en su cabeza." G_FEMENINO+G_PLURAL
       'piel' "Brillante y de color granate." G_FEMENINO,
  before[;
    examine: rfalse;
    default: print "No conviene hacer eso."; rtrue;
  ],
;

Object oKoVakier "Ko Vakier" interiorUhumele
  with
    name 'ko' 'vakier' 'humanoide' 'insecto',
    description "Ko Vakier es un humanoide con aspecto de insecto, de piel dorada y ojos oscuros.", 
    life [tema;
	    Attack: print "Podría ser vuestra oportunidad de salir de Cadgel Meadows, así que no os conviene enfadarlo.";
                rtrue;
        tell,answer,
        ask: tema=AveriguarTema(AskTopics);
               if (oSchurkHeren hasnt conocido) {
	               print "^Ko Vakier: ", (s_underline) "~¡Responde a lo que te pregunta el capitán!~";
	               viewImageSlide(pngRaty);
	               rtrue;
               };
	           switch(tema) {
                 t_familiabomo: print "^Ko Vakier: ", (s_underline) "~Todos los refugiados nosaurianos fueron caputurados por las fuerzas
                     imperiales. Los reunieron a todos y los subieron a una nave. ¡El imperio va a venderlos como esclavos a Orvax IV!~";
                     oBomo.orvax=1;
                 t_simismo,t_nombre: print "^Ko Vakier: ", (s_underline) "~Me llamo Ko Vakier, artillero de la Uhumele.~";
                 t_halfaxe,t_guerra: print "^Ko Vakier: ", (s_underline) "~Half-Axe ha sido una masacre. Los imperiales no hicieron prisioneros.~";
                 t_jedis,
                 t_republica: print "^Ko Vakier: ", (s_underline) "~No confio en la República. Sus excesos nos han llevado a esta guerra.~";
                 t_imperio,
                 t_ejercito: print "^Ko Vakier: ", (s_underline) "~No confio en el recién creado Imperio Galáctico.~";
                 t_cadgel,
                 t_naves: print "^Ko Vakier: ", (s_underline) "~Si conseguimos deshacernos de las que colaboran con el imperio, el resto de naves 
                    son de confianza y nos seguirán.~";
                 t_ayuda,t_mision: print "^Ko Vakier: ", (s_underline) "~El plan del capitán es arriesgado pero podría funcionar.~";
                 t_orvax,t_prisionero: print "^Ko Vakier: ", (s_underline) "~Quien mejor te puede hablar sobre Orvax es Mezgraf.~"; 
                 t_tripulacion: print "^Ko Vakier: ", (s_underline) "~Soy el encargado de la torreta de ataque de la Uhumele.~"; 
                 default: print "^Ko Vakier: ", (s_underline) "~Lo siento, no te puedo contestar a eso.~"; 
               };
             viewImageSlide(pngKoVakier);
             rtrue;
    ],
    orders [;
        Mild, Strong: oSchurkHeren.cabreado++;
                      if (self.cabreado < 2) {
	                      print "^Capitán: ", (s_underline) "~Haré como que no he escuchado eso que has dicho...~";
	                      rtrue;
                      } 
                      if (self.cabreado < 3) {
	                      print "^Capitán: ", (s_underline) "~¿Vienes a mi nave a insultarme a mi y a mi tripulación? Vuelve a hacerlo y no tendré
	                            piedad contigo ni con tu amigo.~";
	                      rtrue;
                      } else {
	                      print "Sin mediar palabra, ",(the) oSchurkHeren," ordena a su tripulación que abra fuego contra vosotros. Estáis rodeados
	                            y a escasa distancia. Sois un blanco demasiado fácil.";
	                      deadflag=5;
	                      rtrue;
                      }
      NotUnderstood, Tell: <<Ask self>>;
    ],
    before [;
	    Levitar: "No deberías ir alardeando de tus poderes de jedi... son tiempos oscuros para los de tu Orden.";
	    Push, Aturdir: print "Podría ser vuestra oportunidad de salir de Cadgel Meadows, así que no os conviene enfadarlo.";
	                   rtrue;
        Enganyar: "La persuasión mediante la Fuerza sólo funciona con seres de mente débil.";
        Sentir, 
        Concentrar: print "Notas mucho dolor en su interior.";
              rtrue;
    ],
has animate proper objetivo transparent;

Object decorado_kovakier oKoVakier
class decorado
with  describe
       'ojos' "Oscuros." G_PLURAL
       'piel' "Dorada." G_FEMENINO,
  before[;
    examine: rfalse;
    default: print "No conviene hacer eso."; rtrue;
  ],
;

Object oJanks "Janks" interiorUhumele
  with
    name 'janks' 'humanoide' 'phindiano',
    description "Janks es un Phindiano, humanoides desgarvados de aspecto triste y piel verde oscura con brazos extremadamente largos.", 
    life [tema;
	    Attack: print "Podría ser vuestra oportunidad de salir de Cadgel Meadows, así que no os conviene enfadarlo.";
                rtrue;
        tell,answer,
        ask: tema=AveriguarTema(AskTopics);

               if (oSchurkHeren hasnt conocido) {
	               print "^Janks: ", (s_underline) "~Aquí el que hace las preguntas es el capitán...~";
	               rtrue;
               };
	           switch(tema) {
                 t_familiabomo: print "^Janks: ", (s_underline) "~Todos los refugiados nosaurianos fueron caputurados por las fuerzas
                     imperiales. Los reunieron a todos y los subieron a una nave. ¡El imperio va a venderlos como esclavos a Orvax IV!~";
                     oBomo.orvax=1;
                 t_simismo,t_nombre: print "^Janks: ", (s_underline) "~Me llamo Janks, y soy el ayudante del ingeniero jefe Meekerdin-maa.~";
                 t_halfaxe,t_guerra: print "^Janks: ", (s_underline) "~Half-Axe ha sido una masacre. Los imperiales no hicieron prisioneros.~";
                 t_jedis,
                 t_republica: print "^Janks: ", (s_underline) "~Los excesos de la República nos han llevado a esta situación.~";
                 t_imperio,
                 t_ejercito: print "^Janks: ", (s_underline) "~No confio en el recién creado Imperio Galáctico.~";
                 t_cadgel,
                 t_naves: print "^Janks: ", (s_underline) "~Si conseguimos deshacernos de las que colaboran con el imperio, el resto de naves 
                    son de confianza y nos seguirán.~";
                 t_ayuda,t_mision: print "^Janks: ", (s_underline) "~El plan del capitán es arriesgado pero podría funcionar.~";
                 t_orvax,t_prisionero: print "^Janks: ", (s_underline) "~Quien mejor te puede hablar sobre Orvax es Mezgraf.~"; 
                 t_tripulacion: print "^Janks: ", (s_underline) "~Soy el ayudante de el ingeniero jefe Meekerdin-maa.~"; 
                 default: print "^Janks: ", (s_underline) "~Lo siento, no te puedo contestar a eso.~"; 
               };
             rtrue;
    ],
    orders [;
        Mild, Strong: oSchurkHeren.cabreado++;
                      if (self.cabreado < 2) {
	                      print "^Capitán: ", (s_underline) "~Haré como que no he escuchado eso que has dicho...~";
	                      rtrue;
                      } 
                      if (self.cabreado < 3) {
	                      print "^Capitán: ", (s_underline) "~¿Vienes a mi nave a insultarme a mi y a mi tripulación? Vuelve a hacerlo y no tendré
	                            piedad contigo ni con tu amigo.~";
	                      rtrue;
                      } else {
	                      print "Sin mediar palabra, ",(the) oSchurkHeren," ordena a su tripulación que abra fuego contra vosotros. Estáis rodeados
	                            y a escasa distancia. Sois un blanco demasiado fácil.";
	                      deadflag=5;
	                      rtrue;
                      }
      NotUnderstood, Tell: <<Ask self>>;
    ],
    before [;
	    Levitar: "No deberías ir alardeando de tus poderes de jedi... son tiempos oscuros para los de tu Orden.";
	    Push, Aturdir: print "Podría ser vuestra oportunidad de salir de Cadgel Meadows, así que no os conviene enfadarlo.";
	                   rtrue;
        Enganyar: "La persuasión mediante la Fuerza sólo funciona con seres de mente débil.";
        Sentir, 
        Concentrar: print "La Fuerza no percibe nada extraño en el interior de Janks.";
              rtrue;
    ],
has animate proper objetivo transparent;

Object decorado_janks oJanks
class decorado
with  describe
       'brazos' "Extremadamente largos." G_PLURAL
       'piel' "Verde." G_FEMENINO,
  before[;
    examine: rfalse;
    default: print "No conviene hacer eso."; rtrue;
  ],
;

Object oMeekerdin "Meekerdin-maa" interiorUhumele
  with
    name 'Meekerdin-maa' 'Meekerdin' 'maa' 'roedor' 'tintinna' 'raty',
    description "Meekerdin-maa es un Tintinna, una especie con aspecto de roedores que no llegan al metro de altura.", 
    life [tema;
	    Attack: print "Podría ser vuestra oportunidad de salir de Cadgel Meadows, así que no os conviene enfadarlo.";
                rtrue;
        tell,answer,
        ask: tema=AveriguarTema(AskTopics);
               if (oSchurkHeren hasnt conocido) {
	               print "^Meekerdin-maa: ", (s_underline) "~Pregunta al capitán...~";
	               viewImageSlide(pngRaty);
	               rtrue;
               };
	           switch(tema) {
                 t_familiabomo: print "^Meekerdin-maa: ", (s_underline) "~Todos los refugiados nosaurianos fueron caputurados por las fuerzas
                     imperiales. Los reunieron a todos y los subieron a una nave. ¡El imperio va a venderlos como esclavos a Orvax IV!~";
                     oBomo.orvax=1;
                 t_simismo,t_nombre: print "^Meekerdin-maa: ", (s_underline) "~Me llamo Meekerdin-maa y soy el ingeniero jefe.~";
                 t_halfaxe,t_guerra: print "^Meekerdin-maa: ", (s_underline) "~Half-Axe ha sido una masacre. Los imperiales no hicieron prisioneros.~";
                 t_jedis,
                 t_republica: print "^Meekerdin-maa: ", (s_underline) "~Los excesos de la República nos han llevado a esta situación.~";
                 t_imperio,
                 t_ejercito: print "^Meekerdin-maa: ", (s_underline) "~No confio en el recién creado Imperio Galáctico.~";
                 t_cadgel,
                 t_naves: print "^Meekerdin-maa: ", (s_underline) "~Si conseguimos deshacernos de las que colaboran con el imperio, el resto de naves 
                    son de confianza y nos seguirán.~";
                 t_ayuda,t_mision: print "^Meekerdin-maa: ", (s_underline) "~El plan del capitán es arriesgado pero podría funcionar.~";
                 t_orvax,t_prisionero: print "^Meekerdin-maa: ", (s_underline) "~Quien mejor te puede hablar sobre Orvax es Mezgraf.~"; 
                 t_tripulacion: print "^Meekerdin-maa: ", (s_underline) "~Soy el el ingeniero jefe de esta nave.~"; 
                 default: print "^Meekerdin-maa: ", (s_underline) "~Lo siento, no te puedo contestar a eso.~"; 
               };
             viewImageSlide(pngRaty);
             rtrue;
    ],
    orders [;
        Mild, Strong: oSchurkHeren.cabreado++;
                      if (self.cabreado < 2) {
	                      print "^Capitán: ", (s_underline) "~Haré como que no he escuchado eso que has dicho...~";
	                      rtrue;
                      } 
                      if (self.cabreado < 3) {
	                      print "^Capitán: ", (s_underline) "~¿Vienes a mi nave a insultarme a mi y a mi tripulación? Vuelve a hacerlo y no tendré
	                            piedad contigo ni con tu amigo.~";
	                      rtrue;
                      } else {
	                      print "Sin mediar palabra, ",(the) oSchurkHeren," ordena a su tripulación que abra fuego contra vosotros. Estáis rodeados
	                            y a escasa distancia. Sois un blanco demasiado fácil.";
	                      deadflag=5;
	                      rtrue;
                      }
      NotUnderstood, Tell: <<Ask self>>;
    ],
    before [;
	    Levitar: "No deberías ir alardeando de tus poderes de jedi... son tiempos oscuros para los de tu Orden.";
	    Push, Aturdir: print "Podría ser vuestra oportunidad de salir de Cadgel Meadows, así que no os conviene enfadarlo.";
	                   rtrue;
        Enganyar: "La persuasión mediante la Fuerza sólo funciona con seres de mente débil.";
        Sentir, 
        Concentrar: print "Meekerdin-maa refleja bondad y siente una especial pena por Bomo por haber perdido a su familia.";
              rtrue;
    ],
has animate proper objetivo transparent;

Lugar hangarOeste "Hangar Oeste"
  with
    sgw_img pngHangarOeste,       ! el grafico de la localidad
    name 'hangar',
    description "Este es el hangar de la parte oeste del puerto espacial de Cadgel Meadows. Puedes ver atracadas las naves Thorene, Haltia y Dzina.",
    desc_extra 0,
    describe [;
      self.Lugar::describe();
      if (self.desc_extra==0 && oBomo in location) {
        print "^Bomo (susurrando): ", (s_underline) "~Mira todas esas naves, Dass. No ha despegado ninguna... Los imperiales controlan el puerto...
              ¡Esto me huele muy mal!¡Deberíamos averiguar donde está a mi familia y el resto de refugiados!~";
        hangarOeste.desc_extra=1;
        hangarEste.desc_extra=1;
        hangarNorte.desc_extra=1;
        hangarSur.desc_extra=1;
      }
      if (self.desc_extra==1 && oBomo.orvax==1 && oBomo in location) {
        print "^Bomo (susurrando): ", (s_underline) "~Se han llevado a Mesa y Resa para venderlas como esclavos, Dass... ¡Debemos robar 
              alguna de las naves y escapar de aquí para encontrar a mi familia!~";
        hangarOeste.desc_extra=2;
        hangarEste.desc_extra=2;
        hangarNorte.desc_extra=2;
        hangarSur.desc_extra=2;
      }
      rtrue;
    ],
    e_to pista,
;

Object -> oThorene "Thorene"  
  with
    name 'thorene',
    description "La Thorene es un carguero de la clase WR-542. No parece que haya ningún tipo de actividad alrededor de esta nave.",
    before [;
      Disparar: if (location == CazaVwingO) "La Thorene no debería ser tu objetivo... La nave aliada con los imperiales es otra.";
                print "No dispones de ningún arma de fuego a tu alcance.^";
                rtrue;
      Attack: if (location == CazaVwingO) {
	            <<disparar self>>;
              } else {
	            print "Sólo le causarías daño atacando con algo más potente que tu sable.";
              }
              rtrue;
      Take, Levitar: "Demasiado grande para ti. No eres tan poderoso.";
      Enter: "Estando cerrados los accesos, no encuentras ninguna forma de entrar a ",(the) self;
    ],
has scenery female objetivo;

Object -> oHaltia "Haltia"
  with
    name 'haltia',
    description "La Haltia es un starfighter de la clase Z-95. No parece que haya ningún tipo de actividad alrededor de esta nave.",
    before [;
      Disparar: if (location == CazaVwingO) "La Haltia no debería ser tu objetivo... La nave aliada con los imperiales es otra.";
                print "No dispones de ningún arma de fuego a tu alcance.^";
                rtrue;
      Attack: if (location == CazaVwingO) {
	            <<disparar self>>;
              } else {
	            print "Sólo le causarías daño atacando con algo más potente que tu sable.";
              }
              rtrue;
      Take, Levitar: "Demasiado grande para ti. No eres tan poderoso.";
      Enter: "Estando cerrados los accesos, no encuentras ninguna forma de entrar a ",(the) self;
    ],
has scenery female objetivo;

Object -> oDzina "Dzina"
  with
    name 'dzina',
    description "La Dzina es un carguero ligero de la clase YT-1300. No parece que haya ningún tipo de actividad alrededor de esta nave.",
    before [;
      Disparar: if (location == CazaVwingO) "La Dzina no debería ser tu objetivo... La nave aliada con los imperiales es otra.";
                print "No dispones de ningún arma de fuego a tu alcance.^";
                rtrue;
      Attack: if (location == CazaVwingO) {
	            <<disparar self>>;
              } else {
	            print "Sólo le causarías daño atacando con algo más potente que tu sable.";
              }
              rtrue;
      Take, Levitar: "Demasiado grande para ti. No eres tan poderoso.";
      Enter: "Estando cerrados los accesos, no encuentras ninguna forma de entrar a ",(the) self;
    ],
has scenery female objetivo;


Lugar pista "Pista"
  with
  !sgw_img grfSantaLucia,       ! el grafico de la localidad
    name 'pista',
    description "La pista del puerto espacial de Cadgel Meadows está inusualmente despejada. Los soldados imperiales 
                 han bloqueado todas las naves y no permiten despegar a nadie.",
    n_to hangarNorte,
    s_to hangarSur,
    e_to hangarEste,
    w_to hangarOeste,
;

Object decorado_pista pista
class decorado
with  describe
       'naves' "Las naves están bloqueadas en los hangares." G_FEMENINO+G_PLURAL
       'nave' "Las naves están bloqueadas en los hangares." G_FEMENINO+G_PLURAL,
  before[;
    take, touch, push, pull: print "No puedes ",LanguageVerb(verb_word), " ",(the)self,". Sólo ",(es)self," decorado."; rtrue;
  ],
;


! EN EL INTERIOR DE LA UHUMELE


! SOBREVOLANDO CADGEL MEADOWS CON EL V-WING
Object oVwing "V-wing"
with
    name 'v-wing' 'caza' 'nave',
    description "Es un caza V-wing, una nave de combate rápida y manejable. Parece que acaban de repostarla y rearmarla.",
    before [;
      Enter:
        if (player hasnt disfrazado ) {
	        print "Los soldados clon te acribillarán antes de que puedas acercarte a ella. Debes encontrar otra manera de conseguir una nave.^";
	        rtrue;
        }
        if (player has disfrazado) {
	        print "Disfrazado de soldado clon consigues subir sin mayor problema al caza.^";
            playerTo(CazaVwing, 2);
            Achieved(9);
            rtrue;
        };
      Take: "Coger un caza es imposible incluso para un jedi.";
      Levitar: "Aunque podrías, no conviene alardear públicamente de tus poderes de Jedi en estos tenebrosos tiempos.";
    ],
has static;

Lugar CazaVwing "Cabina del V-wing (en el hangar norte)"
  with
    sgw_img jpgCaza,       ! el grafico de la localidad
    sgw_mus sndEnelcaza,  ! la musica de la localidad
    sgw_vol VOLUMEN_BAJO,
    name 'v-wing' 'caza',
    description "Desde el interior de la cabina del caza puedes ver el resto de naves del hangar. El cuadro de mandos de los cazas V-wing es bastante
                 sencillo. A parte de numerosos indicadores, puedes identificar claramente la palanca de mando con la que pilotar la nave.",
    out_to hangarNorte,
    u_to CazaVwingN,
    before [;
      go: if (noun ~= u_obj && noun ~= out_obj) {
            print "No puedes pilotar el caza por el puerto espacial a ras del suelo. Debes subir y ganar altura para poder moverte.";
            rtrue;
          };
      Levitar: "Demasiado grande para ti. No eres tan poderoso.";
    ],
    each_turn [;
      if (caza_countdown < 1) {
	      print "El efecto sorpresa que habías producido en el ejército imperial con el robo del caza se ha esfumado y desde el interior de la cabina
	             puedes llegar a ver como prácticamente todos los cañones láser del puerto espacial apuntan hacia ti y disparan.
	             ^Lo último que ves antes de sentir como explota tu nave es el resto de las naves despegando a la vez en un 
	             intento desesperado por escapar.";
	      deadflag=6;
      }
      if (caza_countdown == 10) {
	      !playSound(chan1,sndAlarma,-1,VOLUMEN_ALTO);
	      Damusix.AsignarCanal(sndAlarma,0,VOLUMEN_ALTO,-1);
	      Damusix.Tocar(sndAlarma,0);
	      print "^Una alarma comienza a sonar por todo el puerto espacial.";
      }
      if (caza_countdown == 7) print "^Desde la cabina del caza puedes ver el revuelo entre las tropas imperiales y como algunas patrullas se dirigen
                                corriendo hacia los cañones láser de defensa.";
      if (caza_countdown == 5) print "^Los cañones de todo el perímetro del puerto espacial comienzan a apuntar hacia el caza que pilotas.";
      if (caza_countdown == 3) print "^¡Uf! Ese disparo pasó muy cerca de tu posición.";
      if (caza_countdown == 1) print "^En el último segundo, haciendo gala de grandes reflejos, consigues esquivar por bien poco el disparo de uno
                               de los cañones imperiales.";
      caza_countdown--;
      rtrue;
	],
has nosalidas;

Object -> oCuadro "cuadro de mandos"
with
    name 'cuadro' 'mandos',
    description "El cuadro de mandos de los cazas V-wing es bastante sencillo. A parte de numerosos indicadores, puedes identificar 
                claramente la palanca de mando con la que pilotar la nave.",
    found_in CazaVwing CazaVwingN CazaVwingS CazaVwingE CazaVwingO CazaVwingP,
has scenery;

Object -> oIndicadores "indicadores"
with
    name 'indicadores' 'indicador' 'luz' 'luces',
    adjectives 'luminosos' 'digitales' 'luminoso' 'digital',
    description "La cabina de la nave está llena de diversos indicadores luminosos y digitales, para informar de cualquier aspecto sobre el estado de la
                 nave, del vuelo o del armamento.",
    found_in CazaVwing CazaVwingN CazaVwingS CazaVwingE CazaVwingO CazaVwingP,
has pluralname scenery;

Object -> oNave "nave"
with
    name 'nave' 'caza',
    description [; <<look>>;],
    found_in CazaVwing CazaVwingN CazaVwingS CazaVwingE CazaVwingO CazaVwingP,
    before [;
      examine: <<examine oCuadro>>;
      SwitchOn,SwitchOff: <<pilotar self>>; 
    ],
has scenery switchable;

Object -> oPalancaMando "palanca de mando"
with
    name 'palanca' 'mando',
    description [;
      print "Sirve para pilotar el caza y se puede mover en 5 direcciones (izquierda, derecha, delante, arriba y abajo). ",(string) DireccionCaza(self.direccion);
    ],
    found_in CazaVwing CazaVwingN CazaVwingS CazaVwingE CazaVwingO CazaVwingP,
    direccion 's',
    before [;
      Push,Pull: "Recuerdas que, siendo todavía un padawan, te enseñaron en el templo Jedi que había que mover la palanca en algunas direcciones.";
      Transfer,
      PushDir:
        if (second == u_obj ) {
	        if (location == CazaVwing) {
		        self.direccion='s';
		        print "Moviendo la palanca hacia arriba consigues que la nave se eleve en el aire.^";
		        print "La nave está encarada hacia la pista.^";
		        <<Subir>>;
	        } else {
		        print "La nave ya está en el aire.^";
	        }
	        rtrue;
        }
        if (second == d_obj ) {
	        if (location == CazaVwingN) {
		        print "Moviendo la palanca hacia abajo consigues posar la nave en el suelo del hangar norte.^";
		        <<Bajar>>;
	        } else {
		        if (location == CazaVwing) {
		          print "La nave ya está en el suelo.^";
		        } else {
		          print "No localizas ningún sitio donde hacer aterrizar la nave de manera segura.^";
	            }
	        }
	        rtrue;
        }
        if (location == CazaVwing) {
	        print "No puedes pilotar el caza por el puerto espacial a ras del suelo. Debes subir y ganar altura para poder moverte.";
	        rtrue;
        }
        if (second == e_obj or derecha_obj ) {
	        print "La nave gira hacia la derecha.^";
	        switch (self.direccion) {
		        's': print (string) GirarCaza(self.direccion,'d');
		             self.direccion='o';
		        'o': print (string) GirarCaza(self.direccion,'d');
		             self.direccion='n';
		        'n': print (string) GirarCaza(self.direccion,'d');
		             self.direccion='e';
		        'e': print (string) GirarCaza(self.direccion,'d');
		             self.direccion='s';
	        }
	        rtrue;
        }
        if (second == w_obj or izquierda_obj) {
	        print "La nave gira hacia la izquierda.^";
	        switch (self.direccion) {
		        's': print (string) GirarCaza(self.direccion,'i');
		             self.direccion='e';
		        'o': print (string) GirarCaza(self.direccion,'i');
		             self.direccion='s';
		        'n': print (string) GirarCaza(self.direccion,'i');
		             self.direccion='o';
		        'e': print (string) GirarCaza(self.direccion,'i');
		             self.direccion='n';
	        }
	        rtrue;
        }
        if (second == n_obj or delante_obj) {
	        switch (self.direccion) {
		        's': <<go s_obj>>;
		        'o': <<go w_obj>>;
		        'n': <<go n_obj>>;
		        'e': <<go e_obj>>;
	        }
	        rtrue;
        }
        if (second == s_obj ) {
	        print "La palanca no se puede mover en esa dirección.^";
	        rtrue;
        }
    ],
has female static;

Lugar CazaVwingN "Cabina del V-wing (sobrevolando hangar norte)"
  with
    sgw_img jpgCaza,       ! el grafico de la localidad
    sgw_mus sndEnelcaza,  ! la musica de la localidad
    sgw_vol VOLUMEN_BAJO,
    name 'v-wing' 'caza',
    describe [;
      print "Sobrevuelas el hangar norte. Puedes ver las naves imperiales. ", (string) DireccionCaza(oPalancaMando.direccion);
      rtrue;
    ],
    d_to CazaVwing,
    s_to CazaVwingP,
    before [;
      go: if (noun ~= d_obj && noun ~= s_obj) {
            print "No es momento de dar una vuelta con la nave. Si no terminas pronto lo que debes hacer, el efecto sorpresa se evaporará y
                   seguramente serás abatido por los clones.";
            rtrue;
          };
          if (noun == s_obj) print "La nave avanza sobrevolando Cadgel Meadows...^";
    ],
    each_turn [;
      if (caza_countdown < 1) {
	      print "El efecto sorpresa que habías producido en el ejército imperial con el robo del caza se ha esfumado y desde el interior de la cabina
	             puedes llegar a ver como prácticamente todos los cañones láser del puerto espacial apuntan hacia ti y disparan.
	             ^Lo último que ves antes de sentir como explota tu nave es el resto de las naves despegan a la vez en un intento desesperado de escapar.";
	      deadflag=6;
      }
      if (caza_countdown == 10) {
	      !playSound(chan1,sndAlarma,-1,VOLUMEN_ALTO);
	      Damusix.AsignarCanal(sndAlarma,0,VOLUMEN_ALTO,-1);
	      Damusix.Tocar(sndAlarma,0);
	      print "^Una alarma comienza a sonar por todo el puerto espacial.";
      }
      if (caza_countdown == 7) print "^Desde la cabina del caza puedes ver el revuelo entre las tropas imperiales y como algunas patrullas se dirigen
                                corriendo hacia los cañones láser de defensa.";
      if (caza_countdown == 5) print "^Los cañones de todo el perímetro del puerto espacial comienzan a apuntar hacia el caza que pilotas.";
      if (caza_countdown == 3) print "^¡Uf! Ese disparo pasó muy cerca de tu posición.";
      if (caza_countdown == 1) print "^En el último segundo, haciendo gala de grandes reflejos, consigues esquivar por bien poco el disparo de uno
                               de los cañones imperiales.";
      caza_countdown--;
      rtrue;
	],
has nosalidas;

Lugar CazaVwingS "Cabina del V-wing (sobrevolando hangar sur)"
  with
    sgw_img jpgCaza,       ! el grafico de la localidad
    sgw_mus sndEnelcaza,  ! la musica de la localidad
    sgw_vol VOLUMEN_BAJO,
    name 'v-wing' 'caza',
    describe [;
      print "Sobrevuelas el hangar sur. Puedes ver el resto de naves del hangar (la Nuitedes, la Valance y la Vindus). 
            ^El cuadro de mandos de los cazas V-wing es bastante sencillo. A parte de numerosos indicadores, puedes identificar 
            claramente la palanca de mando con la que pilotar la nave. ", (string) DireccionCaza(oPalancaMando.direccion);
      rtrue;
    ],
    n_to CazaVwingP,
    before [;
      go: if (noun ~= n_obj) {
            print "No es momento de dar una vuelta con la nave. Si no terminas pronto lo que debes hacer, el efecto sorpresa se evaporará y
                   seguramente serás abatido por los clones.";
            rtrue;
          };
          print "La nave avanza sobrevolando Cadgel Meadows...^";
    ],
    each_turn [;
      if (caza_countdown < 1) {
	      print "El efecto sorpresa que habías producido en el ejército imperial con el robo del caza se ha esfumado y desde el interior de la cabina
	             puedes llegar a ver como prácticamente todos los cañones láser del puerto espacial apuntan hacia ti y disparan.
	             ^Lo último que ves antes de sentir como explota tu nave es el resto de las naves despegan a la vez en un intento desesperado de escapar.";
	      deadflag=6;
      }
      if (caza_countdown == 10) {
	      !playSound(chan1,sndAlarma,-1,VOLUMEN_ALTO);
	      Damusix.AsignarCanal(sndAlarma,0,VOLUMEN_ALTO,-1);
	      Damusix.Tocar(sndAlarma,0);
	      print "^Una alarma comienza a sonar por todo el puerto espacial.";
      }
      if (caza_countdown == 7) print "^Desde la cabina del caza puedes ver el revuelo entre las tropas imperiales y como algunas patrullas se dirigen
                                corriendo hacia los cañones láser de defensa.";
      if (caza_countdown == 5) print "^Los cañones de todo el perímetro del puerto espacial comienzan a apuntar hacia el caza que pilotas.";
      if (caza_countdown == 3) print "^¡Uf! Ese disparo pasó muy cerca de tu posición.";
      if (caza_countdown == 1) print "^En el último segundo, haciendo gala de grandes reflejos, consigues esquivar por bien poco el disparo de uno
                               de los cañones imperiales.";
      caza_countdown--;
      rtrue;
	],
;

Lugar CazaVwingE "Cabina del V-wing (sobrevolando hangar este)"
  with
    sgw_img jpgCaza,       ! el grafico de la localidad
    sgw_mus sndEnelcaza,  ! la musica de la localidad
    sgw_vol VOLUMEN_BAJO,
    name 'v-wing' 'caza',
    describe [;
      print "Sobrevuelas el hangar este. Puedes ver el resto de naves del hangar (la Solaine, la Aeolus y la Uhumele). 
            ^El cuadro de mandos de los cazas V-wing es bastante sencillo. A parte de numerosos indicadores, puedes identificar 
            claramente la palanca de mando con la que pilotar la nave. ",(string) DireccionCaza(oPalancaMando.direccion);
      rtrue;
    ],
    w_to CazaVwingP,
    before [;
      go: if (noun ~= w_obj) {
            print "No es momento de dar una vuelta con la nave. Si no terminas pronto lo que debes hacer, el efecto sorpresa se evaporará y
                   seguramente serás abatido por los clones.";
            rtrue;
          };
          print "La nave avanza sobrevolando Cadgel Meadows...^";
    ],
    each_turn [;
      if (caza_countdown < 1) {
	      print "El efecto sorpresa que habías producido en el ejército imperial con el robo del caza se ha esfumado y desde el interior de la cabina
	             puedes llegar a ver como prácticamente todos los cañones láser del puerto espacial apuntan hacia ti y disparan.
	             ^Lo último que ves antes de sentir como explota tu nave es el resto de las naves despegan a la vez en un intento desesperado de escapar.";
	      deadflag=6;
      }
      if (caza_countdown == 10) {
	      !playSound(chan1,sndAlarma,-1,VOLUMEN_ALTO);
	      Damusix.AsignarCanal(sndAlarma,0,VOLUMEN_ALTO,-1);
	      Damusix.Tocar(sndAlarma,0);
	      print "^Una alarma comienza a sonar por todo el puerto espacial.";
      }
      if (caza_countdown == 7) print "^Desde la cabina del caza puedes ver el revuelo entre las tropas imperiales y como algunas patrullas se dirigen
                                corriendo hacia los cañones láser de defensa.";
      if (caza_countdown == 5) print "^Los cañones de todo el perímetro del puerto espacial comienzan a apuntar hacia el caza que pilotas.";
      if (caza_countdown == 3) print "^¡Uf! Ese disparo pasó muy cerca de tu posición.";
      if (caza_countdown == 1) print "^En el último segundo, haciendo gala de grandes reflejos, consigues esquivar por bien poco el disparo de uno
                               de los cañones imperiales.";
      caza_countdown--;
      rtrue;
	],
has nosalidas;

Lugar CazaVwingO "Cabina del V-wing (sobrevolando hangar oeste)"
  with
    sgw_img jpgCaza,       ! el grafico de la localidad
    sgw_mus sndEnelcaza,  ! la musica de la localidad
    sgw_vol VOLUMEN_BAJO,
    name 'v-wing' 'caza',
    describe [;
      print "Sobrevuelas el hangar oeste. Puedes ver el resto de naves del hangar (la Thorene, la Haltia y la Dzina). 
            ^El cuadro de mandos de los cazas V-wing es bastante sencillo. A parte de numerosos indicadores, puedes identificar 
            claramente la palanca de mando con la que pilotar la nave. ",(string) DireccionCaza(oPalancaMando.direccion);
      rtrue;
    ],
    e_to CazaVwingP,
    before [;
      go: if (noun ~= e_obj) {
            print "No es momento de dar una vuelta con la nave. Si no terminas pronto lo que debes hacer, el efecto sorpresa se evaporará y
                   seguramente serás abatido por los clones.";
            rtrue;
          };
          print "La nave avanza sobrevolando Cadgel Meadows...^";
    ],
    each_turn [;
      if (caza_countdown < 1) {
	      print "El efecto sorpresa que habías producido en el ejército imperial con el robo del caza se ha esfumado y desde el interior de la cabina
	             puedes llegar a ver como prácticamente todos los cañones láser del puerto espacial apuntan hacia ti y disparan.
	             ^Lo último que ves antes de sentir como explota tu nave es el resto de las naves despegan a la vez en un intento desesperado de escapar.";
	      deadflag=6;
      }
      if (caza_countdown == 10) {
	      !playSound(chan1,sndAlarma,-1,VOLUMEN_ALTO);
	      Damusix.AsignarCanal(sndAlarma,0,VOLUMEN_ALTO,-1);
	      Damusix.Tocar(sndAlarma,0);
	      print "^Una alarma comienza a sonar por todo el puerto espacial.";
      }
      if (caza_countdown == 7) print "^Desde la cabina del caza puedes ver el revuelo entre las tropas imperiales y como algunas patrullas se dirigen
                                corriendo hacia los cañones láser de defensa.";
      if (caza_countdown == 5) print "^Los cañones de todo el perímetro del puerto espacial comienzan a apuntar hacia el caza que pilotas.";
      if (caza_countdown == 3) print "^¡Uf! Ese disparo pasó muy cerca de tu posición.";
      if (caza_countdown == 1) print "^En el último segundo, haciendo gala de grandes reflejos, consigues esquivar por bien poco el disparo de uno
                               de los cañones imperiales.";
      caza_countdown--;
      rtrue;
	],
has nosalidas;

Lugar CazaVwingP "Cabina del V-wing (sobrevolando pista)"
  with
    sgw_img jpgCaza,       ! el grafico de la localidad
    sgw_mus sndEnelcaza,  ! la musica de la localidad
    sgw_vol VOLUMEN_BAJO,
    name 'v-wing' 'caza',
    describe [;
      print "Sobrevuelas la pista de Cadgel Meadows. El cuadro de mandos de los cazas V-wing es bastante sencillo. A parte de numerosos indicadores, 
             puedes identificar claramente la palanca de mando con la que pilotar la nave. ",(string) DireccionCaza(oPalancaMando.direccion);
      rtrue;
    ],
    n_to CazaVwingN,
    s_to CazaVwingS,
    e_to CazaVwingE,
    w_to CazaVwingO,
    before [;
      go: if (noun ~= n_obj && noun ~= s_obj && noun ~= e_obj && noun ~= w_obj) {
            print "No es momento de dar una vuelta con la nave. Si no terminas pronto lo que debes hacer, el efecto sorpresa se evaporará y
                   seguramente serás abatido por los clones.";
            rtrue;
          };
          print "La nave avanza sobrevolando Cadgel Meadows...^";
    ],
    each_turn [;
      if (caza_countdown < 1) {
	      print "El efecto sorpresa que habías producido en el ejército imperial con el robo del caza se ha esfumado y desde el interior de la cabina
	             puedes llegar a ver como prácticamente todos los cañones láser del puerto espacial apuntan hacia ti y disparan.
	             ^Lo último que ves antes de sentir como explota tu nave es el resto de las naves despegan a la vez en un intento desesperado de escapar.";
	      deadflag=6;
      }
      if (caza_countdown == 10) {
	      !playSound(chan1,sndAlarma,-1,VOLUMEN_ALTO);
	      Damusix.AsignarCanal(sndAlarma,0,VOLUMEN_ALTO,-1);
	      Damusix.Tocar(sndAlarma,0);
	      print "^Una alarma comienza a sonar por todo el puerto espacial.";
      }
      if (caza_countdown == 7) print "^Desde la cabina del caza puedes ver el revuelo entre las tropas imperiales y como algunas patrullas se dirigen
                                corriendo hacia los cañones láser de defensa.";
      if (caza_countdown == 5) print "^Los cañones de todo el perímetro del puerto espacial comienzan a apuntar hacia el caza que pilotas.";
      if (caza_countdown == 3) print "^¡Uf! Ese disparo pasó muy cerca de tu posición.";
      if (caza_countdown == 1) print "^En el último segundo, haciendo gala de grandes reflejos, consigues esquivar por bien poco el disparo de uno
                               de los cañones imperiales.";
      caza_countdown--;
      rtrue;
	],
has nosalidas;

!
! FASE 2: ORVAX IV
!
[FaseOrvax4 ;
 move oTrajeTrooper to limbo;
 glk_request_timer_events(0);
 playerTo(AccesoNivInfO4,2);
];

! Objeto para que reaccione a <<Mirar <nombre localidad>>> en Orvax IV
Object oLocGenericoO4 "lugar"
with
    name 'lugar' 'sitio' 'suelo' 'puerto' 'comercio' 'comercios' 'comerciante' 'comerciantes',
    name_f 'mercancia' 'mercancias' 'calle' 'calles',    
    description [w;
        wn = 2;
        w=NextWord();
        if (w=='el' or 'la' or 'los' or 'las') w=NextWord();
        switch (w) {
	        'lugar':<<look>>;
	        'sitio':<<look>>;
	        'suelo':<<look>>;
	        'hangar',
	        'hangares': switch (location) {
		               inUhumeleO4,
	                   PuertoO4: "Los hangares están repletos de naves procedentes de todos los rincones de la galaxia. La Uhumele
	                              está atracada en uno de ellos.";
	                   default: "Desde aquí no puedes ver los hangares.";
                     }
            'puerto': switch (location) {
	                   PuertoO4: "El puerto espacial está repleto de naves que vienen de cualquier parte de la galaxia
                                    para, principalmente, comerciar con esclavos, aunque también las hay que llegan al 
                                    planeta en busca de provisiones o repuestos. La Uhumele está atracada aquí.";
	                   inUhumeleO4:"Afuera, el puerto espacial está repleto de naves que vienen de cualquier parte de la galaxia
                                    para, principalmente, comerciar con esclavos, aunque también las hay que llegan al 
                                    planeta en busca de provisiones o repuestos.";
                       PlazaO4: "El puerto espacial queda al norte de tu posición. Está repleto de naves que vienen de cualquier 
                                 parte de la galaxia para, principalmente, comerciar con esclavos, aunque también las hay que 
                                 llegan al planeta en busca de provisiones o repuestos. La Uhumele está atracada allí.";
	                   default: "Desde aquí no puedes ver el puerto espacial.";
                     }
            'plaza': switch (location) {
	                   PuertoO4: "La plaza es el centro neurálgico de Orvax IV, llena de comercios en los que se puede encontrar
	                             de casi todo. Queda al sur de tu posición.";
	                   PlazaO4: "La plaza principal. Puedes ver criaturas de cualquier rincón de la galaxia comprando en 
	                            todo tipo de comercios las mercancías que necesiten.";
	                   default: "Desde aquí no puedes ver la plaza.";
                     }
            'comercio','comerciante','comerciantes','vendedor','vendedores',         
            'comercios': switch (location) {
	                       PlazaO4: "Puedes ver comercios donde se vende todo tipo de mercancias.";
	                       default: "Desde aquí no puedes ver los comercios de la plaza principal.";
                         }
            'compradores',         
            'comprador': switch (location) {
	                       PlazaO4: "Criaturas de cualquier rincón de la galaxia comprando cualquier tipo de mercancía que necesiten.";
	                       default: "Desde aquí no puedes ver los comercios de la plaza principal.";
                         }
            'calles',
            'calle': switch (location) {
	                   PlazaO4: <<look>>;
	                   CalleO4_1: <<look>>;
	                   CalleO4_2: <<look>>;
	                   default: "Desde aquí no puedes ver ninguna calle.";
                     }
            default : "Desde aquí no puedes ver eso que dices.";
        };
    ],
    found_in [;
      if (planeta == 2) rtrue;
      else rfalse;
    ],
    before [;
        Examine: rfalse;
        default: print "Después de estudiar las posibilidades, llegas a la conclusión de que sería una tonteria ";LanguageVerb(verb_word);print " eso.";
                 rtrue;    
    ],
has scenery concealed;

Lugar PuertoO4 "Puerto Espacial de Orvax IV"
with
  !sgw_img grfSantaLucia,       ! el grafico de la localidad
  description "El puerto espacial de Orvax IV está repleto de naves que vienen de cualquier parte de la galaxia
               para, principalmente, comerciar con esclavos, aunque también las hay que llegan al planeta en busca
               de provisiones o repuestos. La Uhumele, tu nave, está atracada en uno de los hangares del puerto.",
  in_to inUhumeleO4,
  s_to PlazaO4,
;

Object -> oNavesO4 "naves"
with
     name 'naves',
     description "Naves de toda clase y tamaño prácticamente llenan los hangares del puerto espacial.",
     before [;
       Enter: "Seguramente te harían preguntas incómodas antes de subir a cualquiera de ellas, lo que haría que te metieras en líos inútiles.";
       Levitar: "Sólo los jedis más poderosos podrían hacer levitar semenajante peso.";
       Take: "Demasiado peso incluso para ti.";
     ],
has scenery female pluralname;

Object -> oUhumeleO4 "Uhumele"
  with
    name 'uhumele' 'nave',
    description "La Uhumele es la nave de transporte en la que has llegado a Orvax IV. La rampa de acceso está abierta.",
    before [;
      Enter: playerTo(inUhumeleO4,2);
      Attack,
      Disparar: "La Uhumele no debería ser tu objetivo...";
      Levitar: "Demasiado grande para ti. No eres tan poderoso.";
    ],
has scenery female objetivo;

Lugar inUhumeleO4 "Interior de la Uhumele"
with 
  description "Te encuentras en el interior de la Uhumele. Aunque por fuera la nave está poco cuidada, el interior tiene 
              muy buen aspecto, dando sensación de amplitud, calidez y limpieza.",
  out_to PuertoO4,
;

Lugar PlazaO4 "Plaza Principal de Orvax IV"
with
  !sgw_img grfSantaLucia,       ! el grafico de la localidad
  description "La plaza principal es el centro neurálgico de Orvax IV. Observas el típico bullicio de las grandes ciudades. 
              Comerciantes y compradores campan a sus anchas por la plaza, ofreciendo o requiriendo cualquier tipo de bienes.",
  n_to PuertoO4,
  e_to CalleO4_1,
  w_to CalleO4_2,
;

Object oMeettoO4 "Meetto" limbo
  with
    name 'meetto' 'toydariano' 'mercader' 'vendedor' 'comerciante',
    description "Meetto es un mercader toydoriano. Vende piezas de repuesto para todo tipo de naves, que obtiene gracias al desgüace
                 de otras en desuso. Como todos los de su especie, aunque puede andar, prefiere desplazarse volando, utilizando las
                 dos pequeñas alas que le nacen en su espalda.", 
    soborno 0,
    life [tema;
	    Attack: "Mejor no llamar la atención provocando un alboroto.^";
        tell,answer,
        ask: tema=AveriguarTema(TemasOrvax4);
             if (self.soborno==0) {
	           switch(tema) {
                 t_familiabomoO4,
                 t_prisioneroO4: print "^Meetto: ", (s_underline) "~Si quieres mi ayuda tendrás que pagar por ella.~^";
                 t_mesaO4: print "^Meetto: ", (s_underline) "~Mmmm... Esa información te costará dinero.~^";
                 t_resaO4: print "^Meetto: ", (s_underline) "~Mmmm... Esa información te costará dinero.~^";
                 t_guardiasO4: print "^Meetto: ", (s_underline) "~Hay patrullas por toda la ciudad. Parece que los ánimos están caldeados.~^";
                 t_simismoO4: print "^Meetto: ", (s_underline) "~En estos tiempos oscuros el negocio no va bien, y tengo una familia
                        a la que alimentar.~^";
                 t_ayudaO4: print "^Meetto: ", (s_underline) "~Si quieres mi ayuda tendrás que pagar por ella.~^";
                 t_meettoO4: print "^Meetto: ", (s_underline) "~En estos tiempos oscuros el negocio no va bien, y tengo una familia
                        a la que alimentar.~^";
                 t_esclavosO4: print "^Meetto: ", (s_underline) "~Mmmm... Esa información te costará dinero.~^";
                 t_dineroO4: print "^Meetto: ",(s_underline) "~Cuanto más traigas mejor... Tengo una familia que alimentar y el negocio
                        no va muy bien en estos tiempos oscuros.~"; 
                        move oJaxfSevalO4 to CantinaO4;
                 t_repuestosO4: print "^Meetto: ",(s_underline) "~Tengo de todo lo que necesites... soy el único que vende repuestos
                        en este planeta.~"; 
                 t_sottaO4: print "^Meetto: ",(s_underline) "~Mmmm... Esa información te costará dinero.~"; 
                 t_uhumeleO4: print "^Meetto: ",(s_underline) "~Sólo acepto créditos de la república contantes y sonantes.~"; 
                 default: switch (random(2)) {
	                        1: print "^Meetto: ", (s_underline) "~Lo siento. Sólo vendo repuestos para naves. Tengo cualquier pieza que
                                 necesites.~^";
	                        2: print "^Meetto: ", (s_underline) "~Mmmm... Me podría meter en problemas si te doy esa información...
	                             Tal vez si tuviera un incentivo... El negocio no va muy bien en estos tiempos oscuros.~^";
                          }                              
               }
             } else {
	           switch(tema) {
                 t_familiabomoO4, t_resaO4,t_mesaO4,
                 t_prisioneroO4: print "^Meetto: ", (s_underline) "~He oido que recientemente se ha vendido una niña nosauriana. Sotta
                        el Hutt es quien controla todo el mercado de esclavos en este planeta.~^";
                 t_guardiasO4: print "^Meetto: ", (s_underline) "~Hay patrullas por toda la ciudad. Parece que los ánimos están caldeados.~^";
                 t_simismoO4: print "^Meetto: ", (s_underline) "~En estos tiempos oscuros el negocio no va bien, y tengo una familia
                        a la que alimentar.~^";
                 t_ayudaO4: print "^Meetto: ", (s_underline) "~¿En qué puedo ayudarte?~^";
                 t_meettoO4: print "^Meetto: ", (s_underline) "~En estos tiempos oscuros el negocio no va bien, y tengo una familia
                        a la que alimentar.~^";
                 t_esclavosO4: print "^Meetto: ", (s_underline) "~En este planeta, quien controla el mercado de esclavos es Sotta el Hutt.
                        No se hace ninguna transacción sin su consentimiento.~^";
                 t_dineroO4: print "^Meetto: ",(s_underline) "~Tengo suficiente.~"; 
                 t_repuestosO4: print "^Meetto: ",(s_underline) "~No hace falta que disimules. Tú no has venido a por repuestos.~"; 
                 t_sottaO4: print "^Meetto: ",(s_underline) "~Sotta el Hutt es un tipo peligroso. Controla todo el mercado de esclavos en
                        este planeta. No se hace ninguna transacción sin su consentimiento. Lo puedes encontrar en su fortaleza, en la parte
                        Este de la ciudad.~"; 
                 t_uhumeleO4: print "^Meetto: ",(s_underline) "~No hace falta que vayas con rodeos. Tú no has venido a por repuestos para tu nave.~";
                 default: switch (random(2)) {
	                        1: print "^Meetto: ", (s_underline) "~Lo siento, no te puedo contestar a eso.~^"; 
	                        2: print "^Meetto: ", (s_underline) "~Mmmm... pensaba que estabas interesado en obtener información sobre los 
	                             nosaurianos.~^"; 
                          }
               }
             };
             rtrue;
    ],
    orders [;
      Mild, Strong: "Enfadando a Meetto no conseguirás nada.^";
      NotUnderstood, Tell: <<Ask self>>;
    ],
    before [;
      Sanar: print "Meetto: ",(s_underline) "~¿Acaso te crees un jedi intentando esos truquitos conmigo?~^"; rtrue;
	  Levitar: "No deberías ir alardeando de tus poderes de jedi... son tiempos oscuros para los de tu Orden.^";
	  Push, Aturdir: "Enfadando a Meetto no conseguirás nada.^";
      Enganyar: print "Meetto: ",(s_underline) "~¿Acaso te crees un jedi intentando esos truquitos conmigo?~^"; rtrue;
      Sentir, 
      Concentrar: "La Fuerza habita en el interior de todos los seres vivos.^";
    ],
has animate proper objetivo transparent;

Object decorado_meettoO4 oMeettoO4
class decorado
with  describe
       'oreja' "Grandes y puntiagudas." G_FEMENINO
       'orejas' "Grandes y puntiagudas." G_FEMENINO+G_PLURAL
       'alas' "Como todos los de su raza, tiene dos alas que le permiten desplazarse por el aire." G_FEMENINO+G_PLURAL
       'ala' "Como todos los de su raza, tiene dos alas que le permiten desplazarse por el aire." G_FEMENINO
       'piel' "De color azulado." G_FEMENINO,
  before[;
    examine: rfalse;
    default: print "No conviene hacer eso."; rtrue;
  ],
;

Lugar CalleO4_1 "Calle"
with
  !sgw_img grfSantaLucia,       ! el grafico de la localidad
  description "Una calle bastante transitada, ya que por el lado oeste desemboca a la plaza principal. Por el lado este se 
              adentra en los suburbios de la ciudad. Una cantina ocupa un lugar preferencial en esta calle.",
  w_to PlazaO4,
  in_to CantinaO4,
  before [;
    go: if (noun==e_obj) "Será mejor que te quedes por esta zona. Adentrarse en los suburbios no parece buena idea.";
  ],
;

Object -> oCantinaO4 "Cantina"
  with
    name 'cantina' 'bar',
    description "La cantina ocupa un lugar privilegiado en la calle. Criaturas de todos los confines de la galaxia entran
                y salen constantemente.",
    before [;
      Enter: playerTo(CantinaO4,2);
    ],
has scenery female objetivo;

Lugar CalleO4_2 "Calle"
with
  !sgw_img grfSantaLucia,       ! el grafico de la localidad
  description "Una calle poco transitada, ya que, aunque por el lado este desemboca a la plaza principal, por el lado oeste 
              baja al nivel inferior de la ciudad. Un lugar nada recomendado...",
  describe [;
    self.Lugar::describe();
    if (self hasnt visited) {
	    print "^Al acercarte al lugar, puedes ver como dos guardias están golpeando a Mezgraf, que apenas puede defenderse de los ataques. Los
	          guardias son T'surr, como todos los de Orvax IV, unas bestias descomunales de unos 2.5 metros de altura y piel azul. Sus enormes 
	          cabezas lucen numerosos cuernos, orejas grandes, una boca llena de dientes afilados y cuatro brillantes ojos rojos.^";
    };
    rtrue;
  ],
  e_to PlazaO4,
  d_to AccesoNivInfO4,
  before [;
    go: if (noun==d_obj && oGuardiasO4 in self) "Los guardias bloquean el acceso al nivel inferior.";
  ],
;

Object oGuardiasO4 "guardias de la ciudad" CalleO4_2
  with
    name 'guardia' 'guardias',
    description [;
      switch(self.multiple){
	      1: "Un guardia está golpeando sin cesar a Mezgraf, que yace en el suelo sin poder apenas defenderse. Los
	          guardias son T'surr, como todos los de Orvax IV, unas bestias descomunales de unos 2.5 metros de altura y piel azul. Sus enormes 
	          cabezas lucen numerosos cuernos, orejas grandes, una boca llena de dientes afilados y cuatro brillantes ojos rojos.";
	      2: "Dos guardias están golpeando sin cesar a Mezgraf, que yace en el suelo sin poder apenas defenderse. Los
	          guardias son T'surr, como todos los de Orvax IV, unas bestias descomunales de unos 2.5 metros de altura y piel azul. Sus enormes 
	          cabezas lucen numerosos cuernos, orejas grandes, una boca llena de dientes afilados y cuatro brillantes ojos rojos.";
	      3: "Tres guardias están golpeando sin cesar a Mezgraf, que yace en el suelo sin poder apenas defenderse. Los
	          guardias son T'surr, como todos los de Orvax IV, unas bestias descomunales de unos 2.5 metros de altura y piel azul. Sus enormes 
	          cabezas lucen numerosos cuernos, orejas grandes, una boca llena de dientes afilados y cuatro brillantes ojos rojos.";
      }
      rtrue;
    ],
    bonif_defensiva 10,
    bonif_ofensiva 10,
    vida 25,
    topvida 25,
    dado_golpe 2 6 0, !1d6+0
    multiple 2,
    !name_boss "el capitán",
    name_tropa "un guardia",
    printname [nom;
      nom="";
      if (self.multiple>1) nom= self.name_tropa;
      else {
	      if (self provides name_boss ) nom=self.name_boss;
	      else nom=self.name_tropa;
      } 
      return nom;
    ],
    printcasename [nom;
      nom="";
      if (self.multiple>1) nom= Cap(self.name_tropa);
      else {
	      if (self provides name_boss) nom=Cap(self.name_boss);
          else nom=Cap(self.name_tropa);
      }
      return nom;
    ],
    life [;
	    Attack: !"Son demasiado numerosos para un ataque directo contra ellos.";
	            give self estatico;
	            move player to parent(self);
	            if (second == nothing) 
	              multi_combate(player,self,oSableLaser);
	            else
	              multi_combate(player,self,second);
	            viewImageSlide(pngSablesLuz);
	            if (self has muerto) {
		            move self to limbo;
		            give player ~descubierto;
	            }
                rtrue;
	    Answer,ask,tell: print "Sin mediar palabra, los guardias se lanzan a por ti.";
	            give self estatico;
	            move player to parent(self);
	            multi_combate(player,self,oSableLaser);
	            viewImageSlide(pngSablesLuz);
	            if (self has muerto) {
		            move self to limbo;
		            give player ~descubierto;
	            }
                rtrue;
    ],
    orders [;
      Mild, Strong: <<Ask self>>;
      NotUnderstood, Tell: <<Ask self>>;
    ],
    before [;
        Sentir, Concentrar: "La Fuerta está presente en el interior de todos los seres vivos.^";
        Levitar: "Son demasiado pesados para levitarlos.^";
	    Push, Aturdir: !"Hay demasiados soldados para usar la Fuerza contra ellos.^";
	                   give self estatico;
	                   move player to parent(self);
                       multi_combate(player,self,oFuerza);
                       viewImageSlide(pngSablesLuz);
	                   if (self has muerto) {
		                 move self to limbo;
		                 give player ~descubierto;
	                   }
	                   rtrue;
        Enganyar: print "Guardia: ",(s_underline) "~¿Acaso te crees un jedi intentando esos truquitos?~^"; rtrue;
    ],
has pluralname animate;

Object oMezgrafO4 "Mezgraf" CalleO4_2
  with
    name 'mezgraf' 'humanoide' 'togoriano' 'leon',
    description [;
      if (oGuardiasO4 in location) "Para poder acercarte a Mezgraf primero deberás deshacerte de los guardias que le golpean.";
      if (self.vida==0) "Mezgraf yace inconsciente en el suelo, debido a los golpes recibidos.";
      "Mezgraf es un togoriano de pelo blanco, un humanoide con aspecto de león. Lleva una marca de esclavo en su brazo derecho.";
    ], 
    bonif_defensiva 15,
    bonif_ofensiva 15,
    vida 0,
    dado_golpe 1 6 0, !1d6+0
    life [tema;
	  Attack: "Mezgraf es de los tuyos y no se merece esto. ¿Por qué te asaltarán estas dudas?^";
      tell,answer,
      ask: tema=AveriguarTema(TemasOrvax4);
           if (oGuardiasO4 in location) "Para poder hablarle a Mezgraf primero deberás deshacerte de los guardias que le golpean.^";
           if (self.vida==0) {
	         "Mezgraf yace inconsciente en el suelo debido a los golpes recibidos. Dificilmente responderá a tus preguntas.^";
           };
	       switch(tema) {
             t_familiabomoO4, t_mesaO4, t_resaO4,
             t_prisioneroO4: print "^Mezgraf: ", (s_underline) "~Tienen prisioneros a los nosaurianos en el nivel inferior de la ciudad, 
               esperando a ser vendidos.~";
             t_palizaO4,
             t_guardiasO4: print "^Mezgraf: ", (s_underline) "~Esos guardias me pillaron por sorpresa cuando investigaba dónde tienen a 
               los nosaurianos.~";
             t_simismoO4: print "^Mezgraf: ", (s_underline) "~Sobreviviré gracias a tí. Esos guardias me pillaron por sopresa cuando 
               investigaba dónde tienen a los nosaurianos.~";
             t_ayudaO4: print "^Mezgraf: ", (s_underline) "~Tienen prisioneros a los nosaurianos en el nivel inferior de la ciudad, 
               esperando a ser vendidos.~";
             t_misionO4: print "^Mezgraf: ", (s_underline) "~Averigüé dónde están los nosaurianos.~";
             default: print "^Mezgraf: ", (s_underline) "~Lo siento, no te puedo contestar a eso.~"; 
           };
           rtrue;
    ],
    orders [;
      Mild, Strong: "Mezgraf es de los tuyos y no se merece esto.^";
      NotUnderstood, Tell: <<Ask self>>;
    ],
    before [;
      Sanar: if (oGuardiasO4 in location) "Para poder acercarte a Mezgraf primero deberás deshacerte de los guardias que le golpean.";
             print "Te concentras y notas como la Fuerza pasa a través de tu cuerpo hacia el de Mezgraf, recuperándolo completamente.^";
             self.vida = 50;
             rtrue;
	  Levitar: "No deberías ir alardeando de tus poderes de jedi... son tiempos oscuros para los de tu Orden.^";
	  Push, Aturdir: "Mezgraf es de los tuyos y no estaría bien enfadarlo.^";
      Enganyar: "La persuasión mediante la Fuerza sólo funciona con seres de mente débil.^";
      Sentir, 
      Concentrar: "El sufrimiento de su vida de esclavo está grabado en su interior.^";
    ],
has animate proper objetivo transparent;

Object decorado_mezgrafO4 oMezgraf
class decorado
with  describe
       'pelo' "Una hermosa cabellera blanca." 0
       'brazo' "En el derecho destaca una marca típica de esclavo." 0
       'brazos' "En el derecho tiene una marca de esclavo." G_PLURAL
       'tatuaje' "Es una señal con la que suelen marcar a los esclavos." 0
       'marca' "Es una señal con la que suelen marcar a los esclavos." G_FEMENINO,
  before[;
    examine: rfalse;
    default: "No conviene hacer eso.";
  ],
;

Lugar AccesoNivInfO4 "Acceso al nivel inferior"
with 
  description "Una rampa comunica el nivel superior con el inferior de Orvax IV.",
  u_to CalleO4_2,
  d_to NivelInfO4_1,
;

Object decorado_rampa AccesoNivInfO4
class decorado
with  describe
       'rampa' "Una rampa comunica el nivel superior con el inferior de Orvax IV." G_FEMENINO
       'acceso' "Una rampa comunica el nivel superior con el inferior de Orvax IV." 0, 
  before[;
    examine: rfalse;
    default: "No conviene hacer eso.";
  ],
;


Lugar NivelInfO4_1 "Nivel inferior de Orvax IV"
with 
  description "El nivel inferior es la zona más antigua de Orvax IV y, en consecuencia, donde los viejos vicios florecen con más vigor.
            Las clases más bajas de la ciudad se hacinan en estas calles y todo aquí huele a miseria.",
  u_to AccesoNivInfO4,
  s_to NivelInfO4_2,
;

Object decorado_nivelinferior NivelInfO4_1
class decorado
with  describe
       'estructura' "Las viviendas del nivel inferior son destartaladas y están construidas con todo tipo de deshechos." G_FEMENINO
       'estructuras' "Las viviendas del nivel inferior son destartaladas y están construidas con todo tipo de deshechos." G_FEMENINO+G_PLURAL
       'seres' "Los habitantes de esta parte de la ciudad no te transmiten buenas sensaciones. Mejor pasar de largo para no meterte en lios." G_PLURAL
       'calle' "Las calles del nivel inferior de Orvax IV son estrechas y agobiantes. Todas te parecen iguales." G_FEMENINO
       'calles' "Las calles del nivel inferior de Orvax IV son estrechas y agobiantes. Todas te parecen iguales." G_FEMENINO+G_PLURAL, 
  before[;
    examine: rfalse;
    default: "No conviene hacer eso.";
  ],
;

Lugar NivelInfO4_2 "Nivel inferior de Orvax IV"
with 
  description "Las calles se vuelven cada vez más estrechas y agobiantes. Las destartaladas estructuras y los seres de aspecto igualmente 
           indeseable no te ayudan a minimizar esa sensación.",
  describe [;
    self.Lugar::describe();
!     if (random(2)==1) {
! 	    print "^Unos pequeños animales carroñeros, parecidos a ratas pero más grandes, cruzan corriendo desde el callejón de la parte sur,
! 	          desapareciendo rápidamente por la parte norte.^";
!     };
    RandomEffectsLabyrinth(60);
    rtrue;
  ],
  n_to NivelInfO4_1,
  s_to NivelInfO4_3,
  e_to NivelInfO4_2,
  w_to NivelInfO4_2,  
;

Object decorado_nivelinferior2 NivelInfO4_2
class decorado
with  describe
       'estructura' "Las viviendas del nivel inferior son destartaladas y están construidas con todo tipo de deshechos." G_FEMENINO
       'estructuras' "Las viviendas del nivel inferior son destartaladas y están construidas con todo tipo de deshechos." G_FEMENINO+G_PLURAL
       'seres' "Los habitantes de esta parte de la ciudad no te transmiten buenas sensaciones. Mejor pasar de largo para no meterte en lios." G_PLURAL
       'calle' "Las calles del nivel inferior de Orvax IV son estrechas y agobiantes. Todas te parecen iguales." G_FEMENINO
       'calles' "Las calles del nivel inferior de Orvax IV son estrechas y agobiantes. Todas te parecen iguales." G_FEMENINO+G_PLURAL, 
  before[;
    examine: rfalse;
    default: "No conviene hacer eso.";
  ],
;

Lugar NivelInfO4_3 "Nivel inferior de Orvax IV"
with 
  description "Las calles se vuelven cada vez más estrechas y agobiantes. Las destartaladas estructuras y los seres de aspecto igualmente 
           indeseable no te ayudan a minimizar esa sensación.",
  describe [;
    self.Lugar::describe();
    if (random(2)==1) {
	    print "^Unos pequeños animales carroñeros, parecidos a ratas pero más grandes, cruzan corriendo desde el callejón de la parte oeste,
	          desapareciendo rápidamente por la parte norte.^";
    };
    rtrue;
  ],
  n_to NivelInfO4_2, 
  s_to NivelInfO4_3,
  e_to NivelInfO4_2,
  w_to NivelInfO4,  
;

Object decorado_nivelinferior3 NivelInfO4_3
class decorado
with  describe
       'estructura' "Las viviendas del nivel inferior son destartaladas y están construidas con todo tipo de deshechos." G_FEMENINO
       'estructuras' "Las viviendas del nivel inferior son destartaladas y están construidas con todo tipo de deshechos." G_FEMENINO+G_PLURAL
       'seres' "Los habitantes de esta parte de la ciudad no te transmiten buenas sensaciones. Mejor pasar de largo para no meterte en lios." G_PLURAL
       'calle' "Las calles del nivel inferior de Orvax IV son estrechas y agobiantes. Todas te parecen iguales." G_FEMENINO
       'calles' "Las calles del nivel inferior de Orvax IV son estrechas y agobiantes. Todas te parecen iguales." G_FEMENINO+G_PLURAL, 
  before[;
    examine: rfalse;
    default: "No conviene hacer eso.";
  ],
;

Lugar NivelInfO4 "Nivel inferior de Orvax IV"
with 
  !name 'cantina',
  describe [;
    if (oCeldaNosaurianos hasnt open) {
      print "Los estrechos callejones se ensanchan para desembocar en los accesos a los calabozos. ";
      if (oGuardiasNivInfO4 in self) print "Unos guardias bloquean el paso a la zona donde podrían estar retenidos los esclavos.";
      print "^";
      <Salidas>;
      rtrue;
    } else {
	  print "Los estrechos callejones se ensanchan para desembocar en los accesos a los calabozos.^";
	  <Salidas>;
	  if (oGuardiasNivInfO4_2 hasnt muerto) {
	    print "^Al salir al exterior te das de bruces con una escena dantesca. Puedes ver como unos guardias de la ciudad están 
	           disparando a los nosaurianos al ver que éstos estaban escapando y los cadáveres se amontonan en el suelo.^";
      }
	  rtrue;
    }
  ],
  e_to NivelInfO4_3,
  in_to CeldasO4,
  before [;
    go: if (noun==in_obj && oGuardiasNivInfO4 in self) "Los guardias bloquean el paso a la zona donde podrían estar retenidos los esclavos.^";
        if (noun==e_obj && oGuardiasNivInfO4_2 in self) "Los guardias bloquean el acceso a los callejones.^";
  ],
;

GuardiaOrvax4 oGuardiasNivInfO4 NivelInfO4
with
  multiple 3,
  description [;
    switch(self.multiple){
      1: "Un guardia de la ciudad bloquea el acceso a la zona de las celdas. Los
	          guardias son T'surr, como todos los de Orvax IV, unas bestias descomunales de unos 2.5 metros de altura y piel azul. Sus enormes 
	          cabezas lucen numerosos cuernos, orejas grandes, una boca llena de dientes afilados y cuatro brillantes ojos rojos.";
      2: "Dos guardias de la ciudad bloquean el acceso a la zona de las celdas. Los
	          guardias son T'surr, como todos los de Orvax IV, unas bestias descomunales de unos 2.5 metros de altura y piel azul. Sus enormes 
	          cabezas lucen numerosos cuernos, orejas grandes, una boca llena de dientes afilados y cuatro brillantes ojos rojos.";
      3: "Tres guardias de la ciudad bloquean el acceso a la zona de las celdas. Los
	          guardias son T'surr, como todos los de Orvax IV, unas bestias descomunales de unos 2.5 metros de altura y piel azul. Sus enormes 
	          cabezas lucen numerosos cuernos, orejas grandes, una boca llena de dientes afilados y cuatro brillantes ojos rojos.";
      default: "Algunos guardias de la ciudad bloquean el acceso a la zona de las celdas. Los
	          guardias son T'surr, como todos los de Orvax IV, unas bestias descomunales de unos 2.5 metros de altura y piel azul. Sus enormes 
	          cabezas lucen numerosos cuernos, orejas grandes, una boca llena de dientes afilados y cuatro brillantes ojos rojos.";
    }
  ], 
;

GuardiaOrvax4 oGuardiasNivInfO4_2 limbo
with
  multiple 4,
  description [;
    switch(self.multiple){
      1: "Un guardia de la ciudad bloquea el acceso al nivel superior de la ciudad. Los
	          guardias son T'surr, como todos los de Orvax IV, unas bestias descomunales de unos 2.5 metros de altura y piel azul. Sus enormes 
	          cabezas lucen numerosos cuernos, orejas grandes, una boca llena de dientes afilados y cuatro brillantes ojos rojos.";
      2: "Dos guardias de la ciudad bloquean el acceso al nivel superior de la ciudad. Los
	          guardias son T'surr, como todos los de Orvax IV, unas bestias descomunales de unos 2.5 metros de altura y piel azul. Sus enormes 
	          cabezas lucen numerosos cuernos, orejas grandes, una boca llena de dientes afilados y cuatro brillantes ojos rojos.";
      3: "Tres guardias de la ciudad bloquean el acceso al nivel superior de la ciudad. Los
	          guardias son T'surr, como todos los de Orvax IV, unas bestias descomunales de unos 2.5 metros de altura y piel azul. Sus enormes 
	          cabezas lucen numerosos cuernos, orejas grandes, una boca llena de dientes afilados y cuatro brillantes ojos rojos.";
      4: "Cuatro guardias de la ciudad bloquean el acceso al nivel superior de la ciudad. Los
	          guardias son T'surr, como todos los de Orvax IV, unas bestias descomunales de unos 2.5 metros de altura y piel azul. Sus enormes 
	          cabezas lucen numerosos cuernos, orejas grandes, una boca llena de dientes afilados y cuatro brillantes ojos rojos.";
      default: "Algunos guardias de la ciudad bloquean el acceso al nivel superior de la ciudad. Los
	          guardias son T'surr, como todos los de Orvax IV, unas bestias descomunales de unos 2.5 metros de altura y piel azul. Sus enormes 
	          cabezas lucen numerosos cuernos, orejas grandes, una boca llena de dientes afilados y cuatro brillantes ojos rojos.";
    }
  ], 
;

Object decorado_nivelinferior4 NivelInfO4
class decorado
with  describe
       'calabozo' "Unos guardias bloquean el único paso a la zona donde podrían estar retenidos los esclavos." 0
       'calabozos' "Unos guardias bloquean el único paso a la zona donde podrían estar retenidos los esclavos." G_PLURAL
       'acceso' "Unos guardias bloquean el único paso a la zona donde podrían estar retenidos los esclavos." 0
       'accesos' "Unos guardias bloquean el único paso a la zona donde podrían estar retenidos los esclavos." G_PLURAL
       'estructura' "Las viviendas del nivel inferior son destartaladas y están construidas con todo tipo de deshechos." G_FEMENINO
       'estructuras' "Las viviendas del nivel inferior son destartaladas y están construidas con todo tipo de deshechos." G_FEMENINO+G_PLURAL
       'seres' "Los habitantes de esta parte de la ciudad no te transmiten buenas sensaciones. Mejor pasar de largo para no meterte en lios." G_PLURAL
       'calle' "Las calles del nivel inferior de Orvax IV son estrechas y agobiantes. Todas te parecen iguales." G_FEMENINO
       'calles' "Las calles del nivel inferior de Orvax IV son estrechas y agobiantes. Todas te parecen iguales." G_FEMENINO+G_PLURAL, 
  before[;
    examine: rfalse;
    default: "No conviene hacer eso.";
  ],
;  

Object decorado_nivinfO4 limbo
class decorado
with  describe
       'nosaurianos' "Son los cuerpos sin vida de las mujeres y niños nosaurianos que acabas de liberar. 
                      Puedes distinguir el cuerpo de Mixa entre los cadáveres." G_PLURAL
       'prisioneros' "Son los cuerpos sin vida de las mujeres y niños nosaurianos que acabas de liberar. 
                      Puedes distinguir el cuerpo de Mixa. entre los cadáveres" G_PLURAL
       'nosaurianas' "Son los cuerpos sin vida de las mujeres y niños nosaurianos que acabas de liberar. 
                      Puedes distinguir el cuerpo de Mixa entre los cadáveres." G_FEMENINO+G_PLURAL
       'prisioneras' "Son los cuerpos sin vida de las mujeres y niños nosaurianos que acabas de liberar. 
                      Puedes distinguir el cuerpo de Mixa entre los cadáveres." G_FEMENINO+G_PLURAL
       'cadaveres' "Son los cuerpos sin vida de las mujeres y niños nosaurianos que acabas de liberar. 
                    Puedes distinguir el cuerpo de Mixa entre los cadáveres." G_PLURAL,
  before[;
    examine: rfalse;
    default: "Están todos muertos.";
  ],
;

Object oMixaAgonizanteO4 "prisionera nosauriana" limbo
with
  name 'prisionera' 'nosauriana' 'hembra' 'mixa',
  description [;
    if (self hasnt muerto) "Entre los cuerpos inertes de los nosaurianos reconoces a Mixa, la esposa de uno de tus capitanes en 
           la batalla del paso de Half-Axe. Parece que todavía está viva, aunque sus heridas son extremadamente graves.";
    "El cuerpo de Mixa yace inerte entre otros muchos cuerpos de nosaurianos.";
  ],
  hablado 0,
  life [tema;
	Attack: "Vuelven a invadirte los impulsos de atacar a seres inocentes, aunque, una vez más, tu fuerza de voluntad puede con ellos.
	         No sabes cuánto tiempo podrás seguir así...^";
    tell,answer,
    ask: if (oGuardiasNivInfO4_2 hasnt muerto) "Los guardias se interponen entre Mixa y tú.^";
           tema=AveriguarTema(TemasOrvax4);
	       switch(tema) {
             t_familiabomoO4,
             t_prisioneroO4: print "^Mixa (agonizando): ", (s_underline) "~¡Esos malditos guardias se llevaron a Resa para venderla y mataron a Mesa 
               cuando intentaba evitar que se la llevaran!~^"; 
               self.hablado=1;
             t_mesaO4: print "^Mixa (agonizando): ", (s_underline) "~Mesa está muerta... Vinieron a llevarse a Resa y se opuso a que se llevaran
               a su hija... ¡los guardias la mataron aquí mismo!~^"; 
               self.hablado=1;
             t_resaO4: print "^Mixa (agonizando): ", (s_underline) "~Vinieron y se llevaron a Resa. Mesa hizo todo lo posible para que no se 
               llevaran a su hija... ¡y los guardias la mataron!~^"; 
               self.hablado=1;
             t_palizaO4,
             t_guardiasO4: print "^Mixa (agonizando): ", (s_underline) "~¡Esos malditos guardias mataron a Mesa y se llevaron a Resa!~^"; 
               self.hablado=1;
             t_simismoO4: print "^Mixa (agonizando): ", (s_underline) "~Ya no puedes ayudarme... busca a Resa y sálvala.~^";
             t_ayudaO4: print "^Mixa (agonizando): ", (s_underline) "~Ya no puedes ayudarme... busca a Resa y sálvala.~^";
             default: print "^Mixa tose, expulsando sangre por la boca, mientras dice algo ininteligible.^"; 
           };
           rtrue;
  ],
  orders [;
    Mild, Strong: "De nuevo esos impulsos por atacar a seres inferiores a ti. Un verdadero Jedi no debería tener esos pensamientos.^";
    NotUnderstood, Tell: <<Ask self>>;
  ],
  before [;
    examine: rfalse; 
    sanar: if (oGuardiasNivInfO4_2 hasnt muerto) "Los guardias se interponen entre Mixa y tú.";
           if (self has muerto) "Mixa está muerta y no puedes resucitarla.";
           if (self.hablado==1) {
              give self muerto;
              "Te preparas para curar a Mixa, pero sus heridas son extremadamente graves y 
               muere en tus brazos antes de que te dé tiempo a hacer nada.";
           }
           "Te concentras para curar a Mixa, pero sus heridas son demasiado graves para sanarlas. 
            Tan sólo consigues aliviar levemente su sufrimiento. Esperas que aguante lo suficiente
            para preguntarle por la esposa y la hija de Bomo.";
    default: if (oGuardiasNivInfO4_2 hasnt muerto) "Los guardias se interponen entre Mixa y tú.";
             if (self has muerto) "Mixa yace inerte en el suelo junto al resto de cadáveres.";
  ],
has animate female concealed;

Lugar CeldasO4 "Celdas (Nivel inferior de Orvax IV)"
with 
  !name 'cantina',
  description "Las celdas son huecos rectangulares excavados en el suelo de la estancia, cerrados cada uno por una pesada reja de acero.",
  out_to NivelInfO4,
;

Object oCeldas "celdas" CeldasO4
with
  name 'celdas' 'huecos',
  description [;
       give oNosaurianosCeldaO4 ~scenery;
       "Las celdas son huecos rectangulares excavados en el suelo de la estancia, cerrados cada uno por una pesada reja de acero.
        Buscas un poco y localizas a los nosaurianos. Todos en la misma celda.";
  ],
  before [;
    open,unlock: "Hay muchas celdas, todas ellas cerradas.";
  ],
has scenery female locked;

Object oCeldaNosaurianos "celda de los nosaurianos" CeldasO4
with
  !name 'celda' 'hueco',
  name 'hueco',
  name_f 'celda' 'reja',
  adjectives 'acero' 'nosaurianos',
!    parse_name [n w w2 w3 w4;
! 	   n=0;
! 	   w=nextWord();
! 	   while (w=='la' or 'las' or 'el' or 'los') w=nextWord();
! ! 	   if (w=='celda' or 'hueco' or 'reja') n++;
! ! 	   if (n>0) {
! ! 		   w2=nextWord();
! ! 		   w3=nextWord();
! ! 		   w4=nextWord();
! ! 		   if (w2=='de') {
! ! 		     if (w3=='los' && (w4=='nosaurianos' or 'esclavos')) n=n+3;
! ! 		     if (w3=='nosaurianos' or 'esclavos') n=n+2;
! ! 	       }
! ! 	       if (w2=='nosaurianos' or 'esclavos') n=n+1;
! ! 	   }
!         while ((w=='celda' or 'hueco' or 'reja' or 'nosaurianos' or 'esclavos' or 'de' or 'los')) {
! 	        print "::",(address)w,"(",wn,")::";
! 	      if (w=='celda' or 'hueco' or 'reja') n++;
! 	      if (w=='nosaurianos' or 'esclavos') n++;
! 	      !if (w=='de' or 'los') n++;
! 	      w=nextWord();
! 	      while (w=='de' or 'los') w=nextWord();
! 	      print "--",(address)w,"(",wn,")--";
!        }
!        print "**",n,"**";
!        return n;
!    ],
  description [;
    if (self hasnt open) "Los nosaurianos capturados están todos en la misma celda, a la espera de ser vendidos como esclavos. Todos son mujeres y niños.";
    "La celda de los nosaurianos está ahora abierta.";
  ],
  before [;
    open: if (self has open) "La celda de los nosaurianos ya está abierta.";
          "La celda está cerrada con llave.";
    unlock: if (self has open) "La celda de los nosaurianos ya está abierta.";
            if (second==oSableLaser) {
	          give self ~locked;
	          give self open;
	          move oNosaurianosCeldaO4 to limbo;
	          move oNosaurianaCeldaO4 to limbo;
	          move decorado_celdasO4 to self;
	          move oGuardiasNivInfO4_2 to NivelInfO4;
	          move decorado_nivinfO4 to NivelInfO4;
	          move oMixaAgonizanteO4 to NivelInfO4;
	          "Con el sable láser cortas fácilmente la reja de acero que retiene a los nosaurianos.^
	          Los nosaurianos salen corriendo hacia el exterior, alejándose de las celdas y en busca de su libertad.";
            }
            if (second==oFuerza) {
	          give self ~locked;
	          give self open;
	          move oNosaurianosCeldaO4 to limbo;
	          move oNosaurianaCeldaO4 to limbo;
	          move decorado_celdasO4 to self;
	          move oGuardiasNivInfO4_2 to NivelInfO4;
	          move decorado_nivinfO4 to NivelInfO4;
	          move oMixaAgonizanteO4 to NivelInfO4;
	          "Con un movimiento de tu mano y una gran concentración, consigues arrancar la reja y apartarla.^
	          Los nosaurianos salen corriendo hacia el exterior, huyendo de las celdas y buscando su libertad.";
            }
            "No puedes abrir la celda de los nosaurianos.";
    levitar: <<unlock self oFuerza>>;
  ],
has scenery female locked transparent;

Object oNosaurianosCeldaO4 "prisioneros nosaurianos" oCeldaNosaurianos
with
  name 'prisioneros' 'nosaurianos',
  description [;
       give oNosaurianaCeldaO4 ~concealed;
       "Los nosaurianos están todos en la misma celda, a la espera de ser vendidos como esclavos. Todos son mujeres y niños.
        Nada más reconocerte, una hembra nosauriana comienza a llamarte para que les saques de allí.";
  ],
  life [;
	Attack: "Vuelven a invadirte los impulsos de atacar a seres inocentes, aunque, una vez más, tu fuerza de voluntad puede con ellos.
	         No sabes cuánto tiempo podrás seguir así...^";
    tell,answer,
    ask: "Hay muchos. ¿Con quién quieres hablar?";
  ],
  orders [;
    Mild, Strong: "De nuevo esos impulsos por atacar a seres inferiores a ti. Un verdadero Jedi no tendría esos pensamientos.^";
    NotUnderstood, Tell: <<Ask self>>;
  ],
has animate pluralname;

Object oNosaurianaCeldaO4 "prisionera nosauriana" oCeldaNosaurianos
with
  name 'prisionera' 'nosauriana' 'hembra' 'mixa',
  description "Una hembra nosauriana llama tu atención cuando comienza a llamarte para que les saques de allí. La reconoces como Mixa, 
    la esposa de uno de tus capitanes en la batalla del paso de Half-Axe.",
  life [tema;
	Attack: "Vuelven a invadirte los impulsos de atacar a seres inocentes, aunque, una vez más, tu fuerza de voluntad puede con ellos.
	         No sabes cuánto tiempo podrás seguir así...^";
    tell,answer,
    ask: tema=AveriguarTema(TemasOrvax4);
	       switch(tema) {
             t_familiabomoO4,
             t_prisioneroO4: print "^Mixa: ", (s_underline) "~¡Esos malditos guardias se llevaron a Resa para venderla y mataron a Mesa 
               cuando intentaba evitar que se la llevaran!~^";
             t_mesaO4: print "^Mixa: ", (s_underline) "~Mesa está muerta... Vinieron a llevarse a Resa y se opuso a que se llevaran
               a su hija... ¡los guardias la mataron aquí mismo!~^";
             t_resaO4: print "^Mixa: ", (s_underline) "~Vinieron y se llevaron a Resa. Mesa hizo todo lo posible para que no se 
               llevaran a su hija... ¡y los guardias la mataron!~^";
             t_palizaO4,
             t_guardiasO4: print "^Mixa: ", (s_underline) "~¡Esos malditos guardias mataron a Mesa y se llevaron a Resa!~^";
             t_simismoO4: print "^Mixa: ", (s_underline) "~Tienes que sacarnos de aquí. ¡No queremos ser vendidos como esclavos!~^";
             t_ayudaO4: print "^Mixa: ", (s_underline) "~¡No nos dejes en esta celda! ¡No queremos ser vendidos a nadie!~^";
             default: print "^Mixa: ", (s_underline) "~¡General Jennir! ¡Sácanos de esta celda!.~^"; 
           };
           rtrue;
  ],
  orders [;
    Mild, Strong: "De nuevo esos impulsos por atacar a seres inferiores a ti. Un verdadero Jedi no debería tener esos pensamientos.^";
    NotUnderstood, Tell: <<Ask self>>;
  ],
has animate female concealed;

Object decorado_celdasO4 limbo
class decorado
with  describe
       'nosaurianos' "Han huido hacia el exterior." G_PLURAL
       'prisioneros' "Han huido hacia el exterior." G_PLURAL
       'nosaurianas' "Han huido hacia el exterior." G_FEMENINO+G_PLURAL
       'prisioneras' "Han huido hacia el exterior." G_FEMENINO+G_PLURAL
       'prisionera' "Ha huido junto con el resto de nosaurianos." G_FEMENINO
       'mixa' "Ha huido junto con el resto de nosaurianos." G_FEMENINO
       'nosauriana' "Ha huido junto con el resto de nosaurianos." G_FEMENINO,
  before[;
    examine: rfalse;
    default: "Todos los nosaurianos han huido al exterior.";
  ],
;

Lugar CantinaO4 "Interior de la Cantina"
with 
  name 'cantina',
  description "La cantina es el lugar donde pilotos, contrabandistas y habitantes del lugar vienen a beber y jugar. El interior está más
    oscuro de lo que te gustaría, con rincones prácticamente entre tinieblas. Seguramente, los parroquianos habituales del lugar no quieren
    que se les vea claramente... Bien pensado, la penumbra interior, combinada con la entrada iluminada, permite a los de adentro ver a los
    recién llegados antes que éstos a ellos. Cuando tus ojos se acostumbran a la escasa luz interior, te asombras por la diversidad de seres
    que hay en la cantina. Un murmullo constante de conversaciones en lenguas de diferentes orígenes se mezcla con la música de la banda que
    toca en un rincón del local, formada por cuatro músicos Bith.",
  out_to CalleO4_1,
;

Object decorado_cantinaO4 CantinaO4
class decorado
with  describe
       'piloto' "Pilotos de todos los rincones de la galaxia esperando alquilar su nave para algún transporte." 0
       'pilotos' "Pilotos de todos los rincones de la galaxia esperando alquilar su nave para algún transporte." G_PLURAL
       'contrabandista' "Las cantinas son el lugar perfecto para sus negocios ocultos." 0
       'contrabandistas' "Las cantinas son el lugar perfecto para sus negocios ocultos." G_PLURAL
       'seres' "La cantina es el lugar donde pilotos, contrabandistas y habitantes del lugar vienen a beber y jugar." G_PLURAL
       'habitantes' "Vienen aquí a beber mientras se juegan su dinero." G_PLURAL
       'clientes' "La cantina es el lugar donde pilotos, contrabandistas y habitantes del lugar vienen a beber y jugar." G_PLURAL
       'iluminacion' "La iluminación es escasa para producir tinieblas donde realizar negocios poco legales." G_FEMENINO
       'banda' "Cuatro músicos Bith amenizan el local." G_FEMENINO
       'bith' "Cuatro músicos Bith amenizan el local." G_PLURAL
       'musico' "Cuatro músicos Bith amenizan el local." G_PLURAL
       'musicos' "Cuatro músicos Bith amenizan el local." G_PLURAL,
  before[;
    examine: rfalse;
    default: "No conviene hacer eso.";
  ],
;

Object oTaberneroO4 "Tabernero" CantinaO4
  with
    name 'tabernero' 'camarero' 'dueno',
    description "El tabernero es un enorme humano de aspecto sucio. Con voz imponente y grave atiende a todos los clientes.", 
    bonif_defensiva 15,
    bonif_ofensiva 15,
    vida 50,
    dado_golpe 1 6 0, !1d6+0
    life [;
	    Attack: "Deberías pasar inadvertido en estos tiempos oscuros... Lo que menos te conviene ahora mismo es montar un jaleo.^";
        tell,answer,
        ask: "Está demasiado atareado para hacerte caso.";
    ],
    orders [;
      Mild, Strong: "No estaría bien enfadarlo.^";
      NotUnderstood, Tell: <<Ask self>>;
    ],
    before [;
      Sanar,
	  Levitar: "No deberías ir alardeando de tus poderes de jedi... son tiempos oscuros para los de tu Orden.^";
	  Push, Aturdir: "No estaría bien enfadarlo.^";
      Enganyar: "La persuasión mediante la Fuerza sólo funciona con seres de mente débil.^";
      Sentir, 
      Concentrar: "La Fuerza habita en el interior de todos los seres vivos.^";
    ],
has animate proper objetivo transparent scenery;

Object oSnifflesO4 "Sniffles" CantinaO4
  with
    name 'sniffles' 'elomin' 'humanoide',
    description [;
      if (self.vida==0) "Sniffles yace inconsciente en el suelo.";
      "Apoyado en una zona oscura de la barra, distingues las orejas puntiagudas de Sniffles, gracias a su altura de 1.90. Está en la 
      cantina haciendo averiguaciones.";
    ], 
    bonif_defensiva 15,
    bonif_ofensiva 15,
    vida 50,
    dado_golpe 1 6 0, !1d6+0
    life [tema;
	    Attack: "Vuelven a invadirte los impulsos de atacar a un ser amigo... Por esta vez consigues reprimirlos, pero cada vez te cuesta más...^";
        tell,answer,
        ask: if (oGuardiasNivInfO4_2 hasnt muerto) {
	           print "^Sniffles: ", (s_underline) "~Lo siento Jennir, todavía no he averiguado nada útil. Déjame algo más de tiempo.~^";
	           rtrue;
	         }
           if (self.vida==0) {
	         "Sniffles yace inconsciente en el suelo. Dificilmente responderá a tus preguntas.^";
           };
           tema=AveriguarTema(TemasOrvax4);
           if (oMeettoO4 in limbo) {
	       switch(tema) {
             t_familiabomoO4,
             t_prisioneroO4: print "^Sniffles: ", (s_underline) "~Averigüé que Meetto, un mercader toydoriano, puede tener información 
                     sobre quién vendió a la hija de Bomo.~^";
                     move oMeettoO4 to PlazaO4;
             t_mesaO4: print "^Sniffles: ", (s_underline) "~Pobre Bomo... Se va a hundir cuando sepa que han matado a su mujer.~^";
             t_resaO4: print "^Sniffles: ", (s_underline) "~Preguntando a unos y a otros he averiguado que Meetto, un comerciante 
                     toydariano, puede proporcionarnos información sobre la hija de Bomo.~^";
                     move oMeettoO4 to PlazaO4;
             t_guardiasO4: print "^Sniffles: ", (s_underline) "~Hay patrullas por toda la ciudad. Parece que los ánimos están caldeados.~^";
             t_simismoO4: print "^Sniffles: ", (s_underline) "~Estoy preguntando a unos y a otros a ver si averiguo algo.~^";
             t_ayudaO4: print "^Sniffles: ", (s_underline) "~Meetto, un mercader toydariano, puede tener información sobre quién 
                        vendió a la hija de Bomo.~^";
                        move oMeettoO4 to PlazaO4;
             t_meettoO4: print "^Sniffles: ", (s_underline) "~Meetto es un mercader toydariano que suele estar en la plaza. He averiguado
                         que puede tener información sobre quién vendió a la hija de Bomo.~^";
                     move oMeettoO4 to PlazaO4;
             t_misionO4: print "^Sniffles: ", (s_underline) "~Averigüé que Meetto, un mercader toydariano, puede tener información sobre quién 
                        vendió a la hija de Bomo.~^";
                     move oMeettoO4 to PlazaO4;
             t_dineroO4: print "^Sniffles: ",(s_underline) "~Sé como conseguir algo de dinero. Ese humano de ahí al fondo admite apuestas en
                         partidas al Dejarik.~"; 
                         move oJaxfSevalO4 to CantinaO4;
             t_dejarikO4: print "^Sniffles: ",(s_underline) "~¿No sabes jugar? Ese tío es muy bueno. No ha perdido ninguna partida desde que
                         estoy aquí. A mi me desplumaría enseguida.~"; 
                         move oJaxfSevalO4 to CantinaO4;
             t_apuestasO4: print "^Sniffles: ",(s_underline) "~Puedes apostar jugando al Dejarik contra ese humano de ahí al fondo. Pero te
                         advierto que no ha perdido ninguna partida desde que estoy aquí.~"; 
                         move oJaxfSevalO4 to CantinaO4;
             default: print "^Sniffles: ", (s_underline) "~Lo siento, no te puedo contestar a eso.~^"; 
           };
           } else {
		       switch(tema) {
	             t_familiabomoO4,
	             t_prisioneroO4: print "^Sniffles: ", (s_underline) "~Averigüé que Meetto, un mercader toydoriano, puede tener información 
	                     sobre quién vendió a la hija de Bomo.~^";
	                     move oMeettoO4 to PlazaO4;
	             t_mesaO4: print "^Sniffles: ", (s_underline) "~Pobre Bomo... Se va a hundir cuando sepa que han matado a su mujer.~^";
	             t_resaO4: print "^Sniffles: ", (s_underline) "~Preguntando a unos y a otros he averigüado que Meetto, un comerciante 
	                     toydariano, puede proporcionarnos información sobre la hija de Bomo.~^";
	                     move oMeettoO4 to PlazaO4;
	             t_guardiasO4: print "^Sniffles: ", (s_underline) "~Hay patrullas por toda la ciudad. Parece que los ánimos están caldeados.~^";
	             t_simismoO4: print "^Sniffles: ", (s_underline) "~Estoy preguntando a unos y a otros a ver si averiguo algo.~^";
	             t_ayudaO4: print "^Sniffles: ", (s_underline) "~Meetto, un mercader toydariano, puede tener información sobre quién 
	                        vendió a la hija de Bomo.~^";
	                        move oMeettoO4 to PlazaO4;
	             t_meettoO4: print "^Sniffles: ", (s_underline) "~Meetto es un mercader toydariano que suele estar en la plaza. He averiguado
	                         que puede tener información sobre quién vendió a la hija de Bomo.~^";
	                     move oMeettoO4 to PlazaO4;
	             t_misionO4: print "^Sniffles: ", (s_underline) "~Averigüé que Meetto, un mercader toydariano, puede tener información sobre quién 
	                        vendió a la hija de Bomo.~^";
	                     move oMeettoO4 to PlazaO4;
                 t_dineroO4: print "^Sniffles: ",(s_underline) "~Sé como conseguir algo de dinero. Ese humano de ahí al fondo admite apuestas en
                             partidas al Dejarik.~"; 
                         move oJaxfSevalO4 to CantinaO4;
                 t_dejarikO4: print "^Sniffles: ",(s_underline) "~¿No sabes jugar? Ese tío es muy bueno. No ha perdido ninguna partida desde que
                         estoy aquí. A mi me desplumaría enseguida.~"; 
                         move oJaxfSevalO4 to CantinaO4;
                 t_apuestasO4: print "^Sniffles: ",(s_underline) "~Puedes apostar jugando al Dejarik contra ese humano de ahí al fondo. Pero te
                         advierto que no ha perdido ninguna partida desde que estoy aquí.~"; 
                         move oJaxfSevalO4 to CantinaO4;
	             default: print "^Sniffles: ", (s_underline) "~Lo siento, no te puedo contestar a eso.~^"; 
	           };
           }
             rtrue;
    ],
    orders [;
      Mild, Strong: "Sniffles es de los tuyos y no se merece este trato.^";
      NotUnderstood, Tell: <<Ask self>>;
    ],
    before [;
      Sanar: print "Te concentras y notas como la Fuerza pasa a través de tu cuerpo hacia el de Sniffles, recuperándolo completamente.^";
             self.vida = 50;
             rtrue;
	  Levitar: "No deberías ir alardeando de tus poderes de jedi... son tiempos oscuros para los de tu Orden.^";
	  Push, Aturdir: "Sniffles es de los tuyos y no estaría bien enfadarlo.^";
      Enganyar: "La persuasión mediante la Fuerza sólo funciona con seres de mente débil.^";
      Sentir, 
      Concentrar: "La Fuerza habita en el interior de todos los seres vivos.^";
    ],
has animate proper objetivo transparent;

Object decorado_snifflesO4 oSnifflesO4
class decorado
with  describe
       'oreja' "Grandes y puntiagudas." G_FEMENINO
       'orejas' "Grandes y puntiagudas." G_FEMENINO+G_PLURAL
       'cuernos' "Cuatro pequeñas protuberancias en su cabeza." G_PLURAL
       'cuerno' "Cuatro pequeñas protuberancias en su cabeza." 0
       'protuberancia' "Cuatro pequeños cuernos en su cabeza." G_FEMENINO
       'protuberancias' "Cuatro pequeños cuernos en su cabeza." G_FEMENINO+G_PLURAL
       'piel' "Brillante y de color granate." G_FEMENINO,
  before[;
    examine: rfalse;
    default: print "No conviene hacer eso."; rtrue;
  ],
;

Object oJaxfSevalO4 "Jaxfr Seval" limbo
  with
    name 'jaxf' 'seval' 'humano' 'jugador' 'apostante',
    description "En un rincón poco iluminado de la cantina, un humano de mediana edad, pelo negro y de complexión fuerte se encuentra
       sentado frente a una mesa ocupada por un tablero de Dejarik y algunos vasos. No tiene pinta de ser alguien del que uno podría
       fiarse, pero... ¿acaso alguno de todos los seres que hay en la cantina es de fiar?", 
    bonif_defensiva 15,
    bonif_ofensiva 15,
    vida 50,
    dado_golpe 1 6 0, !1d6+0
    jugando 0, !0:No se ha iniciado partida 1:Turno 1 2:Turno 2 3:Turno3 4:Otra partida
    life [tema;
	    Attack: "Deberías pasar inadvertido en estos tiempos oscuros... Lo que menos te conviene ahora mismo es montar un jaleo.^";
        tell,answer,
        ask: if (self.vida==0) {
	           "Jaxf Seval yace inconsciente en el suelo. Dificilmente responderá a tus preguntas.^";
             };
             tema=AveriguarTema(TemasOrvax4);
             if (self.jugando==0) {
	           switch(tema) {
                 t_dineroO4: print "^Jaxf Seval: ",(s_underline) "~Si crees que me puedes ganar, pon tu dinero en la mesa y juguemos.~"; 
                 t_dejarikO4: print "^Jaxf Seval: ",(s_underline) "~Si crees que me puedes ganar, pon tu dinero en la mesa y juguemos.~"; 
                 t_apuestasO4: print "^Jaxf Seval: ",(s_underline) "~Si crees que me puedes ganar, pon tu dinero en la mesa y juguemos.~"; 
                 t_uhumeleO4: print "^Jaxf Seval: ",(s_underline) "~¿Quieres apostar tu nave? Tráeme el módulo de control y jugaré contigo.~"; 
                 default: print "^Jaxf Seval: ", (s_underline) "~No me molestes, chaval. Si crees que me puedes ganar, pon tu dinero 
                          en la mesa y juguemos.~^";
               }
             } else {
	             if (self.jugando==4) {
	               switch(tema) {
                     t_dineroO4: print "^Jaxf Seval: ",(s_underline) "~¿No has tenido suficiente, chaval? Trae más dinero y juguemos otra partida.~"; 
                     t_dejarikO4: print "^Jaxf Seval: ",(s_underline) "~¿No has tenido suficiente, chaval? Trae más dinero y juguemos otra partida.~"; 
                     t_apuestasO4: print "^Jaxf Seval: ",(s_underline) "~¿No has tenido suficiente, chaval? Trae más dinero y juguemos otra partida.~"; 
                     t_uhumeleO4: print "^Jaxf Seval: ",(s_underline) "~¿Qué quieres recuperar tu nave? ¡Jajaja! ¡No voy a ser tan tonto de jugarme
                                  una nave como esa! ¡Nunca la recuperarás! ¡Jajajaja!~"; 
                     default: print "^Jaxf Seval: ", (s_underline) "~No me molestes, chaval. Si no has tenido suficiente, pon más dinero 
                              en la mesa y juguemos otra partida.~^";
                   }
	             } else {
                     print "^Jaxf Seval: ", (s_underline) "~¡Cállate! ¡Estamos jugando!.~^";
	             }
             };
             rtrue;
    ],
    orders [;
      Mild, Strong: "Ahora mismo no te conviene montar ningún jaleo.^";
      NotUnderstood, Tell: <<Ask self>>;
    ],
    before [;
      Sanar,
      Levitar: "No deberías ir alardeando de tus poderes de jedi... son tiempos oscuros para los de tu Orden.^";
	  Push, Aturdir: "Ahora mismo no te conviene montar ningún jaleo.^";
      Enganyar: "La persuasión mediante la Fuerza sólo funciona con seres de mente débil.^";
      Sentir, 
      Concentrar: "La Fuerza habita en el interior de todos los seres vivos.^";
    ],
has animate proper objetivo transparent;

Object oMesaO4 "Mesa" CantinaO4
  with
    name 'mesa',
    adjectives 'madera' 'jugador' 'tablero' 'jaxf' 'seval',
    description "Una mesa de madera como cualquier otra de las que hay en la cantina.", 
    before [;
      Sanar: "La sanación mediante la Fuerza sólo funciona con seres vivos.";
	  Levitar: "No deberías ir alardeando de tus poderes de jedi... son tiempos oscuros para los de tu Orden.^";
      Enganyar: "La persuasión mediante la Fuerza sólo funciona con seres vivos.^";
      Sentir, 
      Concentrar: "A pesar de tus esfuerzos, no sientes nada con la mesa.^";
      Push, Aturdir,
	  Attack: "Deberías pasar inadvertido en estos tiempos oscuros... Lo que menos te conviene ahora mismo es montar un jaleo.^";
	  receive: rtrue;
	  letgo: "Será mejor que no robes nada de la mesa.";
    ],
has scenery supporter;

Object decorado_JaxfSevalO4 oMesaO4
class decorado
with  describe
       'tablero' "Sobre el tablero descansan las fichas de Dejarik." 0
       'dejarik' "Sobre el tablero descansan las fichas de Dejarik." 0
       'vaso' "Hay varios vasos sobre la mesa, lo que indica que Jaxf Seval lleva un buen rato en la cantina." 0
       'vasos' "Hay varios vasos sobre la mesa, lo que indica que Jaxf Seval lleva un buen rato en la cantina." G_PLURAL
       'fichas' "Las fichas del Dejarik son holográficas y tienen la forma de diferentes criaturas. Descansan sobre el tablero." G_FEMENINO+G_PLURAL,
  before[;
    examine: rfalse;
    default: print "No conviene hacer eso."; rtrue;
  ],
;



!===============================================================================
! (9) Otras Rutinas Reemplazadas; Rutinas Propias del Juego
!-------------------------------------------------------------------------------
! [ AskTopicsScope;
!   switch (scope_stage) {
!    1: rfalse;
!    2: ScopeWithin(AskTopics); rtrue;
!    3: "En este momento, incluso las preguntas más simples son demasiado confusas.";
!   }
! ];

[ RandomMessages ;
   if (location == paso) {
      if (oArboles hasnt cortado) {
	    switch(random(10)) {
	      1: print (s_underline) "^~¡Ough!~ ", "- puedes ver como uno de tus soldados nosaurianos cae abatido por un disparo
	                de un soldado clon.^";
	      2: print (s_underline) "^~¡Mi general! ¡Debemos hacer algo para bloquear el avance de los tanques!~ ", "- te grita un nosauriano^";
	      3: print "^El ejército clon sigue avanzando implacable entre los árboles, apoyado por los tanques, y cada vez se os hace más
	                difícil aguantar la posición.^";
	      4: print "^El ejército clon avanza imparable a costa de la vida de tus soldados... Los nosaurianos esperan de ti, como general Jedi, 
	                que encuentres una solución milagrosa que detenga a los tanques.^";
	      5: Damusix.TocarV(sndExplosion,VOLUMEN_ALTO);
	         print (s_underline) "^~¡BOOOOMMMMM!~ ", "- un cañón láser abre brecha entre tus soldados, convirtiéndolos en cadáveres humeantes.^";
	      6: print "^Esto empieza a ser ya una masacre... Los disparos imperiales son cada vez más certeros, causando verdaderos estragos
	                entre tus tropas, incapaces de detener el avance de los clones. Debes actuar rápidamente o la derrota será inminente y
	                no habrá oportunidad de escapar para las mujeres y niños nosaurianos que hacia el puerto espacial de Cadgel Meadows.^";
	      7: print (s_underline) "^~¡General Jennir! ¡Quizás los árboles nos puedan servir para detener el avance de los tanques!~^";
	      8: print "^Un disparo láser de uno de los tanques impacta cerca de tu posición, calcinando a uno de tus soldados.^";
	      9: print (s_underline) "^~¡Se están acercando! ¡Van a aniquilarnos!~^";
	      10: print (s_underline) "^~¡No podemos pararlos! ¡Deberíamos retirarnos!~^";
	    };
      };
   }
   if (location == ladera) {
      if (oArboles2 hasnt cortado) {
	    switch(random(10)) {
	      1: print (s_underline) "^~¡Ough!~ ", "- puedes ver como uno de tus soldados nosaurianos cae abatido por un disparo
	                de un soldado clon.^";
	      2: print (s_underline) "^~¡Mi general! ¡Los tanques siguen avanzando!~^";
	      3: print "^El ejército clon ha conseguido reorganizarse tras tu ataque y avanza entre los árboles. Tus combatientes te miran
	               esperando que hagas algo que dentenga a los clones de una vez por todas.^";
	      4: print "^El ejército clon, regorganizado tras superar tu primer obstáculo, vuelve a avanzar imparable, llevándose por delante
	               la vida de decenas de tus soldados... Los nosaurianos esperan que, como el general que eres, hagas algo milagroso que
	               detenga a los invasores.^";
	      5: Damusix.TocarV(sndExplosion,VOLUMEN_ALTO);
	         print (s_underline) "^~¡BOOOOMMMMM!~ ", "- un cañón láser abre brecha entre tus soldados, convirtiéndolos en cadáveres humeantes.^";
	      6: print "^Esto empieza a ser ya una masacre... Los disparos imperiales son cada vez más certeros, causando verdaderos estragos
	                entre tus tropas, incapaces de detener el avance de los clones. Debes actuar rápidamente o la derrota será inminente y
	                no habrá oportunidad de escapar para las mujeres y niños nosaurianos que hacia el puerto espacial de Cadgel Meadows.^";
	      7: print (s_underline) "^~¡General Jennir! ¡Quizás los árboles nos puedan servir para detener el avance de los tanques!~^";
	      8: print "^Un disparo láser de uno de los tanques impacta cerca de tu posición, calcinando a uno de tus soldados.^";
	      9: print (s_underline) "^~¡Se están acercando! ¡Van a aniquilarnos!~^";
	      10: print (s_underline) "^~¡No podemos pararlos! ¡Deberíamos retirarnos!~^";
	    };
      } else {
	      glk_request_timer_events(0); ! desactivamos el timer
	      mensajes_aleatorios = false; ! ELIUK: avisamos que estan desactivados
      };
   }
];

! Funcion: RandomEffectsLabyrinth
! Función que muestra efectos ambientales aleatorios para dar la sensación
! de un mundo vivo. Estos efectos ambientales son simplemente eso, ambientación,
! sin ser relevantes para en el hilo argumental de la aventura.
! Parametros: prob - Probabilidad (0-100) de que ocurra un evento
!
[ RandomEffectsLabyrinth prob;
  if (random(100)-1 < prob) {
	  switch (random(7)) {
		  1: print "^Unos pequeños animales carroñeros, parecidos a ratas pero algo más grandes, cruzan corriendo desde el callejón de la parte sur,
	          desapareciendo rápidamente por la parte norte.^";
		  2: print "^Una ráfaga de aire viciado que proviene del callejón sur levanta un remolino de polvo a su paso. Cuando el viento se calma,
		      la porquería levantada vuelve a posarse en el suelo.^";
		  3: print "^De repente, crees oir lo que parece ser un lejano y ahogado grito de lamento proviniente del callejón sur.^";
		  4: print "^Un robot de vigilancia AC1 aparece volando por el callejón sur y, siguiendo su camino, se marcha por la parte norte.^";
		  5: print "^Un droide de mantenimiento MN-2E llega desde el sur. Una vez ha recogido del suelo algo de basura, se marcha por el norte.^";
		  6: print "^Una unidad R4 se acerca a tu posición desde el callejón situado al sur. Emite su habitual sonido cuando pasa por tu lado, antes
		      de desaparecer por la parte norte.^";
		  7: print "^Un par de seres que no logras distinguir bien, seguramente traficantes o contrabandistas, se ocultan rápidamente entre las sombras 
		      que hay hacia el sur en cuanto te ven acercarte.^";
	  }
  };
];

[QuejasBomo tipo msg;
   msg="";
   if (tipo == 1) {
	    switch(random(3)) {
	      1: msg="¡Déjame en el suelo!";
	      2: msg="¡Bájame, maldito jedi!";
	      3: msg="¡Maldito seas, Jennir!";
	    };
   }
   if (tipo == 2) {
	    switch(random(3)) {
	      1: msg="¡Como vuelvas a hacer eso te disparo con el blaster!";
	      2: msg="¡Vuélvelo a hacer y eres hombre muerto!";
	      3: msg="¡No me gusta que practiques tus truquitos jedis conmigo!";
	    };
   }
   return msg;
];

[GirarCaza encarada dir msg;
   msg="";
   
   switch (location) {
	   CazaVwingN: switch(encarada) {
		             's': msg = "Ahora la nave está encarada hacia el exterior de Cadgel Meadows.^";
		             'o': if (dir=='i') {
			                msg = "Ahora la nave está encarada hacia la pista de Cadgel Meadows.^";
		                  } else {
			                msg = "Ahora la nave está encarada hacia el exterior de Cadgel Meadows.^";
		                  }
		             'e': if (dir=='d') {
			                msg = "Ahora la nave está encarada hacia la pista de Cadgel Meadows.^";
		                  } else {
			                msg = "Ahora la nave está encarada hacia el exterior de Cadgel Meadows.^";
		                  }
		             'n': msg = "Ahora la nave está encarada hacia el exterior de Cadgel Meadows.^";
	               }
	   CazaVwingS: switch(encarada) {
		             's': msg = "Ahora la nave está encarada hacia el exterior de Cadgel Meadows.^";
		             'o': if (dir=='d') {
			                msg = "Ahora la nave está encarada hacia la pista de Cadgel Meadows.^";
		                  } else {
			                msg = "Ahora la nave está encarada hacia el exterior de Cadgel Meadows.^";
		                  }
		             'e': if (dir=='i') {
			                msg = "Ahora la nave está encarada hacia la pista de Cadgel Meadows.^";
		                  } else {
			                msg = "Ahora la nave está encarada hacia el exterior de Cadgel Meadows.^";
		                  }
		             'n': msg = "Ahora la nave está encarada hacia el exterior de Cadgel Meadows.^";
	               }
	   CazaVwingE: switch(encarada) {
		             'e': msg = "Ahora la nave está encarada hacia el exterior de Cadgel Meadows.^";
		             's': if (dir=='d') {
			                msg = "Ahora la nave está encarada hacia la pista de Cadgel Meadows.^";
		                  } else {
			                msg = "Ahora la nave está encarada hacia el exterior de Cadgel Meadows.^";
		                  }
		             'n': if (dir=='i') {
			                msg = "Ahora la nave está encarada hacia la pista de Cadgel Meadows.^";
		                  } else {
			                msg = "Ahora la nave está encarada hacia el exterior de Cadgel Meadows.^";
		                  }
		             'o': msg = "Ahora la nave está encarada hacia el exterior de Cadgel Meadows.^";
	               }
	   CazaVwingO: switch(encarada) {
		             'e': msg = "Ahora la nave está encarada hacia el exterior de Cadgel Meadows.^";
		             'n': if (dir=='d') {
			                msg = "Ahora la nave está encarada hacia la pista de Cadgel Meadows.^";
		                  } else {
			                msg = "Ahora la nave está encarada hacia el exterior de Cadgel Meadows.^";
		                  }
		             's': if (dir=='i') {
			                msg = "Ahora la nave está encarada hacia la pista de Cadgel Meadows.^";
		                  } else {
			                msg = "Ahora la nave está encarada hacia el exterior de Cadgel Meadows.^";
		                  }
		             'o': msg = "Ahora la nave está encarada hacia el exterior de Cadgel Meadows.^";
	               }
	   CazaVwingP: switch(encarada) {
		             'e': if (dir=='d') {
			                msg = "Ahora la nave está encarada hacia el hangar sur de Cadgel Meadows.^";
		                  } else {
			                msg = "Ahora la nave está encarada hacia el hangar norte Cadgel Meadows.^";
		                  }
		             'n': if (dir=='d') {
			                msg = "Ahora la nave está encarada hacia el hangar este de Cadgel Meadows.^";
		                  } else {
			                msg = "Ahora la nave está encarada hacia el hangar oeste de Cadgel Meadows.^";
		                  }
		             's': if (dir=='d') {
			                msg = "Ahora la nave está encarada hacia el hangar oeste de Cadgel Meadows.^";
		                  } else {
			                msg = "Ahora la nave está encarada hacia el hangar este de Cadgel Meadows.^";
		                  }
		             'o': if (dir=='d') {
			                msg = "Ahora la nave está encarada hacia el hangar norte de Cadgel Meadows.^";
		                  } else {
			                msg = "Ahora la nave está encarada hacia el hangar sur de Cadgel Meadows.^";
		                  }
	               }
   }
   return msg;
];

[DireccionCaza encarada msg;
   msg="";
   
   switch (location) {
	   CazaVwingN: switch(encarada) {
		             's': msg = "La nave está encarada hacia la pista de Cadgel Meadows.^";
		             default: msg = "La nave está encarada hacia el exterior de Cadgel Meadows.^";
	               }
	   CazaVwingS: switch(encarada) {
		             'n': msg = "La nave está encarada hacia la pista de Cadgel Meadows.^";
		             default: msg = "La la nave está encarada hacia el exterior de Cadgel Meadows.^";
	               }
	   CazaVwingE: switch(encarada) {
		             'o': msg = "La nave está encarada hacia la pista de Cadgel Meadows.^";
		             default: msg = "La nave está encarada hacia el exterior de Cadgel Meadows.^";
	               }
	   CazaVwingO: switch(encarada) {
		             'e': msg = "La nave está encarada hacia la pista de Cadgel Meadows.^";
		             default: msg = "La nave está encarada hacia el exterior de Cadgel Meadows.^";
	               }
	   CazaVwingP: switch(encarada) {
		             'n': msg = "La nave está encarada hacia el hangar norte de Cadgel Meadows.^";
		             's': msg = "La nave está encarada hacia el hangar sur de Cadgel Meadows.^";
		             'e': msg = "La nave está encarada hacia el hangar este de Cadgel Meadows.^";
		             'o': msg = "La nave está encarada hacia el hangar oeste de Cadgel Meadows.^";
	               }
   }
   return msg;
];
!===============================================================================
! (10) Verbos y Gramaticas Propias del Juego
!-------------------------------------------------------------------------------
Include "includes/eujgramatica.inf";

!===============================================================================
! (11) Rutinas de Acciones Propias del Juego
!-------------------------------------------------------------------------------

! Calcula el daño hecho.
[ calcular_golpe weapon dice golpe;
  if (weapon.#dado_golpe ~= 12)
     "[ coding error: ",(the)weapon," has invalid hit_dice ]";
  for (dice = 0 : dice < weapon.&dado_golpe-->0 : dice++) {
    golpe = golpe + random(weapon.&dado_golpe-->1);
  }
  return golpe + weapon.&dado_golpe-->2;
];

[ get_bo atacante arma bo;
  bo = 0;
  if (atacante provides bonif_ofensiva)
    bo = atacante.bonif_ofensiva;
  else
    bo = 10;
  if (arma provides bonif_ofensiva)
    bo = bo + arma.bonif_ofensiva;

  return bo;
];

[ get_bd defensor bd item;
  bd = 0;
  if (defensor provides bonif_defensiva)
    bd = defensor.bonif_defensiva;
  else
    bd = 10;
  objectloop (item in defensor) {
    if (item has worn)
      if (item provides bonif_defensiva)
        bd = bd + item.bonif_defensiva;
  }
  return bd;
];

[ turno_combate atacante defensor arma bo bd golpe;

  if (defensor provides multiple) {
	  multi_combate(atacante,defensor,arma);
	  rtrue;
  }

  bo = get_bo(atacante, arma);
  bd = get_bd(defensor);
  golpe = 0;
  
  if (bo>bd) {
	  !El ataque tiene éxito
	  if (arma == nothing)
	    golpe = calcular_golpe(atacante);
	  else 
	    golpe = calcular_golpe(arma);
	  if (atacante == player)
	    if (arma==oFuerza)
	      print "^Con una ráfaga de Fuerza que sale de tu mano abierta derribas con éxito a ",(the)defensor,", quitándole ",golpe," puntos de vida.";
	    else
          print "^Atacas con éxito a ",(the)defensor,", quitándole ",golpe," puntos de vida.";
      else
        print "^",(The)atacante, " ataca con éxito a ",(the)defensor,", quitándole ",golpe," puntos de vida.";
      
      defensor.vida = defensor.vida - golpe;
  } else {
	  !El ataque falla
	  if (atacante == player)
        print "^Lanzas tu ataque, pero ",(the)defensor," lo esquiva con facilidad.";
      else
        print "^",(The)atacante, " lanza su ataque, pero ",(the)defensor," lo esquiva con facilidad.";
  }

  if (defensor.vida < 1) {
	  give defensor muerto;
	  "^",(The)defensor, " cae muerto debido a las heridas sufridas.";
  }
  
  switch(defensor.vida) {
	  1,2,3,4,5,6,7,8,9,10: print "^",(The)defensor, " tiene heridas extremadamente graves.";
	  11,12,13,14,15,16,17,18,19,20: print "^",(The)defensor, " tiene heridas graves.";
	  21,22,23,24,25,26,27,28,29,30: print "^",(The)defensor, " tiene heridas moderadas.";
	  31,32,33,34,35,36,37,38,39,40: print "^",(The)defensor, " está levemente herido.";
  }
  
  !Si el ataque es usando la Fuerza, el rival no tiene capacidad de respuesta
  if (arma==oFuerza) rtrue;
  
  bo = get_bo(defensor, nothing);
  bd = get_bd(atacante);
  golpe = 0;
  
  if (bo>bd) {
	  !El ataque tiene éxito
      golpe = calcular_golpe(defensor);
  
	  if (atacante == player)
        print "^",(The)defensor, " te ataca con éxito, quitándote ",golpe," puntos de vida.";
      else
        print "^",(The)defensor, " ataca con éxito a ",(the)atacante,", quitándole ",golpe," puntos de vida.";
      
      atacante.vida = atacante.vida - golpe;
  } else {
	  !El ataque falla
	  if (atacante == player)
        print "^",(The)defensor, " lanza su ataque, pero lo esquivas con facilidad.";
      else
        print "^",(The)defensor, " lanza su ataque, pero ",(the)atacante," lo esquiva con facilidad.";
  }
  
  if (atacante == player) {
    switch(atacante.vida) {
	  1,2,3,4,5,6,7,8,9,10: print "^Tienes heridas extremadamente graves.";
	  11,12,13,14,15,16,17,18,19,20: print "^Tienes heridas graves.";
	  21,22,23,24,25,26,27,28,29,30: print "^Tienes heridas moderadas.";
	  31,32,33,34,35,36,37,38,39,40: print "^Estás levemente herido.";
    }
  } else {
    switch(atacante.vida) {
	  1,2,3,4,5,6,7,8,9,10: print "^",(The)atacante, " tiene heridas extremadamente graves.";
	  11,12,13,14,15,16,17,18,19,20: print "^",(The)atacante, " tiene heridas graves.";
	  21,22,23,24,25,26,27,28,29,30: print "^",(The)atacante, " tiene heridas moderadas.";
	  31,32,33,34,35,36,37,38,39,40: print "^",(The)atacante, " está levemente herido.";
    }
  }

  
  if (atacante.vida < 1) {
	  if (atacante == player) {
        print "^",(The)defensor, " te derrota y caes muerto.";
        deadflag=1;
      } else {
	    give atacante muerto;
        print "^",(The)defensor, " derrota a ",(the)atacante,", que cae muerto debido a las heridas causadas.";
      }
  }

];


[ multi_combate atacante defensor arma bo bd golpe multi k;
  bo = get_bo(atacante, arma);
  bd = get_bd(defensor);
  golpe = 0;

  if (defensor provides multiple) multi=defensor.multiple;
  else multi=1;
  
  !Si hay empate, 50% de tener éxito
  if (bo==bd)
    if (random(2)==1) bo++;
    
  if (bo>bd) {
	  !El ataque tiene éxito
	  if (arma == nothing)
	    golpe = calcular_golpe(atacante);
	  else 
	    golpe = calcular_golpe(arma);
	  if (atacante == player)
	    if (arma==oFuerza)
	      print "Con una ráfaga de Fuerza que sale de tu mano abierta derribas 
	             con éxito a ",(string)defensor.printname(),", quitándole ",golpe," puntos de vida.^";
	    else
          print "Atacas con éxito a ",(string)defensor.printname(),", quitándole ",golpe," puntos de vida.^";
      else
        print (The)atacante, " ataca con éxito a ",(string)defensor.printname(),", quitándole ",golpe," puntos de vida.^";
      
      defensor.vida = defensor.vida - golpe;
		switch(defensor.vida) {
		  1,2,3,4,5,6,7,8,9,10: defensor.printcasename();print " tiene heridas extremadamente graves.^";
		  11,12,13,14,15,16,17,18,19,20: defensor.printcasename();print " tiene heridas graves.^";
		  21,22,23,24,25,26,27,28,29,30: defensor.printcasename();print " tiene heridas moderadas.^";
		  31,32,33,34,35,36,37,38,39,40: defensor.printcasename();print " está levemente herido.^";
		}
		if (defensor.vida < 1) {
		  if (multi>1) {
			  defensor.printcasename();print " de ",(the)defensor," cae muerto debido a las heridas sufridas.^";
			  defensor.multiple--;
			  multi--;
			  defensor.vida = defensor.topvida;
		  } else {
		      give defensor muerto;
		      defensor.printcasename();print " cae muerto debido a las heridas sufridas.^";
		      rtrue;
		  }
		}
  } else {
	  !El ataque falla
	  if (atacante == player)
        print "Lanzas tu ataque, pero ",(the)defensor," lo esquiva con facilidad.^";
      else
        print (The)atacante, " lanza su ataque, pero ",(the)defensor," lo esquiva con facilidad.^";
  }

  
  
  !Si el ataque es usando la Fuerza, el rival no tiene capacidad de respuesta
  if (arma==oFuerza && multi>0 && defensor.vida ~= defensor.topvida ) multi--;
  
  for (k=1:k<=multi:k++) {
  bo = get_bo(defensor, nothing)*multi;
  bd = get_bd(atacante);
  golpe = 0;
  
  !Si hay empate, 50% de tener éxito
  if (bo==bd)
    if (random(2)==1) bo++;

  if (bo>bd) {
	  !El ataque tiene éxito
      golpe = calcular_golpe(defensor);
  
	  if (atacante == player) {
        defensor.printcasename();print " de ",(the)defensor, " te ataca con éxito, quitándote ",golpe," puntos de vida.^";
      } else {
        defensor.printcasename();print " de ",(the)defensor, " ataca con éxito a ",(the)atacante,", quitándole ",golpe," puntos de vida.^";
      }
      
      atacante.vida = atacante.vida - golpe;
  } else {
	  !El ataque falla
	  if (atacante == player) {
        defensor.printcasename(); print " de ",(the)defensor, " lanza su ataque, pero lo esquivas con facilidad.^";
      } else {
        defensor.printcasename(); print " de ",(the)defensor, " lanza su ataque, pero ",(the)atacante," lo esquiva con facilidad.^";
      }
  }
  
  if (atacante == player) {
    switch(atacante.vida) {
	  1,2,3,4,5,6,7,8,9,10: print "Tienes heridas extremadamente graves.^";
	  11,12,13,14,15,16,17,18,19,20: print "Tienes heridas graves.^";
	  21,22,23,24,25,26,27,28,29,30: print "Tienes heridas moderadas.^";
	  31,32,33,34,35,36,37,38,39,40: print "Estás levemente herido.^";
    }
  } else {
    switch(atacante.vida) {
	  1,2,3,4,5,6,7,8,9,10: print (The)atacante, " tiene heridas extremadamente graves.^";
	  11,12,13,14,15,16,17,18,19,20: print (The)atacante, " tiene heridas graves.^";
	  21,22,23,24,25,26,27,28,29,30: print (The)atacante, " tiene heridas moderadas.^";
	  31,32,33,34,35,36,37,38,39,40: print (The)atacante, " está levemente herido.^";
    }
  }

  
  if (atacante.vida < 1) {
	  if (atacante == player) {
        print "^",(The)defensor, " te derrota y caes muerto.^";
        deadflag=1;
        rtrue;
      } else {
	    give atacante muerto;
        print "^",(The)defensor, " derrota a ",(the)atacante,", que cae muerto debido a las heridas causadas.^";
        rtrue;
      }
  }
}

];

[moverBomo direccion loc;
  switch(direccion) {
	  n_obj: loc=location.n_to;
	  s_obj: loc=location.s_to;
	  e_obj: loc=location.e_to;
	  w_obj: loc=location.w_to;
	  ne_obj: loc=location.ne_to;
	  nw_obj: loc=location.nw_to;
	  se_obj: loc=location.se_to;
	  sw_obj: loc=location.nw_to;
	  in_obj: loc=location.in_to;
	  out_obj: loc=location.out_to;
	  default: loc=location;
  }
  if (loc==location) {
	print (s_underline) "~Preferiría quedarme a tu lado, General.~ ", "- te ruega Bomo.";
  } else {
    switch(loc) {
	  extNorte: print (s_underline) "~Echaré un vistazo.~ ", "- te contesta Bomo.^";
	            if (oSoldado in loc) {
		          print (s_underline) "~Hay al menos un clon patrullando el exterior de Cadgel Meadows.~ ", "- te informa Bomo mientras regresa a tu posición.^";
	            } else {
	              print (s_underline) "~Está todo despejado, General.~ ", "- te informa Bomo mientras regresa a tu posición.^";
                }
	  extSur: print (s_underline) "~Echaré un vistazo.~ ", "- te contesta Bomo.^";
	            if (oSoldado in loc) {
		          print (s_underline) "~Hay al menos un clon patrullando el exterior de Cadgel Meadows.~ ", "- te informa Bomo mientras regresa a tu posición.^";
	            } else {
	              print (s_underline) "~Está todo despejado, General.~ ", "- te informa Bomo mientras regresa a tu posición.^";
                }
	  extOeste: print (s_underline) "~Echaré un vistazo.~ ", "- te contesta Bomo.^";
	            if (oSoldado in loc) {
		          print (s_underline) "~Hay al menos un clon patrullando el exterior de Cadgel Meadows.~ ", "- te informa Bomo mientras regresa a tu posición.^";
	            } else {
	              print (s_underline) "~Está todo despejado, General.~ ", "- te informa Bomo mientras regresa a tu posición.^";
                }
	  extEste: if (location==hangarEste) {
		         print (s_underline) "~Los soldados me matarían antes de poner un pie en el interior.~ ", "- te contesta Bomo.^";
	           } else {
		         print (s_underline) "~Echaré un vistazo.~ ", "- te contesta Bomo.^";
	             print (s_underline) "~Dass, la entrada al puerto espacial está vigilada por esos malditos soldados imperiales.~ ", "- te informa Bomo mientras regresa a tu posición.^";
               }
	  hangarEste: if (location==extEste) {
		            print (s_underline) "~¡Esos bastardos clones me matarían!~ ", "- te contesta Bomo.^";
	              } else {
		            print (s_underline) "~Dass, la salida al exterior está vigilada por esos malditos soldados imperiales.~ ", "- te informa Bomo mientras regresa a tu posición.^";
	              }
	  default: print (s_underline) "~No creo que sea buena idea separarnos, Dass.~ ", "- te contesta Bomo.";
    }
  }
];

!
Object  Corto_Inicial
 class  cortometraje
 with   
   cadena "",
   description
        [; self.delay=5;
            print (s_user2) "EPISODIO 3.5 ^EL ULTIMO JEDI^";
        ]
        [;
        self.cadena = "^Los tiempos oscuros de la Gran Purga están aquí. La Orden 66 destruyó la Orden 
        Jedi y dispersó a los escasos supervivientes.^";
        self.delay = LStrLen(self.cadena)*7/velocidad_texto+10;
        print (s_user2) self.cadena;
        ]
        
        [;
        self.cadena = "^Con sus ejércitos de droides desactivados, los luchadores de la resistencia 
        separatista ya no son rival para los soldados clones de Palpatine.^";
        self.delay = LStrLen(self.cadena)*7/velocidad_texto+10;
        print (s_user2) self.cadena;
        ]
        
        [;
        self.cadena = "^Los mundos de la Antigua República son arrastrados inexorablemente hacia el 
        puño de hierro del Imperio, mientras otros sistemas navegan a la deriva en un 
        mar de caos, desorden y desesperación. Para miles de millones de seres por toda 
        la galaxia, lo que creían que era una vía hacia un futuro mejor se ha convertido 
        en un camino incierto...^";
        self.delay = LStrLen(self.cadena)*8/velocidad_texto+10;
        print (s_user2) self.cadena;
        ]
        
        [;
        self.cadena = "^Traicionado por su propio ejército, el General Jedi Dass Jennir se vio
        obligado a esconderse en Nuevo Plympto y pedir ayuda a sus antiguos enemigos,
        los separatistas Nosaurianos, que le aceptaron. Dass Jennir se unió a su causa, 
        liderando sus ejércitos en la resistencia de Nuevo Plympto frente al avance 
        del Imperio.^";
        self.delay = LStrLen(self.cadena)*8/velocidad_texto+10;
        print (s_user2) self.cadena;
        ]
        
        [;
        self.cadena = "^Alertado por los rumores de que un Jedi humano lidera la resistencia 
        separatista en Nuevo Plympto, el emperador Palpatine ha enviado a la Legión 501 a 
        ese planeta para acabar con los enfrentamientos de una vez por todas.^";
        self.delay = LStrLen(self.cadena)*7/velocidad_texto+10;
        print (s_user2) self.cadena;
        ]
        
        [;
        self.cadena = "^El fin de la resistencia en Nuevo Plympto está cerca. Los espías informaron 
        de la llegada de los refuerzos imperiales durante la noche. Los tanques se aproximan y
        Dass Jennir sabe que al ejército que lidera le falta fuerza para detenerles.^";
        self.delay = LStrLen(self.cadena)*7/velocidad_texto+10;
        print (s_user2) self.cadena;
        ]
        
        [;
        self.cadena = "^La causa por la que han luchado está perdida... Pero aún hay un objetivo al
        que este pequeño ejército puede servir: conseguir unos minutos más para que las 
        mujeres y niños nosaurianos que están siendo evacuados hacia el puerto espacial 
        de Cadgel Meadows puedan escapar de su terrible destino...^";
        self.delay = LStrLen(self.cadena)*8/velocidad_texto+10;
        print (s_user2) self.cadena;
        ]
;

Object  Corto_Caida
 class  cortometraje
 with  
   cadena "", 
   description
         [; self.delay=5;
            "Comandante Vill:^";
         ]           
         [;
           self.cadena = "~¡No caigáis otra vez en la misma trampa!~^";
           self.delay = LStrLen(self.cadena)*9/velocidad_texto+10;
           print (s_underline) self.cadena;
           rtrue;
         ]
         [;
           self.cadena = "~¡Apuntad al siguiente árbol!~^";
           self.delay = LStrLen(self.cadena)*9/velocidad_texto+10;
           print (s_underline) self.cadena;
           rtrue;
         ]           
         [; 
           !playSound(chan2,sndExplosion,1,VOLUMEN_ALTO);  
           Damusix.TocarV(sndExplosion,VOLUMEN_ALTO);
           self.cadena = "^¡¡¡BOOOOOOOMMMMMMMMM!!!^";
           self.delay = LStrLen(self.cadena)*7/velocidad_texto+10;
           "^¡¡¡BOOOOOOOMMMMMMMMM!!!^";
         ]   
         [;
           self.cadena = "^~¡Dass!~ - oyes a Bomo llamarte entre el estruendo de la explosión.^
                          ^~¡Bomo!~ - es lo único que aciertas a contestarle.^";
           self.delay = LStrLen(self.cadena)*9/velocidad_texto+10;
           print (s_underline) "^~¡Dass!~ ", "- oyes a Bomo llamarte entre el estruendo de la explosión.^";
           print (s_underline) "^~¡Bomo!~ ", "- es lo único que aciertas a contestarle.^";
           rtrue;
         ]
            
        "^Adelantándose a tu jugada, los tanques imperiales han disparado contra el árbol que pretendías cortar, derribándolo
         hacia el lado contrario.^"
        
        "^El gigantesco tronco arranca, al caer, las enormes raíces del suelo, provocando un inmenso agujero en la tierra justo donde
          os encontrábais Bomo y tú.^"
        
        "^Arrastrado por piedras y tierra, caes... Caes hasta que sientes el tremendo golpe provocado al chocar contra el suelo... 
         Luego te sumerges en la oscuridad de la inconsciencia...^"
;

Object  Corto_Caida2
 class  cortometraje
 with   description
         [; self.delay=5;
            "Comandante Vill:^";
         ]           
         [;
           print (s_underline) "~¡Disparad al Jedi!~^";
           rtrue;
         ]
         [;
           print (s_underline) "~¡Lord Vader nos recompensará si le llevamos su cabeza!~^";
           rtrue;
         ]           
            
         [; 
            !playSound(chan2,sndExplosion,1,VOLUMEN_ALTO); 
            Damusix.TocarV(sndExplosion,VOLUMEN_ALTO); 
            "^¡¡¡BOOOOOOOMMMMMMMMM!!!^";
         ]   
           
         [;
           print (s_underline) "^~¡Dass!~ ", "- oyes a Bomo llamarte entre el estruendo de la explosión.^";
           print (s_underline) "^~¡Bomo!~ ", "- es lo único que aciertas a contestarle.^";
           rtrue;
         ]
            
        "^El disparo de uno de los tanques alcanza uno de los gigantescos árboles más cercanos a tu posición, derribándolo.^"
        
        "^El gigantesco tronco arranca, al caer, las enormes raíces del suelo, provocando un inmenso agujero en la tierra justo donde
          os encontrábais Bomo y tú.^"
        
        "^Arrastrado por piedras y tierra, caes... Caes hasta que sientes el tremendo golpe provocado al chocar contra el suelo... 
         Luego te sumerges en la oscuridad de la inconsciencia...^"
;

Object  Corto_FinFase1
 class  cortometraje
 with   
   cadena "",
   description
         [; 
	       self.cadena = "^Usando el poder de la Fuerza, consigues levitar a Bomo y sacarlo del agujero.^...^";
	       self.delay = LStrLen(self.cadena)*9/velocidad_texto+10;
           print "^Usando el poder de la Fuerza, consigues levitar a Bomo y sacarlo del agujero.^...^";
           rtrue;
         ]

         [; 
           self.cadena = "Dass: ~No hay señal de los stormtroopers. La oscuridad nos dará algo de cobertura.~^";
           self.delay = LStrLen(self.cadena)*9/velocidad_texto+10;
           print "Dass: ",(s_underline) "~No hay señal de los stormtroopers. La oscuridad nos dará algo de cobertura.~^";
           rtrue;
         ]
         [;
           self.cadena = "Bomo: ~¡Malditos sean esos imperiales!... Los han matado a todos. Hasta el último de nuestros soldados...~ - 
                         Bomo se derrumba y cae de rodillas.^";
           self.delay = LStrLen(self.cadena)*9/velocidad_texto+10;
           print "Bomo: ",(s_underline) "~¡Malditos sean esos imperiales!... Los han matado a todos. Hasta el último de nuestros soldados...~^";
           print "Bomo se derrumba y cae de rodillas.^";
           rtrue;
         ]          
         [;
           self.cadena = "Dass: ~¿Acaso esperabas otra cosa, Bomo? El ejército imperial vino a este planeta a exterminar la revuelta.~^";
           self.delay = LStrLen(self.cadena)*9/velocidad_texto+10;
           print "Dass: ",(s_underline) "~¿Acaso esperabas otra cosa, Bomo? El ejército imperial vino a este planeta a exterminar la revuelta.~^";
           rtrue;
         ] 
         [;
           self.cadena = "Bomo: ~Aún estoy dispuesto a caer luchando, General. ¡Tan solo da la orden!~^";
           self.delay = LStrLen(self.cadena)*9/velocidad_texto+10;
           print "Bomo: ",(s_underline) "~Aún estoy dispuesto a caer luchando, General. ¡Tan solo da la orden!~^";
           rtrue;
         ]
         [;
           self.cadena = "Dass: ~No. Por la razón que sea, nosotros no hemos muerto. Hagamos que nuestra supervivencia
                  signifique algo. Vayamos a Cadgel Meadows... Tal vez podamos alcanzar a tu mujer e hija y sacar algo de esta derrota.~^";
           self.delay = LStrLen(self.cadena)*9/velocidad_texto+10;
           print "Dass: ",(s_underline) "~No. Por la razón que sea, nosotros no hemos muerto. Hagamos que nuestra supervivencia
                  signifique algo. Vayamos a Cadgel Meadows... Tal vez podamos alcanzar a tu mujer e hija y sacar algo de esta derrota.~^^";
           rtrue;
         ]           
;

[ DrawPausa img delay;
    viewImageCenter(img);
!    print "^[Esperando ", delay, " décimas de segundo]^";
    glk($00D2, gg_mainwin); ! glk_request_char_event(gg_mainwin);
    glk($00D6, delay*100); ! request_timer_events
    while(1) 
    {
    glk($00C0, gg_arguments); ! glk_select(gg_arguments);
    if ((gg_arguments-->0) == 2) break; ! 2=evType_CharInput
    if ((gg_arguments-->0) == 1) ! evType_Timer
    {
	    glk($00D3, gg_mainwin); ! cancel_char_event
        glk($00D6, 0); ! request_timer_events (cancelados)
!            print "[Timeout]^";
        return 0;
    }
    }
    glk($00D6, 0); ! request_timer_events (cancelados)
    return gg_arguments-->2;
];
[ TitlePageGraphic t;
    t=16;
    print (s_user1) "Hace mucho tiempo, en una galaxia muy, muy lejana...^" ;
    EsperarTecla("[Pulsa una tecla]");
    !playSound(chan1,sndIntro,1,VOLUMEN_ALTO);
    Damusix.TocarV(sndIntro,VOLUMEN_ALTO);
    BorrarPantalla();
    closeGraphicWindow();
    openGraphicWindow(80);
    DrawPausa(intro1,t);
    DrawPausa(intro2,t);
    DrawPausa(intro3,t);
    DrawPausa(intro4,t);
    DrawPausa(intro5,t);
    DrawPausa(intro6,t);
    DrawPausa(intro7,t);
    DrawPausa(intro8,t);
    DrawPausa(intro9,t);
    DrawPausa(intro10,t);
    DrawPausa(intro11,t);
    DrawPausa(intro12,t);
    DrawPausa(intro13,t);
    DrawPausa(intro14,t);
    DrawPausa(intro15,t);
    DrawPausa(intro16,t);
    DrawPausa(intro17,t);
    DrawPausa(intro18,t);
    DrawPausa(intro19,t);
    DrawPausa(intro20,t);
    DrawPausa(intro21,t);
    DrawPausa(intro22,t);
    DrawPausa(intro23,t);
    DrawPausa(intro24,t);
    DrawPausa(intro25,t);
    DrawPausa(intro26,t);
    DrawPausa(intro27,t);
    DrawPausa(intro28,t);
    DrawPausa(intro29,t);
    DrawPausa(intro30,t);
    DrawPausa(intro31,t);
    DrawPausa(intro32,t);
    DrawPausa(intro33,t);
    DrawPausa(intro34,t);
    DrawPausa(intro35,t);
    DrawPausa(intro36,t);
    DrawPausa(intro37,t);
    DrawPausa(intro38,t);
    DrawPausa(intro39,t);
    DrawPausa(intro40,t);
    DrawPausa(intro41,t);
    DrawPausa(intro42,t);
    DrawPausa(intro43,t);
    DrawPausa(intro44,t);

    EsperarTecla("[Pulsa una tecla para continuar...]^");
    closeGraphicWindow();
    BorrarPantalla();
    font on;
 ];     
 [ TitlePage;
    !@erase_window -1;
    font off;
!     print "Estilo de Texto: ", (s_emph) "Emphasized", "^";
!       print "Estilo de Texto: ", (s_bold) "Bold", " (como Máquina-Z)^";
!       print "Estilo de Texto: ", (s_pref) "Preformatted", "^";
!       print "Estilo de Texto: ", (s_fixed) "Fixed", " (como Máquina-Z)^";
!       print "Estilo de Texto: ", (s_head) "Header", "^";
!       print "Estilo de Texto: ", (s_subhead) "Subheader", "^";
!       print "Estilo de Texto: ", (s_alert) "Alert", "^";
!       print "Estilo de Texto: ", (s_reverse) "Reverse", " (como Máquina-Z)^";
!       print "Estilo de Texto: ", (s_note) "Note", "^";
!       print "Estilo de Texto: ", (s_underline) "Underline/Italic", " (como Máquina-Z)^";
!       print "Estilo de Texto: ", (s_block) "BlockQuote", "^";
!       print "Estilo de Texto: ", (s_input) "Input", "^";
!       print "Estilo de Texto: ", (s_user1) "User1", "^";
!       print "Estilo de Texto: ", (s_user2) "User2", "^";
    style bold; 
    !box "Hace mucho tiempo, en una galaxia muy, muy lejana...^" ;
    print (s_user1) "Hace mucho tiempo, en una galaxia muy, muy lejana...^" ;
    EsperarTecla("[Pulsa una tecla]");
    !playSound(chan1,sndIntro,1,VOLUMEN_ALTO);
    Damusix.TocarV(sndIntro,VOLUMEN_ALTO);
    BorrarPantalla();
    Corto_Inicial.proyeccion();

    if (Corto_Inicial.aborted==1) Damusix.PararCanalesExtra(); !silenceChannel(chan1);
    EsperarTecla("[Pulsa una tecla para continuar...]^");
    BorrarPantalla();
    !wait("[Pulsa una tecla para continuar...]"); 
    font on;
    !do { @read_char 1 0 0 i; } until (i==32 or 10 or 13);
    !@erase_window -1;
 ];
 
!===============================================================================
! (12) Temas de conversación
!===============================================================================

Object  AskTopics "topics for ASK";
Object  -> t_familiabomo "familia de bomo" with name 'mujer' 'esposa' 'hija' 'familia' 'refugiado' 'refugiados';
Object  -> t_mesa "mesa" with name 'mujer' 'esposa' 'mesa';
Object  -> t_resa "resa" with name 'hija' 'resa';
Object  -> t_hijocrys  "hijo de crys" with name 'hijo' 'familia';
Object  -> t_jedis  "jedi" with name 'jedi' 'jedis';
Object  -> t_imperio  "imperio" with name 'imperio' 'emperador' 'palpatine';
Object  -> t_republica "republica" with name 'republica';
Object  -> t_nombre "nombre" with name 'nombre' 'quien' 'eres' 'nombres' 'quienes' 'sois';
Object  -> t_prisionero "prisionero"  with name 'prisionero' 'nativo' 'nosauriano' 'prisioneros' 'nativos' 'nosaurianos' 'esclavos'
                                                'apresado' 'arrestado' 'cautivo' 'capturado' 'apresados' 'arrestados' 'cautivos' 'capturados';
Object  -> t_cadaveres "cadaveres"  with name 'cadaver' 'nativo' 'nosauriano' 'cadaveres' 'nativos' 'nosaurianos';
Object  -> t_guerra "guerra" with name 'guerra' 'batalla' 'invasion' 'combate' 'lucha';
Object  -> t_ejercito  "ejercito del imperio" with name 'ejercito' 'clones' 'tanques' 'soldados' 'stormtroopers' 'legion' '501';
Object  -> t_mision "la misión" with name 'mision' 'objetivo' 'objetivos' 'plan';
Object  -> t_bomo "_bomo" with name 'bomo';
Object  -> t_crys "crys" with name 'crys' 'taanzer' 'piloto' 'mujer' 'humana' 'chica';
Object  -> t_vill "vill" with name 'vill' 'comandante';
Object  -> t_simismo with name 'ti' 'si' 'mismo' 'como' 'estas' 'bien' 'encuentras';
Object  -> t_halfaxe "half axe" with name 'half' 'axe' 'paso';
Object  -> t_tripulacion "tripulacion" with name 'tripulacion' 'companeros' 'resto' 'otros';
Object  -> t_naves "naves" with name 'naves' 'bloqueo' 'nave' 'transporte';
Object  -> t_orvax "Orvax IV"  with name 'orvax' 'esclavos';
Object  -> t_fugitivos "fugitivos"  with name 'fugitivo' 'fugitivos' 'escapado' 'huido' 'sobrevivido' 'supervivientes' 'superviviente' 'escapar';
Object  -> t_carga "carga"  with name 'carga' 'mercancia' 'mercancias' 'cargas' 'contrabando' 'contrabandistas' 'contrabandista' 'inspeccion';
Object  -> t_tacos "tacos"  with name 'eres' 'gilipollas' 'guarro' 'imbecil' 'aburrido' 'tonto' 'bobo' 'idiota' 'mierda' 'jode' 'joder' 
                                      'puta' 'cono' 'cabron' 'puto' 'bastardo';
Object  -> t_ayuda "ayuda"  with name 'ayuda' 'ayudame';
Object  -> t_cadgel "cadgel meadows" with name 'cadgel' 'meadows' 'puerto' 'espacial';
Object  -> t_vader "Darth Vader" with name 'darth' 'lord' 'vader';

Object TemasOrvax4 "topics for ASK";
Object -> t_familiabomoO4 "familia de bomo" with name 'familia' 'bomo';
Object -> t_mesaO4 "mesa" with name 'mujer' 'esposa' 'mesa';
Object -> t_resaO4 "resa" with name 'hija' 'resa';
Object -> t_prisioneroO4 "prisionero" with name 'prisionero' 'nativo' 'nosauriano' 'prisioneros' 'nativos' 'nosaurianos' 'esclavos';
Object -> t_palizaO4 "paliza" with name 'paliza' 'pelea' 'lucha';
Object -> t_guardiasO4 "guardias" with name 'guardia' 'guardias';
Object -> t_misionO4 "la misión" with name 'mision' 'objetivo' 'objetivos' 'plan' 'averiguar' 'averiguaciones' 'averiguado';
Object -> t_simismoO4 with name 'ti' 'si' 'mismo' 'como' 'estas' 'bien' 'encuentras';
Object -> t_ayudaO4 "ayuda"  with name 'ayuda' 'ayudame';
Object -> t_meettoO4 "Meetto"  with name 'meetto' 'toydariano' 'mercader' 'vendedor' 'comerciante';
Object -> t_esclavosO4 "esclavos"  with name 'esclavos' 'mercado' 'trafico';
Object -> t_dineroO4 "dinero"  with name 'dinero' 'creditos';
Object -> t_repuestosO4 "repuestos"  with name 'pieza' 'piezas' 'repuesto' 'repuestos' 'nave' 'naves';
Object -> t_dejarikO4 "dejarik"  with name 'dejarik' 'juego' 'jugar';
Object -> t_apuestasO4 "apuestas"  with name 'apostar' 'apuesta' 'apuestas';
Object -> t_jaxfsevalO4 "Jaxf Seval"  with name 'jaxf' 'seval' 'humano' 'jugador' 'apostante';
Object -> t_sottaO4 "Sotta el Hutt"  with name 'sotta' 'hutt';
Object  -> t_uhumeleO4 "uhumele" with name 'nave' 'transporte' 'uhumele' 'modulo' 'control';





